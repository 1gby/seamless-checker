<!-- Rudeboy Pattern Checker - PIMP v1.7.3 FINAL PERFECT BUILD -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="theme-color" content="#000000">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<style>
/* ==================== GLOBAL RESET ==================== */
:root{color-scheme:dark}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{margin:0;padding:0;width:100%;height:100%;overflow-x:hidden;background:#000}

/* ==================== BODY & CONTAINER ==================== */
body{
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;
  background:linear-gradient(135deg,#0a0a0a 0%,#1a1a2e 100%);
  color:#eee;
  min-height:100vh;
  padding-top:env(safe-area-inset-top);
  padding-bottom:env(safe-area-inset-bottom);
  touch-action:pan-x pan-y;
}
#container{display:flex;flex-direction:column;min-height:100vh}

/* ==================== HEADER ==================== */
#header{
  padding:1.5rem 2rem;
  background:rgba(0,0,0,0.6);
  backdrop-filter:blur(40px) saturate(180%);
  -webkit-backdrop-filter:blur(40px) saturate(180%);
  border-bottom:1px solid rgba(255,255,255,0.1);
  box-shadow:0 8px 32px rgba(0,0,0,0.6),inset 0 1px 0 rgba(255,255,255,0.05);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:2rem;
  flex-wrap:wrap;
}

.logo-section{display:flex;align-items:center;gap:1.5rem}

/* Logo Animation */
#logo{
  height:42px;
  width:auto;
  cursor:pointer;
  transition:transform 0.3s,filter 0.3s;
  filter:drop-shadow(0 0 0px rgba(16,185,129,0));
  animation:pulse 2s ease-in-out infinite;
}
@keyframes pulse{
  0%,100%{filter:drop-shadow(0 0 0px rgba(16,185,129,0))}
  50%{filter:drop-shadow(0 0 6px rgba(16,185,129,1)) drop-shadow(0 0 12px rgba(16,185,129,1))}
}
#logo:hover{transform:scale(1.05)}
#logo:active{animation:glow-pulse 0.4s ease-out;transform:scale(0.98)}
@keyframes glow-pulse{
  0%{filter:drop-shadow(0 0 0px rgba(16,185,129,0))}
  50%{filter:drop-shadow(0 0 20px rgba(16,185,129,1)) drop-shadow(0 0 30px rgba(16,185,129,0.8))}
  100%{filter:drop-shadow(0 0 0px rgba(16,185,129,0))}
}

.title{
  font-size:1.5rem;
  font-weight:700;
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  margin:0;
}

/* ==================== HEADER BUTTONS ==================== */
.header-buttons{
  display:flex;
  align-items:center;
  gap:0.75rem;
  flex-wrap:nowrap;
  justify-content:center;
  width:100%;
  max-width:600px;
}

.file-input-wrapper{position:relative;display:flex;flex:1}
.file-input-wrapper input[type=file]{
  position:absolute;
  left:-9999px;
  opacity:0;
  pointer-events:none;
}

/* Button Base Style with Liquid Glass */
.upload-btn,.export-btn-header,.sample-btn{
  padding:0.85rem 1rem;
  min-height:52px;
  color:white;
  border:none;
  border-radius:16px;
  font-size:0.9rem;
  font-weight:600;
  cursor:pointer;
  transition:all 0.3s;
  width:100%;
  white-space:nowrap;
  text-align:center;
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(255,255,255,0.1);
  backdrop-filter:blur(40px) saturate(180%) brightness(1.1);
  -webkit-backdrop-filter:blur(40px) saturate(180%) brightness(1.1);
  border:1px solid rgba(255,255,255,0.2);
  box-shadow:0 8px 32px rgba(0,0,0,0.4),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2);
  position:relative;
  overflow:hidden;
}

.upload-btn::before,.export-btn-header::before,.sample-btn::before{
  content:'';
  position:absolute;
  top:-50%;
  left:-50%;
  width:200%;
  height:200%;
  background:radial-gradient(circle,rgba(255,255,255,0.1) 0%,transparent 70%);
  opacity:0;
  transition:opacity 0.3s;
}

.upload-btn:hover::before,.export-btn-header:hover::before,.sample-btn:hover::before{
  opacity:1;
}

/* Upload Button - Purple Glow */
.upload-btn{
  box-shadow:0 8px 32px rgba(0,0,0,0.4),0 0 20px rgba(118,75,162,0.6),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2);
}
.upload-btn:hover{
  transform:translateY(-2px);
  background:rgba(255,255,255,0.15);
  box-shadow:0 12px 40px rgba(0,0,0,0.5),0 0 25px rgba(118,75,162,0.8),inset 0 2px 0 rgba(255,255,255,0.35),inset 0 -2px 0 rgba(0,0,0,0.2);
}
.upload-btn:active{
  transform:translateY(0);
  box-shadow:0 4px 16px rgba(0,0,0,0.4),0 0 30px rgba(118,75,162,1),inset 0 2px 0 rgba(255,255,255,0.25),inset 0 -2px 0 rgba(0,0,0,0.25);
}

/* Sample Button - Green Glow */
.sample-btn{
  box-shadow:0 8px 32px rgba(0,0,0,0.4),0 0 20px rgba(16,185,129,0.6),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2);
}
.sample-btn:hover{
  transform:translateY(-2px);
  background:rgba(255,255,255,0.15);
  box-shadow:0 12px 40px rgba(0,0,0,0.5),0 0 25px rgba(16,185,129,0.8),inset 0 2px 0 rgba(255,255,255,0.35),inset 0 -2px 0 rgba(0,0,0,0.2);
}
.sample-btn:active{
  transform:translateY(0);
  box-shadow:0 4px 16px rgba(0,0,0,0.4),0 0 30px rgba(16,185,129,1),inset 0 2px 0 rgba(255,255,255,0.25),inset 0 -2px 0 rgba(0,0,0,0.25);
}

/* Export Button - Purple Glow */
.export-btn-header{
  box-shadow:0 8px 32px rgba(0,0,0,0.4),0 0 20px rgba(118,75,162,0.6),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2);
}
.export-btn-header:hover{
  transform:translateY(-2px);
  background:rgba(255,255,255,0.15);
  box-shadow:0 12px 40px rgba(0,0,0,0.5),0 0 25px rgba(118,75,162,0.8),inset 0 2px 0 rgba(255,255,255,0.35),inset 0 -2px 0 rgba(0,0,0,0.2);
}
.export-btn-header:active{
  transform:translateY(0);
  box-shadow:0 4px 16px rgba(0,0,0,0.4),0 0 30px rgba(118,75,162,1),inset 0 2px 0 rgba(255,255,255,0.25),inset 0 -2px 0 rgba(0,0,0,0.25);
}
.export-btn-header:disabled{
  opacity:0.4;
  cursor:not-allowed;
  transform:none;
  box-shadow:0 8px 32px rgba(0,0,0,0.4),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2);
}

/* ==================== CANVAS AREA ==================== */
#canvas-wrapper{
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:2rem;
  position:relative;
  touch-action:none;
}

#canvas{
  max-width:1200px;
  width:100%;
  aspect-ratio:1;
  border-radius:20px;
  box-shadow:0 20px 60px rgba(0,0,0,0.5);
  cursor:pointer;
  transition:all 0.3s;
  background:rgba(255,255,255,0.015);
  backdrop-filter:blur(20px);
  -webkit-backdrop-filter:blur(20px);
  border:1px solid rgba(255,255,255,0.06);
  touch-action:none;
}
#canvas.has-image{cursor:grab}
#canvas.has-image:active{cursor:grabbing}
#canvas:hover{box-shadow:0 25px 70px rgba(0,0,0,0.6)}

/* Empty State */
.empty-state{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  text-align:center;
  pointer-events:none;
  opacity:0;
  transition:opacity 0.3s;
}
.empty-state.visible{opacity:1}
.empty-state-icon{font-size:4rem;margin-bottom:1rem;opacity:0.6}
.empty-state-text{font-size:1.25rem;font-weight:600;margin-bottom:0.5rem;color:#888}
.empty-state-subtext{font-size:0.95rem;color:#666}

/* ==================== EXPORT MODAL ==================== */
.export-modal{
  position:fixed;
  top:0;
  left:0;
  right:0;
  bottom:0;
  background:rgba(0,0,0,0.85);
  backdrop-filter:blur(30px);
  -webkit-backdrop-filter:blur(30px);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
  opacity:0;
  transition:opacity 0.3s;
  padding:2rem;
}
.export-modal.visible{display:flex;opacity:1}

.export-modal-content{
  background:rgba(255,255,255,0.1);
  backdrop-filter:blur(40px) saturate(180%) brightness(1.1);
  -webkit-backdrop-filter:blur(40px) saturate(180%) brightness(1.1);
  border-radius:20px;
  border:1px solid rgba(255,255,255,0.2);
  box-shadow:0 8px 32px rgba(0,0,0,0.6),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2);
  padding:2rem;
  max-width:400px;
  width:100%;
}

.export-modal-title{
  font-size:1.5rem;
  font-weight:700;
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  margin:0 0 1.5rem 0;
  text-align:center;
}

.export-options{
  display:flex;
  flex-direction:column;
  gap:1rem;
  margin-bottom:1.5rem;
}

.export-option{
  display:flex;
  flex-direction:column;
  gap:0.5rem;
}

.export-option-label{
  font-size:0.9rem;
  font-weight:600;
  color:#aaa;
}

.export-option select,
.export-option input{
  padding:0.75rem 1rem;
  font-size:0.95rem;
  border-radius:12px;
  background:rgba(255,255,255,0.1);
  backdrop-filter:blur(40px) saturate(180%) brightness(1.1);
  -webkit-backdrop-filter:blur(40px) saturate(180%) brightness(1.1);
  border:1px solid rgba(255,255,255,0.2);
  box-shadow:0 4px 20px rgba(0,0,0,0.3),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2);
  color:#eee;
  font-family:inherit;
  width:100%;
}

.export-buttons{
  display:flex;
  gap:1rem;
}

.export-btn-confirm,
.export-btn-cancel{
  flex:1;
  padding:0.85rem 1rem;
  border-radius:12px;
  font-size:0.95rem;
  font-weight:600;
  cursor:pointer;
  transition:all 0.3s;
  border:none;
  background:rgba(255,255,255,0.1);
  backdrop-filter:blur(40px) saturate(180%) brightness(1.1);
  -webkit-backdrop-filter:blur(40px) saturate(180%) brightness(1.1);
  border:1px solid rgba(255,255,255,0.2);
  box-shadow:0 4px 20px rgba(0,0,0,0.3),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2);
  color:#eee;
}

.export-btn-confirm{
  box-shadow:0 4px 20px rgba(0,0,0,0.3),0 0 20px rgba(16,185,129,0.6),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2);
}

.export-btn-confirm:hover{
  transform:translateY(-2px);
  box-shadow:0 6px 24px rgba(0,0,0,0.4),0 0 25px rgba(16,185,129,0.8),inset 0 2px 0 rgba(255,255,255,0.35),inset 0 -2px 0 rgba(0,0,0,0.2);
}

.export-btn-cancel{
  box-shadow:0 4px 20px rgba(0,0,0,0.3),0 0 20px rgba(239,68,68,0.6),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2);
}

.export-btn-cancel:hover{
  transform:translateY(-2px);
  box-shadow:0 6px 24px rgba(0,0,0,0.4),0 0 25px rgba(239,68,68,0.8),inset 0 2px 0 rgba(255,255,255,0.35),inset 0 -2px 0 rgba(0,0,0,0.2);
}

/* ==================== LOADING OVERLAY ==================== */
.loading-overlay{
  position:fixed;
  top:0;
  left:0;
  right:0;
  bottom:0;
  background:rgba(0,0,0,0.85);
  backdrop-filter:blur(30px);
  -webkit-backdrop-filter:blur(30px);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:10000;
  opacity:0;
  transition:opacity 0.3s;
}
.loading-overlay.visible{display:flex;opacity:1}

.loading-logo{
  width:120px;
  height:120px;
  opacity:0.8;
  animation:spin-glow 3s linear infinite;
}
@keyframes spin-glow{
  0%{
    transform:rotate(0deg);
    filter:drop-shadow(0 0 20px rgba(16,185,129,1)) drop-shadow(0 0 40px rgba(16,185,129,0.8));
  }
  50%{
    transform:rotate(360deg);
    filter:drop-shadow(0 0 20px rgba(16,185,129,1)) drop-shadow(0 0 40px rgba(16,185,129,0.8));
  }
  51%{
    filter:drop-shadow(0 0 20px rgba(118,75,162,1)) drop-shadow(0 0 40px rgba(118,75,162,0.8));
  }
  100%{
    transform:rotate(720deg);
    filter:drop-shadow(0 0 20px rgba(118,75,162,1)) drop-shadow(0 0 40px rgba(118,75,162,0.8));
  }
}

/* ==================== CONTROLS SECTION ==================== */
#controls{
  padding:2rem;
  background:rgba(0,0,0,0.6);
  backdrop-filter:blur(40px) saturate(180%);
  -webkit-backdrop-filter:blur(40px) saturate(180%);
  border-top:1px solid rgba(255,255,255,0.1);
  box-shadow:0 -8px 32px rgba(0,0,0,0.6),inset 0 1px 0 rgba(255,255,255,0.05);
}

.master-dropdown-wrapper{max-width:360px;margin:0 auto 1.5rem}

/* ==================== SELECT & BUTTON BASE STYLES ==================== */
select,button{
  padding:0.75rem 1rem;
  font-size:0.95rem;
  border-radius:16px;
  background:rgba(255,255,255,0.1);
  backdrop-filter:blur(40px) saturate(180%) brightness(1.1);
  -webkit-backdrop-filter:blur(40px) saturate(180%) brightness(1.1);
  border:1px solid rgba(255,255,255,0.2);
  box-shadow:0 4px 20px rgba(0,0,0,0.3),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2);
  color:#eee;
  cursor:pointer;
  transition:all 0.3s;
  font-family:inherit;
  width:100%;
}
select:hover,button:hover{
  background:rgba(255,255,255,0.15);
  border-color:rgba(255,255,255,0.25);
}
select:focus,button:focus{
  outline:none;
  border-color:rgba(102,126,234,0.5);
  box-shadow:0 0 0 3px rgba(102,126,234,0.2),0 0 20px rgba(102,126,234,0.4),inset 0 2px 0 rgba(255,255,255,0.35),inset 0 -2px 0 rgba(0,0,0,0.2);
}
select:active,button:active{transform:translateY(0)}

/* ==================== MASTER DROPDOWN (Purple Liquid Glass) ==================== */
#masterDropdown{
  box-shadow:0 4px 20px rgba(0,0,0,0.3),0 0 20px rgba(118,75,162,0.6),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2);
}
#masterDropdown:hover{
  box-shadow:0 6px 24px rgba(0,0,0,0.4),0 0 25px rgba(118,75,162,0.8),inset 0 2px 0 rgba(255,255,255,0.35),inset 0 -2px 0 rgba(0,0,0,0.2);
}
#masterDropdown:active{
  box-shadow:0 0 0 3px rgba(102,126,234,0.2),0 0 30px rgba(118,75,162,1),inset 0 2px 0 rgba(255,255,255,0.25),inset 0 -2px 0 rgba(0,0,0,0.25);
}

/* ==================== PREVIEW OPTIONS - GROUPED SECTIONS ==================== */
.preview-group{
  margin-bottom:1.5rem;
}

.preview-group-title{
  font-size:0.75rem;
  font-weight:700;
  color:#667eea;
  text-transform:uppercase;
  letter-spacing:1.5px;
  margin-bottom:0.75rem;
  padding-left:0.5rem;
  opacity:0.8;
}

.preview-group-content{
  display:flex;
  flex-direction:column;
  gap:1rem;
}

/* ==================== DISPLAY DROPDOWNS (Purple & Green Liquid Glass) ==================== */
#canvasQuality,#viewMode,#gridSize{
  box-shadow:0 4px 20px rgba(0,0,0,0.3),0 0 20px rgba(118,75,162,0.6),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2);
}
#canvasQuality:hover,#viewMode:hover,#gridSize:hover{
  box-shadow:0 6px 24px rgba(0,0,0,0.4),0 0 25px rgba(118,75,162,0.8),inset 0 2px 0 rgba(255,255,255,0.35),inset 0 -2px 0 rgba(0,0,0,0.2);
}
#canvasQuality:active,#viewMode:active,#gridSize:active{
  box-shadow:0 0 0 3px rgba(102,126,234,0.2),0 0 30px rgba(118,75,162,1),inset 0 2px 0 rgba(255,255,255,0.25),inset 0 -2px 0 rgba(0,0,0,0.25);
}

#repeatType,#bgColor{
  box-shadow:0 4px 20px rgba(0,0,0,0.3),0 0 20px rgba(16,185,129,0.6),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2);
}
#repeatType:hover,#bgColor:hover{
  box-shadow:0 6px 24px rgba(0,0,0,0.4),0 0 25px rgba(16,185,129,0.8),inset 0 2px 0 rgba(255,255,255,0.35),inset 0 -2px 0 rgba(0,0,0,0.2);
}
#repeatType:active,#bgColor:active{
  box-shadow:0 0 0 3px rgba(102,126,234,0.2),0 0 30px rgba(16,185,129,1),inset 0 2px 0 rgba(255,255,255,0.25),inset 0 -2px 0 rgba(0,0,0,0.25);
}

/* ==================== STORES DROPDOWN (Purple) ==================== */
#countryStores{
  box-shadow:0 4px 20px rgba(0,0,0,0.3),0 0 20px rgba(118,75,162,0.6),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2);
}
#countryStores:hover{
  box-shadow:0 6px 24px rgba(0,0,0,0.4),0 0 25px rgba(118,75,162,0.8),inset 0 2px 0 rgba(255,255,255,0.35),inset 0 -2px 0 rgba(0,0,0,0.2);
}
#countryStores:active{
  box-shadow:0 0 0 3px rgba(102,126,234,0.2),0 0 30px rgba(118,75,162,1),inset 0 2px 0 rgba(255,255,255,0.25),inset 0 -2px 0 rgba(0,0,0,0.25);
}

/* ==================== SLIDER DROPDOWNS (Liquid Glass) ==================== */
.slider-dropdown[data-slider="offsetX"] .slider-dropdown-header,
.slider-dropdown[data-slider="mockupZoom"] .slider-dropdown-header{
  box-shadow:0 4px 20px rgba(0,0,0,0.3),0 0 20px rgba(118,75,162,0.6),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2);
}

.slider-dropdown[data-slider="offsetY"] .slider-dropdown-header,
.slider-dropdown[data-slider="mockupRotate"] .slider-dropdown-header{
  box-shadow:0 4px 20px rgba(0,0,0,0.3),0 0 20px rgba(16,185,129,0.6),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2);
}

.slider-dropdown-header:hover{
  background:rgba(255,255,255,0.15);
  border-color:rgba(255,255,255,0.25);
}

.slider-dropdown[data-slider="offsetX"] .slider-dropdown-header:hover,
.slider-dropdown[data-slider="mockupZoom"] .slider-dropdown-header:hover{
  box-shadow:0 6px 24px rgba(0,0,0,0.4),0 0 25px rgba(118,75,162,0.8),inset 0 2px 0 rgba(255,255,255,0.35),inset 0 -2px 0 rgba(0,0,0,0.2);
}

.slider-dropdown[data-slider="offsetY"] .slider-dropdown-header:hover,
.slider-dropdown[data-slider="mockupRotate"] .slider-dropdown-header:hover{
  box-shadow:0 6px 24px rgba(0,0,0,0.4),0 0 25px rgba(16,185,129,0.8),inset 0 2px 0 rgba(255,255,255,0.35),inset 0 -2px 0 rgba(0,0,0,0.2);
}

.slider-dropdown[data-slider="offsetX"] .slider-dropdown-header:active,
.slider-dropdown[data-slider="mockupZoom"] .slider-dropdown-header:active{
  box-shadow:0 0 0 3px rgba(102,126,234,0.2),0 0 30px rgba(118,75,162,1),inset 0 2px 0 rgba(255,255,255,0.25),inset 0 -2px 0 rgba(0,0,0,0.25);
}

.slider-dropdown[data-slider="offsetY"] .slider-dropdown-header:active,
.slider-dropdown[data-slider="mockupRotate"] .slider-dropdown-header:active{
  box-shadow:0 0 0 3px rgba(102,126,234,0.2),0 0 30px rgba(16,185,129,1),inset 0 2px 0 rgba(255,255,255,0.25),inset 0 -2px 0 rgba(0,0,0,0.25);
}

/* ==================== SCALE SLIDER (CENTER-ALIGNED - Purple Glow) ==================== */
.slider-dropdown[data-slider="scale"] .slider-dropdown-header{
  box-shadow:0 4px 20px rgba(0,0,0,0.3),0 0 20px rgba(118,75,162,0.6),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2);
}

.slider-dropdown[data-slider="scale"] .slider-dropdown-header:hover{
  box-shadow:0 6px 24px rgba(0,0,0,0.4),0 0 25px rgba(118,75,162,0.8),inset 0 2px 0 rgba(255,255,255,0.35),inset 0 -2px 0 rgba(0,0,0,0.2);
}

.slider-dropdown[data-slider="scale"] .slider-dropdown-header:active{
  box-shadow:0 0 0 3px rgba(102,126,234,0.2),0 0 30px rgba(118,75,162,1),inset 0 2px 0 rgba(255,255,255,0.25),inset 0 -2px 0 rgba(0,0,0,0.25);
}

/* ==================== CONTROLS SECTIONS ==================== */
.controls-section{
  display:none;
  transition:all 0.3s;
  margin-top:1.5rem;
}
.controls-section.active{display:block}

.settings-dropdowns,.sliders-container{
  display:flex;
  flex-direction:column;
  gap:1rem;
  max-width:360px;
  margin:0 auto;
}

.section-label{
  font-size:0.85rem;
  font-weight:700;
  color:#667eea;
  text-align:center;
  margin-bottom:0.5rem;
  text-transform:uppercase;
  letter-spacing:1px;
}

/* ==================== SLIDER COMPONENTS ==================== */
.slider-dropdown{margin-bottom:0}

.slider-dropdown-header{
  padding:0.75rem 1rem;
  font-size:0.95rem;
  border-radius:16px;
  background:rgba(255,255,255,0.1);
  backdrop-filter:blur(40px) saturate(180%) brightness(1.1);
  -webkit-backdrop-filter:blur(40px) saturate(180%) brightness(1.1);
  border:1px solid rgba(255,255,255,0.2);
  box-shadow:0 4px 20px rgba(0,0,0,0.3),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2);
  color:#eee;
  cursor:pointer;
  transition:all 0.3s;
  display:flex;
  justify-content:space-between;
  align-items:center;
  user-select:none;
}

.slider-dropdown-content{
  max-height:0;
  overflow:hidden;
  transition:max-height 0.3s ease;
  margin-top:0.5rem;
}
.slider-dropdown.open .slider-dropdown-content{max-height:200px}

.slider-group{
  display:flex;
  flex-direction:column;
  gap:0.75rem;
  padding:1.2rem 1.5rem;
  background:rgba(255,255,255,0.1);
  backdrop-filter:blur(40px) saturate(180%) brightness(1.1);
  -webkit-backdrop-filter:blur(40px) saturate(180%) brightness(1.1);
  border-radius:16px;
  border:1px solid rgba(255,255,255,0.2);
  box-shadow:0 4px 20px rgba(0,0,0,0.3),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2);
  position:relative;
}

.slider-wrapper{position:relative}

/* CENTER MARKER for Scale & Zoom Sliders */
.slider-wrapper.centered::before{
  content:'';
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%, -50%);
  width:2px;
  height:20px;
  background:rgba(102,126,234,0.5);
  pointer-events:none;
  z-index:1;
}

/* ==================== ZOOM SLIDER (DISPLAY SECTION) ==================== */
.zoom-slider-wrapper{
  margin-bottom:1rem;
}

.zoom-slider-header{
  padding:0.75rem 1rem;
  font-size:0.95rem;
  border-radius:16px;
  background:rgba(255,255,255,0.1);
  backdrop-filter:blur(40px) saturate(180%) brightness(1.1);
  -webkit-backdrop-filter:blur(40px) saturate(180%) brightness(1.1);
  border:1px solid rgba(255,255,255,0.2);
  box-shadow:0 4px 20px rgba(0,0,0,0.3),0 0 20px rgba(118,75,162,0.6),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2);
  color:#eee;
  cursor:pointer;
  transition:all 0.3s;
  display:flex;
  justify-content:space-between;
  align-items:center;
  user-select:none;
}

.zoom-slider-header:hover{
  background:rgba(255,255,255,0.15);
  border-color:rgba(255,255,255,0.25);
  box-shadow:0 6px 24px rgba(0,0,0,0.4),0 0 25px rgba(118,75,162,0.8),inset 0 2px 0 rgba(255,255,255,0.35),inset 0 -2px 0 rgba(0,0,0,0.2);
}

.zoom-slider-content{
  max-height:0;
  overflow:hidden;
  transition:max-height 0.3s ease;
  margin-top:0.5rem;
}
.zoom-slider-wrapper.open .zoom-slider-content{max-height:200px}

/* ==================== PILL-SHAPED TRANSPARENT GLASS SLIDER ==================== */
input[type="range"]{
  width:100%;
  height:6px;
  border-radius:20px;
  background:linear-gradient(90deg,rgba(102,126,234,0.3) 0%,rgba(118,75,162,0.3) 100%);
  border:1px solid rgba(255,255,255,0.1);
  outline:none;
  -webkit-appearance:none;
  transition:all 0.3s;
  box-shadow:inset 0 1px 3px rgba(0,0,0,0.3);
}

/* PILL-SHAPED TRANSPARENT GLASS THUMB - WebKit */
input[type="range"]::-webkit-slider-thumb{
  -webkit-appearance:none;
  width:60px;
  height:28px;
  border-radius:50px;
  background:rgba(255,255,255,0.3);
  cursor:pointer;
  border:2px solid rgba(255,255,255,0.6);
  box-shadow:
    0 4px 16px rgba(0,0,0,0.3),
    0 0 20px rgba(102,126,234,0.4),
    inset 0 2px 6px rgba(255,255,255,0.4),
    inset 0 -2px 6px rgba(0,0,0,0.1);
  transition:all 0.3s ease;
  backdrop-filter:blur(20px) saturate(180%);
  -webkit-backdrop-filter:blur(20px) saturate(180%);
}

input[type="range"]::-webkit-slider-thumb:hover{
  transform:scale(1.08);
  background:rgba(255,255,255,0.4);
  box-shadow:
    0 6px 24px rgba(0,0,0,0.4),
    0 0 30px rgba(102,126,234,0.6),
    inset 0 2px 8px rgba(255,255,255,0.5),
    inset 0 -2px 8px rgba(0,0,0,0.15);
}

input[type="range"]::-webkit-slider-thumb:active{
  transform:scale(1.02);
  background:rgba(255,255,255,0.35);
  box-shadow:
    0 2px 12px rgba(0,0,0,0.5),
    0 0 35px rgba(118,75,162,0.8),
    inset 0 2px 6px rgba(255,255,255,0.45),
    inset 0 -2px 6px rgba(0,0,0,0.2);
}

/* PILL-SHAPED TRANSPARENT GLASS THUMB - Firefox */
input[type="range"]::-moz-range-thumb{
  width:60px;
  height:28px;
  border-radius:50px;
  background:rgba(255,255,255,0.3);
  cursor:pointer;
  border:2px solid rgba(255,255,255,0.6);
  box-shadow:
    0 4px 16px rgba(0,0,0,0.3),
    0 0 20px rgba(102,126,234,0.4),
    inset 0 2px 6px rgba(255,255,255,0.4),
    inset 0 -2px 6px rgba(0,0,0,0.1);
  transition:all 0.3s ease;
}

input[type="range"]::-moz-range-thumb:hover{
  transform:scale(1.08);
  background:rgba(255,255,255,0.4);
  box-shadow:
    0 6px 24px rgba(0,0,0,0.4),
    0 0 30px rgba(102,126,234,0.6),
    inset 0 2px 8px rgba(255,255,255,0.5),
    inset 0 -2px 8px rgba(0,0,0,0.15);
}

input[type="range"]::-moz-range-thumb:active{
  transform:scale(1.02);
  background:rgba(255,255,255,0.35);
  box-shadow:
    0 2px 12px rgba(0,0,0,0.5),
    0 0 35px rgba(118,75,162,0.8),
    inset 0 2px 6px rgba(255,255,255,0.45),
    inset 0 -2px 6px rgba(0,0,0,0.2);
}

.slider-value{
  font-size:0.9rem;
  font-weight:600;
  color:#667eea;
  min-width:45px;
  text-align:right;
}

/* ==================== WEATHER WIDGET (Sleek & Compact) ==================== */
.weather-widget{
  display:none;
  align-items:center;
  justify-content:center;
  gap:1rem;
  padding:0.75rem 1.5rem;
  margin-bottom:1rem;
  background:rgba(255,255,255,0.1);
  backdrop-filter:blur(40px) saturate(180%) brightness(1.1);
  -webkit-backdrop-filter:blur(40px) saturate(180%) brightness(1.1);
  border-radius:16px;
  border:1px solid rgba(255,255,255,0.2);
  box-shadow:0 4px 20px rgba(0,0,0,0.3),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2);
  font-size:0.9rem;
  animation:weather-glow 4s ease-in-out infinite;
}

@keyframes weather-glow{
  0%,100%{box-shadow:0 4px 20px rgba(0,0,0,0.3),0 0 15px rgba(118,75,162,0.4),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2)}
  50%{box-shadow:0 4px 20px rgba(0,0,0,0.3),0 0 15px rgba(16,185,129,0.4),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2)}
}

.weather-widget.visible{display:flex}
.weather-widget.loading{opacity:0.6}

.weather-icon{
  font-size:1.8rem;
  line-height:1;
}

.weather-temp{
  font-size:1.5rem;
  font-weight:700;
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
}

.weather-time{
  font-size:1rem;
  font-weight:600;
  color:#10b981;
}

.weather-divider{
  color:rgba(255,255,255,0.3);
  font-weight:300;
}

.weather-condition{
  font-size:0.95rem;
  font-weight:600;
  animation:condition-glow 4s ease-in-out infinite;
}

@keyframes condition-glow{
  0%,100%{
    color:#764ba2;
    text-shadow:0 0 10px rgba(118,75,162,0.6);
  }
  50%{
    color:#10b981;
    text-shadow:0 0 10px rgba(16,185,129,0.6);
  }
}

.weather-location{
  font-size:0.9rem;
  font-weight:600;
  animation:location-glow 4s ease-in-out infinite;
}

@keyframes location-glow{
  0%,100%{
    color:#10b981;
    text-shadow:0 0 8px rgba(16,185,129,0.6);
  }
  50%{
    color:#764ba2;
    text-shadow:0 0 8px rgba(118,75,162,0.6);
  }
}

/* ==================== TOOLS SECTION ==================== */
.tools-section{
  display:none;
  margin-top:1.5rem;
}
.tools-section.active{display:block}

.tool-card{
  background:rgba(255,255,255,0.1);
  backdrop-filter:blur(40px) saturate(180%) brightness(1.1);
  -webkit-backdrop-filter:blur(40px) saturate(180%) brightness(1.1);
  border-radius:16px;
  border:1px solid rgba(255,255,255,0.2);
  box-shadow:0 4px 20px rgba(0,0,0,0.3),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2);
  padding:1.2rem 1.5rem;
  margin-bottom:1rem;
  max-width:360px;
  margin-left:auto;
  margin-right:auto;
}

.tool-title{
  font-size:1rem;
  font-weight:700;
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  margin:0 0 0.75rem 0;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.palette-toggle{
  font-size:0.75rem;
  padding:0.3rem 0.6rem;
  border-radius:8px;
  background:rgba(16,185,129,0.2);
  color:#10b981;
  cursor:pointer;
  transition:all 0.3s;
  border:1px solid rgba(16,185,129,0.3);
}

.palette-toggle:hover{
  background:rgba(16,185,129,0.3);
}

/* Color Palette - 1x9 Horizontal */
.color-palette{
  display:grid;
  grid-template-columns:repeat(9,1fr);
  gap:0.5rem;
  margin-top:0.75rem;
}

.color-palette.hex-mode{
  display:none;
}

.color-swatch{
  width:100%;
  aspect-ratio:1;
  border-radius:8px;
  border:2px solid rgba(255,255,255,0.3);
  cursor:pointer;
  transition:all 0.3s;
  position:relative;
  box-shadow:0 2px 8px rgba(0,0,0,0.3);
}

.color-swatch:hover{
  transform:scale(1.1);
  border-color:rgba(255,255,255,0.6);
  box-shadow:0 4px 12px rgba(0,0,0,0.4);
}

.color-swatch:active{
  transform:scale(0.98);
}

.hex-tooltip{
  position:absolute;
  bottom:calc(100% + 8px);
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.9);
  color:#fff;
  padding:0.3rem 0.6rem;
  border-radius:6px;
  font-size:0.7rem;
  font-weight:600;
  white-space:nowrap;
  pointer-events:none;
  opacity:0;
  transition:opacity 0.3s;
  z-index:100;
}

.color-swatch:hover .hex-tooltip{
  opacity:1;
}

.color-swatch.copied::after{
  content:'‚úì';
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  color:#fff;
  font-size:20px;
  font-weight:bold;
  text-shadow:0 0 4px rgba(0,0,0,0.8);
}

/* Hex Checker */
.hex-checker{
  display:none;
  margin-top:0.75rem;
}

.hex-checker.active{
  display:block;
}

.hex-input-row{
  display:flex;
  gap:0.5rem;
  margin-bottom:0.75rem;
}

.hex-input{
  flex:1;
  padding:0.75rem;
  border-radius:12px;
  background:rgba(255,255,255,0.1);
  backdrop-filter:blur(40px) saturate(180%) brightness(1.1);
  -webkit-backdrop-filter:blur(40px) saturate(180%) brightness(1.1);
  border:1px solid rgba(255,255,255,0.2);
  box-shadow:0 4px 20px rgba(0,0,0,0.3),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2);
  color:#eee;
  font-family:'Courier New',monospace;
  font-size:0.95rem;
  font-weight:600;
}

.hex-preview{
  width:100%;
  height:80px;
  border-radius:12px;
  border:2px solid rgba(255,255,255,0.3);
  box-shadow:0 4px 12px rgba(0,0,0,0.3);
  transition:all 0.3s;
}

/* Seamless Test Dropdown */
.seamless-test-dropdown{
  margin-bottom:1rem;
}

.seamless-test-dropdown select{
  box-shadow:0 4px 20px rgba(0,0,0,0.3),0 0 20px rgba(16,185,129,0.6),inset 0 2px 0 rgba(255,255,255,0.3),inset 0 -2px 0 rgba(0,0,0,0.2);
}

.seamless-test-dropdown select:hover{
  box-shadow:0 6px 24px rgba(0,0,0,0.4),0 0 25px rgba(16,185,129,0.8),inset 0 2px 0 rgba(255,255,255,0.35),inset 0 -2px 0 rgba(0,0,0,0.2);
}

.seamless-test-dropdown select:active{
  box-shadow:0 0 0 3px rgba(102,126,234,0.2),0 0 30px rgba(16,185,129,1),inset 0 2px 0 rgba(255,255,255,0.25),inset 0 -2px 0 rgba(0,0,0,0.25);
}

/* Dimension Calculator */
.calc-single-slider{
  margin-top:0.75rem;
}

.calc-label-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:0.5rem;
}

.calc-labels{
  display:flex;
  gap:0.5rem;
}

.calc-label{
  font-size:1.2rem;
  font-weight:700;
  cursor:pointer;
  padding:0.3rem 0.8rem;
  border-radius:8px;
  transition:all 0.3s;
  user-select:none;
}

.calc-label.active{
  background:rgba(102,126,234,0.2);
  color:#667eea;
}

.calc-label:not(.active){
  color:#666;
}

.calc-label:hover{
  background:rgba(102,126,234,0.1);
}

/* Unit Buttons (Inches/CM) */
.calc-unit-buttons{
  display:flex;
  gap:0.5rem;
}

.calc-unit-btn{
  font-size:0.8rem;
  padding:0.3rem 0.6rem;
  border-radius:6px;
  cursor:pointer;
  transition:all 0.3s;
  border:1px solid rgba(118,75,162,0.3);
  font-weight:600;
  background:rgba(118,75,162,0.2);
  color:#764ba2;
  user-select:none;
}

.calc-unit-btn:hover{
  background:rgba(118,75,162,0.3);
}

.calc-unit-btn.active{
  background:rgba(16,185,129,0.2);
  color:#10b981;
  border:1px solid rgba(16,185,129,0.3);
}

.calc-unit-btn.active:hover{
  background:rgba(16,185,129,0.3);
}

.calc-current-value{
  font-size:1.2rem;
  font-weight:700;
  color:#667eea;
}

.calc-result{
  margin-top:1rem;
  padding:0.75rem;
  background:rgba(16,185,129,0.1);
  border-radius:8px;
  border:1px solid rgba(16,185,129,0.3);
  text-align:center;
}

.calc-result-value{
  font-size:1.1rem;
  font-weight:700;
  color:#10b981;
}

/* ==================== FOOTER ==================== */
#footer{
  padding:2rem;
  background:rgba(0,0,0,0.5);
  backdrop-filter:blur(40px) saturate(180%);
  -webkit-backdrop-filter:blur(40px) saturate(180%);
  border-top:1px solid rgba(255,255,255,0.1);
  box-shadow:0 -8px 32px rgba(0,0,0,0.6),inset 0 1px 0 rgba(255,255,255,0.05);
}

.footer-content{max-width:1200px;margin:0 auto;text-align:center}

.footer-credit{
  font-weight:700;
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  font-size:1.1rem;
  cursor:pointer;
  transition:all 0.3s;
}
.footer-credit:hover{opacity:0.8;transform:scale(1.02)}

/* ==================== PATTERN INFO BAR (PREMIUM PILLS WITH COLORED TEXT) ==================== */
.pattern-info{
  display:none;
  flex-wrap:wrap;
  justify-content:center;
  align-items:center;
  gap:0.6rem;
  padding:1rem 1.5rem;
  margin-top:1rem;
}
.pattern-info.visible{display:flex}

.info-pill{
  padding:0.5rem 1rem;
  border-radius:20px;
  font-size:0.85rem;
  font-weight:600;
  background:rgba(255,255,255,0.1);
  backdrop-filter:blur(40px) saturate(180%) brightness(1.1);
  -webkit-backdrop-filter:blur(40px) saturate(180%) brightness(1.1);
  border:1px solid rgba(255,255,255,0.2);
  box-shadow:0 2px 12px rgba(0,0,0,0.3),inset 0 1px 0 rgba(255,255,255,0.3);
  animation:pill-glow 4s ease-in-out infinite;
  white-space:nowrap;
}

@keyframes pill-glow{
  0%,100%{
    box-shadow:0 2px 12px rgba(0,0,0,0.3),0 0 10px rgba(118,75,162,0.4),inset 0 1px 0 rgba(255,255,255,0.3);
    border-color:rgba(118,75,162,0.3);
  }
  50%{
    box-shadow:0 2px 12px rgba(0,0,0,0.3),0 0 10px rgba(16,185,129,0.4),inset 0 1px 0 rgba(255,255,255,0.3);
    border-color:rgba(16,185,129,0.3);
  }
}

.info-pill .info-label{
  color:#aaa;
  margin-right:0.3rem;
}

.info-pill .info-value{
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  font-weight:700;
}

.info-pill .info-value.success{
  background:linear-gradient(135deg,#10b981 0%,#059669 100%);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
}

.info-pill .info-value.warning{
  background:linear-gradient(135deg,#f59e0b 0%,#d97706 100%);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
}

/* ==================== EASTER EGG OVERLAY ==================== */
.easter-egg-overlay{
  position:fixed;
  top:0;
  left:0;
  right:0;
  bottom:0;
  background:rgba(0,0,0,0.95);
  backdrop-filter:blur(30px);
  -webkit-backdrop-filter:blur(30px);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:20000;
  opacity:0;
  transition:opacity 0.5s;
  overflow:hidden;
}
.easter-egg-overlay.visible{display:flex;opacity:1}

.easter-egg-logo{
  width:150px;
  height:150px;
  opacity:0;
  animation:spin-in 1s ease-out forwards,egg-glow 2s ease-in-out infinite 1s;
}

@keyframes spin-in{
  0%{transform:scale(0) rotate(0deg);opacity:0}
  100%{transform:scale(1) rotate(720deg);opacity:1}
}

@keyframes spin-out{
  0%{transform:scale(1) rotate(0deg);opacity:1}
  100%{transform:scale(0) rotate(-720deg);opacity:0}
}

@keyframes egg-glow{
  0%,100%{filter:drop-shadow(0 0 15px rgba(118,75,162,0.8))}
  50%{filter:drop-shadow(0 0 20px rgba(16,185,129,0.8))}
}

.matrix-canvas{
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  opacity:0;
  transition:opacity 1s;
}
.matrix-canvas.visible{opacity:1}

/* ==================== MOBILE RESPONSIVE ==================== */
@media(max-width:768px){
  #header{
    padding:1rem;
    flex-direction:column;
    align-items:stretch;
  }
  .logo-section{justify-content:center}
  .header-buttons{
    gap:0.5rem;
    padding:0;
    max-width:100%;
  }
  .title{font-size:1.2rem}
  #canvas-wrapper{padding:1rem}
  #controls{padding:1.5rem 1rem}
  .weather-widget{
    flex-wrap:wrap;
    gap:0.5rem;
    font-size:0.85rem;
  }
  .weather-temp{font-size:1.3rem}
  .weather-icon{font-size:1.5rem}
  .color-palette{
    grid-template-columns:repeat(9,1fr);
    gap:0.4rem;
  }
  .pattern-info{
    font-size:0.8rem;
    gap:0.4rem;
    padding:0.75rem 1rem;
  }
  .info-pill{
    font-size:0.75rem;
    padding:0.4rem 0.8rem;
  }
  .export-modal-content{
    padding:1.5rem;
  }
  .export-buttons{
    flex-direction:column;
  }
}
</style>
<title>Rudeboy‚Ñ¢ Seamless Pattern Checker - PIMP v1.7.3 FINAL</title>
</head>
<body>

<div id="container">
<div id="header">
    <div class="logo-section">
      <img id="logo" src="https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/icons/icon.png" alt="Rud3boy Logo">
      <h1 class="title">Pattern Checker By Rudeboy‚Ñ¢</h1>
    </div>
    <div class="header-buttons">
      <div class="file-input-wrapper">
        <input type="file" id="fileInput" accept="image/*">
        <button class="upload-btn" id="uploadBtnHeader">üìÅ Upload</button>
      </div>
      <div class="file-input-wrapper">
        <select class="sample-btn" id="sampleSelect">
          <option value="">Sample</option>
          <option value="https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/patterns/Seamless.png">Seamless</option>
          <option value="https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/patterns/Mushrooms.png">Mushrooms</option>
          <option value="https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/patterns/JoltCola.png">Jolt Cola</option>
          <option value="https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/patterns/Beaver.png">Beaver</option>
          <option value="https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/patterns/PinotNoir.png">Pinot Noir</option>
          <option value="https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/patterns/Wu-Tang.png">Wu-Tang</option>
        </select>
      </div>
      <button class="export-btn-header" id="exportBtnHeader" disabled>üì§ Export</button>
    </div>
  </div>

  <div id="canvas-wrapper">
    <canvas id="canvas"></canvas>
    <div class="empty-state visible" id="emptyState">
      <div class="empty-state-icon">üé®</div>
      <div class="empty-state-text">Click to upload your pattern</div>
      <div class="empty-state-subtext">or drag & drop a square tile here</div>
    </div>
  </div>

  <div id="controls">
    
    <div class="master-dropdown-wrapper">
      <select id="masterDropdown">
        <option value="">Settings</option>
        <option value="display">Preview Options</option>
        <option value="controls">Pattern Transform</option>
        <option value="mockups">Mockups</option>
        <option value="tools">Tools</option>
        <option value="stores">Stores</option>
      </select>
    </div>

    <!-- PREVIEW OPTIONS SECTION (GROUPED) -->
    <div class="controls-section" id="displaySection">
      
      <!-- Canvas & Quality Group -->
      <div class="preview-group">
        <div class="preview-group-title">Canvas & Quality</div>
        <div class="preview-group-content">
          <select id="canvasQuality">
            <option value="1200">Canvas Quality: Standard (1200px)</option>
            <option value="1600">Canvas Quality: High (1600px)</option>
            <option value="2400">Canvas Quality: Ultra (2400px)</option>
            <option value="3200">Canvas Quality: Max (3200px)</option>
          </select>
        </div>
      </div>

      <!-- Pattern Settings Group -->
      <div class="preview-group">
        <div class="preview-group-title">Pattern Settings</div>
        <div class="preview-group-content">
          <select id="repeatType">
            <option value="full">Repeat Type: Full Drop</option>
            <option value="half-drop">Repeat Type: Half Drop</option>
            <option value="brick">Repeat Type: Brick</option>
          </select>
          <select id="bgColor">
            <option value="checker">Background: Transparent Grid</option>
            <option value="#000000">Background: Black</option>
            <option value="#ffffff">Background: White</option>
            <option value="#1a1a1a">Background: Gray</option>
          </select>
        </div>
      </div>

      <!-- View & Display Group -->
      <div class="preview-group">
        <div class="preview-group-title">View & Display</div>
        <div class="preview-group-content">
          <select id="viewMode">
            <option value="tile">View Mode: Infinite Tile</option>
            <option value="tile-grid">View Mode: Infinite Tile + Grid</option>
            <option value="phone">View Mode: Phone Case</option>
            <option value="ipad">View Mode: iPad Case</option>
            <option value="tote">View Mode: Tote Bag</option>
            <option value="bandana">View Mode: Bandana</option>
            <option value="bedspread">View Mode: Bedspread</option>
            <option value="mug">View Mode: Mug</option>
            <option value="fabric">View Mode: Fabric Swatch</option>
            <option value="bottle">View Mode: Water Bottle</option>
          </select>
          <select id="gridSize">
            <option value="off">Grid Overlay: Off</option>
            <option value="1">Grid Overlay: 1 inch</option>
            <option value="2">Grid Overlay: 2 inches</option>
            <option value="6">Grid Overlay: 6 inches</option>
            <option value="12">Grid Overlay: 12 inches</option>
          </select>
        </div>
      </div>

      <!-- Zoom Control Group -->
      <div class="preview-group">
        <div class="preview-group-title">Zoom Control</div>
        <div class="preview-group-content">
          <div class="zoom-slider-wrapper" id="zoomSliderWrapper">
            <div class="zoom-slider-header">
              <span>Zoom</span>
              <span class="slider-value" id="zoomValue">100%</span>
            </div>
            <div class="zoom-slider-content">
              <div class="slider-group">
                <div class="slider-wrapper centered">
                  <input type="range" id="zoomSlider" min="0" max="100" step="1" value="50">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- PATTERN TRANSFORM SECTION -->
    <div class="controls-section" id="controlsSection">
      <div class="sliders-container">
        
        <div class="slider-dropdown" data-slider="offsetX">
          <div class="slider-dropdown-header">
            <span>Offset X</span>
            <span class="slider-value" id="offsetXValue">0%</span>
          </div>
          <div class="slider-dropdown-content">
            <div class="slider-group">
              <div class="slider-wrapper">
                <input type="range" id="offsetX" min="0" max="100" value="0">
              </div>
            </div>
          </div>
        </div>

        <div class="slider-dropdown" data-slider="offsetY">
          <div class="slider-dropdown-header">
            <span>Offset Y</span>
            <span class="slider-value" id="offsetYValue">0%</span>
          </div>
          <div class="slider-dropdown-content">
            <div class="slider-group">
              <div class="slider-wrapper">
                <input type="range" id="offsetY" min="0" max="100" value="0">
              </div>
            </div>
          </div>
        </div>

        <!-- SCALE SLIDER (CENTER-ALIGNED AT 1.0√ó) -->
        <div class="slider-dropdown" data-slider="scale">
          <div class="slider-dropdown-header">
            <span>Scale</span>
            <span class="slider-value" id="scaleValue">1.00√ó</span>
          </div>
          <div class="slider-dropdown-content">
            <div class="slider-group">
              <div class="slider-wrapper centered">
                <input type="range" id="patternScale" min="0" max="100" step="1" value="50">
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- MOCKUPS SECTION -->
    <div class="controls-section" id="mockupsSection">
      <div class="section-label">Mockup Controls</div>
      <div class="sliders-container">
        
        <div class="slider-dropdown" data-slider="mockupZoom">
          <div class="slider-dropdown-header">
            <span>Mockup Zoom</span>
            <span class="slider-value" id="mockupZoomValue">100%</span>
          </div>
          <div class="slider-dropdown-content">
            <div class="slider-group">
              <div class="slider-wrapper">
                <input type="range" id="mockupZoom" min="100" max="150" step="1" value="100">
              </div>
            </div>
          </div>
        </div>

        <div class="slider-dropdown" data-slider="mockupRotate">
          <div class="slider-dropdown-header">
            <span>Mockup Rotate</span>
            <span class="slider-value" id="mockupRotateValue">0¬∞</span>
          </div>
          <div class="slider-dropdown-content">
            <div class="slider-group">
              <div class="slider-wrapper">
                <input type="range" id="mockupRotate" min="0" max="360" step="1" value="0">
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- TOOLS SECTION -->
    <div class="controls-section tools-section" id="toolsSection">
      
      <!-- Seamless Test -->
      <div class="seamless-test-dropdown">
        <select id="seamlessTest">
          <option value="off">Seamless Test: Off</option>
          <option value="on">Seamless Test: On (Red Edges)</option>
        </select>
      </div>

      <!-- Color Palette Card with Hex Checker Toggle -->
      <div class="tool-card" id="colorPaletteCard">
        <div class="tool-title">
          <span>üé® Color Palette</span>
          <span class="palette-toggle" id="paletteToggle">Hex Checker</span>
        </div>
        <div class="color-palette" id="colorPalette"></div>
        <div class="hex-checker" id="hexChecker">
          <div class="hex-input-row">
            <input type="text" class="hex-input" id="hexInput" placeholder="#FF0000" maxlength="7">
          </div>
          <div class="hex-preview" id="hexPreview"></div>
        </div>
      </div>

      <!-- Dimension Calculator Card (SIZE + DPI + INCHES/CM BUTTONS) -->
      <div class="tool-card" id="dimensionCalcCard">
        <div class="tool-title">üìê Dimension Calculator</div>
        <div class="calc-single-slider">
          <div class="calc-label-row">
            <div class="calc-labels">
              <span class="calc-label active" id="labelSize" data-field="size">Size</span>
              <span class="calc-label" id="labelDPI" data-field="dpi">DPI</span>
            </div>
            <div class="calc-unit-buttons">
              <span class="calc-unit-btn" id="btnInches" data-unit="inches">in</span>
              <span class="calc-unit-btn active" id="btnCM" data-unit="cm">cm</span>
            </div>
          </div>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem">
            <span class="calc-current-value" id="currentValue">24 √ó 24cm</span>
          </div>
          <input type="range" id="calcSlider" min="1" max="500" value="24">
        </div>
        <div class="calc-result">
          <div class="calc-result-value" id="calcResultValue">3600 √ó 3600px</div>
        </div>
      </div>

    </div>

    <!-- STORES SECTION -->
    <div class="controls-section" id="storesSection">
      <div style="text-align:center;margin-bottom:1.5rem">
        <div style="font-size:1.1rem;font-weight:600;margin-bottom:1rem;color:#aaa">Turn your patterns into real products!</div>
      </div>
      <div class="settings-dropdowns">
        <select id="countryStores">
          <option value="">Select Store</option>
          <option value="https://www.gelato.com/">Gelato üá™üá∫</option>
          <option value="https://www.contrado.co.uk/">Contrado üá™üá∫</option>
          <option value="https://www.saal-digital.com/">Saal Digital üá™üá∫</option>
          <option value="https://www.photobook-europe.com/">Photobook Europe üá™üá∫</option>
          <option value="https://www.whitewall.com/">WhiteWall üá™üá∫</option>
          <option value="https://www.canvaspeople.com/">CanvasPeople üá∫üá∏</option>
          <option value="https://www.canvaschamp.com/">CanvasChamp üá∫üá∏</option>
          <option value="https://www.mpix.com/">Mpix üá∫üá∏</option>
          <option value="https://www.canvaspop.com/">Canvaspop üá∫üá∏</option>
          <option value="https://canvasondemand.com/">Canvas On Demand üá∫üá∏</option>
          <option value="https://www.canvascanada.ca/">CanvasCanada.ca üá®üá¶</option>
          <option value="https://www.canvaschamp.ca/">CanvasChamp.ca üá®üá¶</option>
          <option value="https://www.bestcanvas.ca/">BestCanvas.ca üá®üá¶</option>
          <option value="https://www.canvaspop.com/">Canvaspop üá®üá¶</option>
          <option value="https://posterjack.ca/">Posterjack üá®üá¶</option>
        </select>
      </div>
    </div>

    <div class="pattern-info" id="patternInfo">
      <div class="info-pill">
        <span class="info-label">Pattern:</span>
        <span class="info-value" id="infoPattern">--</span>
      </div>
      <div class="info-pill">
        <span class="info-label">Quality:</span>
        <span class="info-value" id="infoQuality">--</span>
      </div>
      <div class="info-pill">
        <span class="info-label">Contrast:</span>
        <span class="info-value" id="infoContrast">--</span>
      </div>
      <div class="info-pill">
        <span class="info-label">Canvas:</span>
        <span class="info-value" id="infoCanvas">1200px</span>
      </div>
      <div class="info-pill">
        <span class="info-label">Colors:</span>
        <span class="info-value" id="infoColors">--</span>
      </div>
    </div>

  </div>

  <div id="footer">
    <div class="footer-content">
      <div class="weather-widget" id="weatherWidget">
        <span class="weather-icon" id="weatherIcon">üå§Ô∏è</span>
        <span class="weather-temp" id="weatherTemp">--¬∞</span>
        <span class="weather-divider">|</span>
        <span class="weather-time" id="weatherTime">--:--</span>
        <span class="weather-divider">|</span>
        <span class="weather-condition" id="weatherCondition">Loading...</span>
        <span class="weather-divider">|</span>
        <span class="weather-location" id="weatherLocation">--</span>
      </div>
      
      <div class="footer-credit" id="easterEgg">Created by Rudeboy‚Ñ¢</div>
    </div>
  </div>

</div>

<!-- EXPORT MODAL -->
<div class="export-modal" id="exportModal">
  <div class="export-modal-content">
    <div class="export-modal-title">üì§ Custom Export</div>
    <div class="export-options">
      <div class="export-option">
        <div class="export-option-label">Resolution</div>
        <select id="exportRes">
          <option value="current">Current Canvas (1200px)</option>
          <option value="1600">High (1600px)</option>
          <option value="2400">Ultra (2400px)</option>
          <option value="3200">Max (3200px)</option>
          <option value="4800">Print (4800px)</option>
          <option value="custom">Custom Size</option>
        </select>
      </div>
      <div class="export-option" id="customSizeOption" style="display:none">
        <div class="export-option-label">Custom Size (px)</div>
        <input type="number" id="customSize" min="100" max="10000" value="2400" placeholder="2400">
      </div>
      <div class="export-option">
        <div class="export-option-label">Format</div>
        <select id="exportFormat">
          <option value="png">PNG (Lossless)</option>
          <option value="jpg">JPG (Smaller)</option>
        </select>
      </div>
    </div>
    <div class="export-buttons">
      <button class="export-btn-confirm" id="exportConfirm">Export</button>
      <button class="export-btn-cancel" id="exportCancel">Cancel</button>
    </div>
  </div>
</div>

<div class="loading-overlay" id="loadingOverlay">
  <img class="loading-logo" src="https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/icons/icon.png" alt="Loading">
</div>

<div class="easter-egg-overlay" id="easterEggOverlay">
  <canvas class="matrix-canvas" id="matrixCanvas"></canvas>
  <img class="easter-egg-logo" id="easterEggLogo" src="https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/icons/icon.png" alt="Rudeboy">
</div>

<audio id="easterEggAudio" preload="none"></audio>

<script>
function roundedRect(ctx, x, y, w, h, r) {
  ctx.beginPath();
  ctx.moveTo(x + r, y);
  ctx.lineTo(x + w - r, y);
  ctx.arcTo(x + w, y, x + w, y + r, r);
  ctx.lineTo(x + w, y + h - r);
  ctx.arcTo(x + w, y + h, x + w - r, y + h, r);
  ctx.lineTo(x + r, y + h);
  ctx.arcTo(x, y + h, x, y + h - r, r);
  ctx.lineTo(x, y + r);
  ctx.arcTo(x, y, x + r, y, r);
  ctx.closePath();
}

function snap(val, step) {
  return Math.round(val / step) * step;
}

function snapScale(val) {
  return val >= 0.25 ? snap(val, 0.25) : Math.max(0.05, snap(val, 0.01));
}

function snapZoom(val) {
  return val >= 25 ? snap(val, 25) : Math.max(1, Math.round(val));
}

const doc = document;
const getEl = doc.getElementById.bind(doc);

const els = {
  canvas: getEl('canvas'),
  fileInput: getEl('fileInput'),
  uploadBtn: getEl('uploadBtnHeader'),
  sampleSelect: getEl('sampleSelect'),
  exportBtn: getEl('exportBtnHeader'),
  repeatType: getEl('repeatType'),
  viewMode: getEl('viewMode'),
  bgColor: getEl('bgColor'),
  canvasQuality: getEl('canvasQuality'),
  patternScale: getEl('patternScale'),
  offsetX: getEl('offsetX'),
  offsetY: getEl('offsetY'),
  zoomSlider: getEl('zoomSlider'),
  zoomSliderWrapper: getEl('zoomSliderWrapper'),
  mockupZoom: getEl('mockupZoom'),
  mockupRotate: getEl('mockupRotate'),
  scaleValue: getEl('scaleValue'),
  offsetXValue: getEl('offsetXValue'),
  offsetYValue: getEl('offsetYValue'),
  zoomValue: getEl('zoomValue'),
  mockupZoomValue: getEl('mockupZoomValue'),
  mockupRotateValue: getEl('mockupRotateValue'),
  emptyState: getEl('emptyState'),
  patternInfo: getEl('patternInfo'),
  infoPattern: getEl('infoPattern'),
  infoQuality: getEl('infoQuality'),
  infoContrast: getEl('infoContrast'),
  infoCanvas: getEl('infoCanvas'),
  infoColors: getEl('infoColors'),
  loadingOverlay: getEl('loadingOverlay'),
  easterEgg: getEl('easterEgg'),
  easterEggOverlay: getEl('easterEggOverlay'),
  easterEggLogo: getEl('easterEggLogo'),
  matrixCanvas: getEl('matrixCanvas'),
  audio: getEl('easterEggAudio'),
  masterDropdown: getEl('masterDropdown'),
  displaySection: getEl('displaySection'),
  controlsSection: getEl('controlsSection'),
  mockupsSection: getEl('mockupsSection'),
  toolsSection: getEl('toolsSection'),
  storesSection: getEl('storesSection'),
  countryStores: getEl('countryStores'),
  weatherWidget: getEl('weatherWidget'),
  weatherIcon: getEl('weatherIcon'),
  weatherTemp: getEl('weatherTemp'),
  weatherTime: getEl('weatherTime'),
  weatherCondition: getEl('weatherCondition'),
  weatherLocation: getEl('weatherLocation'),
  colorPalette: getEl('colorPalette'),
  calcSlider: getEl('calcSlider'),
  labelSize: getEl('labelSize'),
  labelDPI: getEl('labelDPI'),
  currentValue: getEl('currentValue'),
  calcResultValue: getEl('calcResultValue'),
  btnInches: getEl('btnInches'),
  btnCM: getEl('btnCM'),
  seamlessTest: getEl('seamlessTest'),
  gridSize: getEl('gridSize'),
  exportModal: getEl('exportModal'),
  exportRes: getEl('exportRes'),
  exportFormat: getEl('exportFormat'),
  customSize: getEl('customSize'),
  customSizeOption: getEl('customSizeOption'),
  exportConfirm: getEl('exportConfirm'),
  exportCancel: getEl('exportCancel'),
  paletteToggle: getEl('paletteToggle'),
  hexChecker: getEl('hexChecker'),
  hexInput: getEl('hexInput'),
  hexPreview: getEl('hexPreview')
};

const ctx = els.canvas.getContext('2d', { willReadFrequently: false });

let tileImage = null;
let repeatType = 'full';
let backgroundColor = 'checker';
let viewMode = 'tile';
let scale = 1;
let offsetPercentX = 0;
let offsetPercentY = 0;
let panX = 0;
let panY = 0;
let zoom = 1;
let mockupZoom = 1;
let mockupRotate = 0;
let isDragging = false;
let dragStartX, dragStartY;
let maxCanvasSize = 1200;
let loadStartTime = 0;
let isReload = false;
let matrixActive = false;
let matrixInterval = null;
let seamlessTestMode = false;
let gridOverlaySize = 0;
let hexCheckerMode = false;
let useMetric = true;

const mockupImages = {
  phone: null,
  bottle: null,
  tote: null,
  bandana: null,
  bedspread: null,
  ipad: null,
  mug: null
};

const MIN_ZOOM = 0.01;
const MAX_ZOOM = 8;
const MIN_LOAD_TIME = 1500;
const RELOAD_MIN_TIME = 1500;

const playlist = [
  'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/capone.mp3',
  'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/count.mp3',
  'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/falling%20softly.mp3',
  'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/fluid.mp3',
  'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/i%20wanna%20take%20your%20body%20higher.mp3',
  'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/journey.mp3',
  'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/moments.mp3',
  'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/stardrive.mp3',
  'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/sunset%20in%20junipero.mp3',
  'TRACK_10.mp3',
  'TRACK_11.mp3',
  'TRACK_12.mp3',
  'TRACK_13.mp3',
  'TRACK_14.mp3',
  'TRACK_15.mp3'
];

let shuffledPlaylist = [...playlist];
let currentTrackIndex = 0;

function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

shuffleArray(shuffledPlaylist);

function updateTime() {
  const now = new Date();
  const hours = now.getHours();
  const minutes = now.getMinutes();
  const ampm = hours >= 12 ? 'PM' : 'AM';
  const displayHours = hours % 12 || 12;
  const displayMinutes = minutes < 10 ? '0' + minutes : minutes;
  els.weatherTime.textContent = `${displayHours}:${displayMinutes} ${ampm}`;
}

setInterval(updateTime, 1000);
updateTime();

async function getCityName(lat, lon) {
  try {
    const response = await fetch(
      `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`
    );
    const data = await response.json();
    
    if (data && data.address) {
      const city = data.address.city || 
                   data.address.town || 
                   data.address.village || 
                   data.address.county || 
                   data.address.state;
      const country = data.address.country;
      
      if (city && country) {
        return `${city}, ${country}`;
      } else if (city) {
        return city;
      } else if (country) {
        return country;
      }
    }
    return 'Your Location';
  } catch (error) {
    console.error('Reverse geocoding error:', error);
    return 'Your Location';
  }
}

async function getWeather() {
  els.weatherWidget.classList.add('visible');
  els.weatherWidget.classList.add('loading');
  
  if (!navigator.geolocation) {
    els.weatherCondition.textContent = 'Location unavailable';
    els.weatherLocation.textContent = 'Geolocation not supported';
    els.weatherWidget.classList.remove('loading');
    return;
  }
  
  navigator.geolocation.getCurrentPosition(async (position) => {
    const { latitude, longitude } = position.coords;
    
    try {
      const [weatherResponse, cityName] = await Promise.all([
        fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true`),
        getCityName(latitude, longitude)
      ]);
      
      const data = await weatherResponse.json();
      
      if (data.current_weather) {
        displayWeatherOpenMeteo(data, latitude, longitude, cityName);
      }
    } catch (error) {
      console.error('Weather fetch error:', error);
      els.weatherCondition.textContent = 'Weather unavailable';
      els.weatherIcon.textContent = 'üåê';
      els.weatherLocation.textContent = 'Service unavailable';
      els.weatherWidget.classList.remove('loading');
    }
  }, (error) => {
    console.error('Geolocation error:', error);
    els.weatherCondition.textContent = 'Location denied';
    els.weatherIcon.textContent = 'üìç';
    els.weatherLocation.textContent = 'Enable location';
    els.weatherWidget.classList.remove('loading');
  });
}

function displayWeatherOpenMeteo(data, lat, lon, cityName) {
  const tempC = Math.round(data.current_weather.temperature);
  const tempF = Math.round((tempC * 9/5) + 32);
  
  const isUS = (lat > 24 && lat < 50 && lon > -125 && lon < -66);
  const temp = isUS ? tempF : tempC;
  const unit = isUS ? '¬∞F' : '¬∞C';
  
  els.weatherTemp.textContent = `${temp}${unit}`;
  els.weatherCondition.textContent = getRudeboyWeatherCondition(data.current_weather.weathercode);
  els.weatherLocation.textContent = cityName;
  els.weatherIcon.textContent = getWeatherIconFromCode(data.current_weather.weathercode);
  els.weatherWidget.classList.remove('loading');
}

function getWeatherIconFromCode(code) {
  if (code === 0) return '‚òÄÔ∏è';
  if (code === 1 || code === 2) return 'üå§Ô∏è';
  if (code === 3) return '‚òÅÔ∏è';
  if (code === 45 || code === 48) return 'üå´Ô∏è';
  if (code >= 51 && code <= 67) return 'üåßÔ∏è';
  if (code >= 71 && code <= 77) return '‚ùÑÔ∏è';
  if (code >= 80 && code <= 82) return 'üå¶Ô∏è';
  if (code >= 85 && code <= 86) return '‚ùÑÔ∏è';
  if (code >= 95 && code <= 99) return '‚õàÔ∏è';
  return 'üå°Ô∏è';
}

function getRudeboyWeatherCondition(code) {
  if (code === 0) return 'Let the sunshine';
  if (code === 1 || code === 2) return "It's Cloudy Bitch";
  if (code === 3) return "It's Cloudy Bitch";
  if (code === 45 || code === 48) return "Can't see shit";
  if (code >= 51 && code <= 67) return 'Wet T-Shirt Weather';
  if (code >= 71 && code <= 77) return 'Fucking Snow';
  if (code >= 80 && code <= 82) return "She's a squirter";
  if (code >= 85 && code <= 86) return 'Fucking Snow';
  if (code >= 95 && code <= 99) return 'Zeus is Pissed';
  return 'Unknown';
}

getWeather();

function rgbToHex(r, g, b) {
  return '#' + [r, g, b].map(x => {
    const hex = x.toString(16);
    return hex.length === 1 ? '0' + hex : hex;
  }).join('');
}

function hexToRgb(hex) {
  hex = hex.replace('#', '');
  if (hex.length === 3) {
    hex = hex.split('').map(c => c + c).join('');
  }
  const r = parseInt(hex.substring(0, 2), 16);
  const g = parseInt(hex.substring(2, 4), 16);
  const b = parseInt(hex.substring(4, 6), 16);
  return { r, g, b };
}

function isValidHex(hex) {
  return /^#?([0-9A-F]{3}|[0-9A-F]{6})$/i.test(hex);
}

els.paletteToggle.addEventListener('click', () => {
  hexCheckerMode = !hexCheckerMode;
  if (hexCheckerMode) {
    els.colorPalette.classList.add('hex-mode');
    els.hexChecker.classList.add('active');
    els.paletteToggle.textContent = 'Color Palette';
  } else {
    els.colorPalette.classList.remove('hex-mode');
    els.hexChecker.classList.remove('active');
    els.paletteToggle.textContent = 'Hex Checker';
  }
});

els.hexInput.addEventListener('input', (e) => {
  let hex = e.target.value.trim();
  
  if (!hex.startsWith('#')) {
    hex = '#' + hex;
    els.hexInput.value = hex;
  }
  
  if (isValidHex(hex)) {
    const rgb = hexToRgb(hex);
    els.hexPreview.style.backgroundColor = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
  }
});

els.hexInput.value = '#FF0000';
els.hexPreview.style.backgroundColor = '#FF0000';

function analyzePattern() {
  if (!tileImage) return;
  
  const width = tileImage.width;
  const height = tileImage.height;
  
  els.infoPattern.textContent = `${width} √ó ${height}px`;
  
  let qualityText = '';
  let qualityClass = '';
  
  if (width >= 3000 && height >= 3000) {
    qualityText = 'Excellent ‚úÖ';
    qualityClass = 'success';
  } else if (width >= 2000 && height >= 2000) {
    qualityText = 'Good ‚ö†Ô∏è';
    qualityClass = 'warning';
  } else {
    qualityText = 'Low ‚ùå';
    qualityClass = '';
  }
  
  els.infoQuality.textContent = qualityText;
  els.infoQuality.className = 'info-value ' + qualityClass;
  
  const tempCanvas = doc.createElement('canvas');
  tempCanvas.width = Math.min(width, 500);
  tempCanvas.height = Math.min(height, 500);
  const tempCtx = tempCanvas.getContext('2d');
  tempCtx.drawImage(tileImage, 0, 0, tempCanvas.width, tempCanvas.height);
  
  const imageData = tempCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height);
  const data = imageData.data;
  const colorMap = new Map();
  
  for (let i = 0; i < data.length; i += 4) {
    const r = Math.round(data[i] / 10) * 10;
    const g = Math.round(data[i + 1] / 10) * 10;
    const b = Math.round(data[i + 2] / 10) * 10;
    const key = `${r},${g},${b}`;
    colorMap.set(key, (colorMap.get(key) || 0) + 1);
  }
  
  const uniqueColors = colorMap.size;
  els.infoColors.textContent = `${uniqueColors}`;
  
  const sortedColors = Array.from(colorMap.entries())
    .sort((a, b) => b[1] - a[1])
    .slice(0, 9);
  
  els.colorPalette.innerHTML = '';
  sortedColors.forEach(([color]) => {
    const [r, g, b] = color.split(',').map(Number);
    const hex = rgbToHex(r, g, b);
    
    const swatch = doc.createElement('div');
    swatch.className = 'color-swatch';
    swatch.style.backgroundColor = `rgb(${r},${g},${b})`;
    
    const tooltip = doc.createElement('div');
    tooltip.className = 'hex-tooltip';
    tooltip.textContent = hex;
    swatch.appendChild(tooltip);
    
    swatch.addEventListener('click', () => {
      navigator.clipboard.writeText(hex).then(() => {
        swatch.classList.add('copied');
        setTimeout(() => swatch.classList.remove('copied'), 1000);
      });
    });
    
    els.colorPalette.appendChild(swatch);
  });
  
  let minLum = 1;
  let maxLum = 0;
  
  sortedColors.forEach(([color]) => {
    const [r, g, b] = color.split(',').map(Number);
    const lum = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
    minLum = Math.min(minLum, lum);
    maxLum = Math.max(maxLum, lum);
  });
  
  const contrastRatio = maxLum / (minLum + 0.05);
  
  if (contrastRatio > 7) {
    els.infoContrast.textContent = 'High';
    els.infoContrast.className = 'info-value success';
  } else if (contrastRatio > 3) {
    els.infoContrast.textContent = 'Medium';
    els.infoContrast.className = 'info-value warning';
  } else {
    els.infoContrast.textContent = 'Low';
    els.infoContrast.className = 'info-value';
  }
}

let calcValues = {
  size: 24,
  dpi: 150
};

let calcActiveField = 'size';

function updateCalcDisplay() {
  [els.labelSize, els.labelDPI].forEach(label => {
    label.classList.remove('active');
  });
  
  const activeLabel = calcActiveField === 'size' ? els.labelSize : els.labelDPI;
  activeLabel.classList.add('active');
  
  const value = calcValues[calcActiveField];
  const unit = useMetric ? 'cm' : '"';
  
  if (calcActiveField === 'size') {
    els.currentValue.textContent = `${value} √ó ${value}${unit}`;
    
    if (useMetric) {
      els.calcSlider.min = '1';
      els.calcSlider.max = '500';
    } else {
      els.calcSlider.min = '1';
      els.calcSlider.max = '200';
    }
  } else {
    els.currentValue.textContent = value;
    els.calcSlider.min = '72';
    els.calcSlider.max = '600';
  }
  
  els.calcSlider.value = value;
  
  const sizeInInches = useMetric ? calcValues.size / 2.54 : calcValues.size;
  const px = Math.round(sizeInInches * calcValues.dpi);
  
  if (px === 1) {
    els.calcResultValue.textContent = `1 √ó 1px`;
  } else {
    els.calcResultValue.textContent = `${px} √ó ${px}px`;
  }
}

els.labelSize.addEventListener('click', () => {
  calcActiveField = 'size';
  updateCalcDisplay();
});

els.labelDPI.addEventListener('click', () => {
  calcActiveField = 'dpi';
  updateCalcDisplay();
});

els.btnInches.addEventListener('click', () => {
  if (useMetric) {
    useMetric = false;
    els.btnInches.classList.add('active');
    els.btnCM.classList.remove('active');
    
    if (calcActiveField === 'size') {
      calcValues.size = Math.round(calcValues.size / 2.54);
      els.calcSlider.max = '200';
    }
    
    updateCalcDisplay();
  }
});

els.btnCM.addEventListener('click', () => {
  if (!useMetric) {
    useMetric = true;
    els.btnCM.classList.add('active');
    els.btnInches.classList.remove('active');
    
    if (calcActiveField === 'size') {
      calcValues.size = Math.round(calcValues.size * 2.54);
      els.calcSlider.max = '500';
    }
    
    updateCalcDisplay();
  }
});

els.calcSlider.addEventListener('input', (e) => {
  calcValues[calcActiveField] = parseInt(e.target.value);
  updateCalcDisplay();
});

updateCalcDisplay();

els.seamlessTest.addEventListener('change', (e) => {
  seamlessTestMode = e.target.value === 'on';
  draw();
});

els.gridSize.addEventListener('change', (e) => {
  gridOverlaySize = e.target.value === 'off' ? 0 : parseInt(e.target.value);
  draw();
});

els.exportRes.addEventListener('change', (e) => {
  if (e.target.value === 'custom') {
    els.customSizeOption.style.display = 'block';
  } else {
    els.customSizeOption.style.display = 'none';
  }
  
  if (e.target.value === 'current') {
    e.target.options[0].text = `Current Canvas (${maxCanvasSize}px)`;
  }
});

els.exportBtn.addEventListener('click', () => {
  if (!tileImage) return;
  els.exportRes.options[0].text = `Current Canvas (${maxCanvasSize}px)`;
  els.exportModal.classList.add('visible');
});

els.exportCancel.addEventListener('click', () => {
  els.exportModal.classList.remove('visible');
});

els.exportConfirm.addEventListener('click', async () => {
  if (!tileImage) return;
  
  let exportSize = maxCanvasSize;
  
  if (els.exportRes.value === 'custom') {
    exportSize = parseInt(els.customSize.value) || 2400;
  } else if (els.exportRes.value !== 'current') {
    exportSize = parseInt(els.exportRes.value);
  }
  
  els.exportModal.classList.remove('visible');
  showLoading(false);
  
  setTimeout(async () => {
    const exportCanvas = doc.createElement('canvas');
    exportCanvas.width = exportSize;
    exportCanvas.height = exportSize;
    const exportCtx = exportCanvas.getContext('2d');
    
    exportCtx.imageSmoothingEnabled = true;
    exportCtx.imageSmoothingQuality = 'high';
    
    const tileSize = tileImage.width * scale;
    
    exportCtx.save();
    exportCtx.translate(panX * (exportSize / maxCanvasSize), panY * (exportSize / maxCanvasSize));
    exportCtx.scale(zoom, zoom);
    
    const tilesX = Math.ceil(exportSize / tileSize / zoom) + 6;
    const tilesY = Math.ceil(exportSize / tileSize / zoom) + 6;
    const startTileX = Math.floor(-(panX * (exportSize / maxCanvasSize)) / (tileSize * zoom)) - 3;
    const startTileY = Math.floor(-(panY * (exportSize / maxCanvasSize)) / (tileSize * zoom)) - 3;
    
    for (let i = startTileX; i < startTileX + tilesX; i++) {
      for (let j = startTileY; j < startTileY + tilesY; j++) {
        let drawX = i * tileSize + offsetPercentX * tileSize;
        let drawY = j * tileSize + offsetPercentY * tileSize;
        
        if (repeatType === 'half-drop') {
          drawY += (Math.abs(i) % 2 === 1) ? tileSize / 2 : 0;
        } else if (repeatType === 'brick') {
          drawX += (Math.abs(j) % 2 === 1) ? tileSize / 2 : 0;
        }
        
        exportCtx.drawImage(tileImage, drawX, drawY, tileSize, tileSize);
      }
    }
    
    exportCtx.restore();
    
    const format = els.exportFormat.value === 'jpg' ? 'image/jpeg' : 'image/png';
    const quality = els.exportFormat.value === 'jpg' ? 0.95 : undefined;
    
    exportCanvas.toBlob(async (blob) => {
      const ext = els.exportFormat.value === 'jpg' ? '.jpg' : '.png';
      const file = new File([blob], `rudeboy-pattern-${exportSize}px${ext}`, { type: format });
      
      try {
        if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
          await navigator.share({
            files: [file],
            title: 'Rudeboy Pattern',
            text: `Check out my ${exportSize}px pattern!`
          });
        } else {
          const link = doc.createElement('a');
          link.download = `rudeboy-pattern-${exportSize}px${ext}`;
          link.href = URL.createObjectURL(blob);
          link.click();
          URL.revokeObjectURL(link.href);
        }
      } catch (e) {
        if (e.name !== 'AbortError') {
          const link = doc.createElement('a');
          link.download = `rudeboy-pattern-${exportSize}px${ext}`;
          link.href = URL.createObjectURL(blob);
          link.click();
          URL.revokeObjectURL(link.href);
        }
      }
      
      hideLoading();
    }, format, quality);
  }, 100);
});

els.masterDropdown.addEventListener('change', (e) => {
  [els.displaySection, els.controlsSection, els.mockupsSection, els.toolsSection, els.storesSection]
    .forEach(section => section.classList.remove('active'));
  
  const sections = {
    display: els.displaySection,
    controls: els.controlsSection,
    mockups: els.mockupsSection,
    tools: els.toolsSection,
    stores: els.storesSection
  };
  
  if (sections[e.target.value]) {
    sections[e.target.value].classList.add('active');
  }
});

els.countryStores.addEventListener('change', (e) => {
  if (e.target.value) {
    window.open(e.target.value, '_blank');
    e.target.value = '';
  }
});

doc.querySelectorAll('.slider-dropdown-header').forEach(header => {
  header.addEventListener('click', () => {
    const parent = header.parentElement;
    const wasOpen = parent.classList.contains('open');
    doc.querySelectorAll('.slider-dropdown').forEach(sd => sd.classList.remove('open'));
    if (!wasOpen) parent.classList.add('open');
  });
});

els.zoomSliderWrapper.querySelector('.zoom-slider-header').addEventListener('click', () => {
  const wasOpen = els.zoomSliderWrapper.classList.contains('open');
  els.zoomSliderWrapper.classList.toggle('open', !wasOpen);
});

function showLoading(reload = false) {
  isReload = reload;
  loadStartTime = Date.now();
  els.loadingOverlay.classList.add('visible');
}

function hideLoading() {
  const elapsed = Date.now() - loadStartTime;
  const remaining = Math.max(0, (isReload ? RELOAD_MIN_TIME : MIN_LOAD_TIME) - elapsed);
  setTimeout(() => els.loadingOverlay.classList.remove('visible'), remaining);
}

function playRandomTrack() {
  if (currentTrackIndex >= shuffledPlaylist.length) {
    shuffleArray(shuffledPlaylist);
    currentTrackIndex = 0;
  }
  
  const trackUrl = shuffledPlaylist[currentTrackIndex];
  currentTrackIndex++;
  
  if (trackUrl.includes('TRACK_')) {
    if (matrixActive) {
      playRandomTrack();
    }
    return;
  }
  
  els.audio.src = trackUrl;
  els.audio.volume = 0;
  els.audio.loop = false;
  
  els.audio.play().then(() => {
    let vol = 0;
    const fadeIn = setInterval(() => {
      if (vol < 0.5) {
        vol += 0.05;
        els.audio.volume = Math.min(vol, 0.5);
      } else {
        clearInterval(fadeIn);
      }
    }, 100);
  }).catch(err => {
    console.log('Audio play failed:', err);
    if (matrixActive) {
      playRandomTrack();
    }
  });
}

els.audio.addEventListener('ended', () => {
  if (matrixActive) {
    playRandomTrack();
  }
});

function stopMusic() {
  if (!els.audio.paused) {
    let vol = els.audio.volume;
    const fadeOut = setInterval(() => {
      if (vol > 0) {
        vol -= 0.05;
        els.audio.volume = Math.max(vol, 0);
      } else {
        clearInterval(fadeOut);
        els.audio.pause();
        els.audio.currentTime = 0;
      }
    }, 50);
  }
}

function startMatrix(){
const canvas=els.matrixCanvas,ctx=canvas.getContext('2d');
canvas.width=window.innerWidth;canvas.height=window.innerHeight;
const msg='CREATED BY RUDEBOY';
const fontSize=Math.ceil(canvas.width/msg.length);
const drops=[];
const dropSpeeds=[];

for(let i=0;i<msg.length;i++){
drops[i]=Math.random()*-100;
dropSpeeds[i]=0.5+Math.random()*1.5;
}

let messageMode=false;
let activeWords=[];
const words=['CREATED','BY','RUDEBOY'];
const wordStartPositions=[0,8,11];
const wordLengths=[7,2,7];
let messageTimer=0;
const MESSAGE_INTERVAL=12000;
let currentSpeed=50;

function draw(){
if(messageMode){
ctx.fillStyle='rgba(0,0,0,0.05)';
}else{
ctx.fillStyle='rgba(0,0,0,0.25)';
}
ctx.fillRect(0,0,canvas.width,canvas.height);
ctx.font=fontSize+'px monospace';

if(!messageMode){
messageTimer+=currentSpeed;
if(messageTimer>=MESSAGE_INTERVAL){
messageMode=true;
activeWords=[0];
messageTimer=0;
for(let i=0;i<msg.length;i++){
drops[i]=-100;
dropSpeeds[i]=1;
}
for(let i=0;i<7;i++){
drops[i]=0;
}
clearInterval(matrixInterval);
currentSpeed=75;
matrixInterval=setInterval(draw,currentSpeed);
}
}

for(let i=0;i<msg.length;i++){
let char;
if(messageMode){
let shouldShow=false;
for(let w of activeWords){
const wordStart=wordStartPositions[w];
const wordEnd=wordStart+wordLengths[w];
if(i>=wordStart&&i<wordEnd){
char=msg[i];
shouldShow=true;
break;
}
}
if(!shouldShow){
char=' ';
}
}else{
char=msg[i];
}

ctx.fillStyle=i%2===0?'#10b981':'#764ba2';
ctx.fillText(char,i*fontSize,drops[i]*fontSize);

if(drops[i]*fontSize>canvas.height&&Math.random()>0.975){
drops[i]=Math.random()*-100;
if(!messageMode){
dropSpeeds[i]=0.5+Math.random()*1.5;
}
}

drops[i]+=dropSpeeds[i];
}

if(messageMode){
if(activeWords.length===1&&activeWords[0]===0){
const createdMaxDrop=Math.max(...drops.slice(0,7));
if(createdMaxDrop*fontSize>canvas.height/2){
activeWords.push(1);
for(let j=8;j<10;j++){
drops[j]=0;
}
}
}
if(activeWords.length===2&&activeWords[1]===1){
const byMaxDrop=Math.max(...drops.slice(8,10));
if(byMaxDrop*fontSize>canvas.height/2){
activeWords.push(2);
for(let j=11;j<18;j++){
drops[j]=0;
}
}
}
if(activeWords.length===3){
const rudeboyMaxDrop=Math.max(...drops.slice(11,18));
if(rudeboyMaxDrop*fontSize>canvas.height+fontSize*5){
messageMode=false;
activeWords=[];
for(let j=0;j<msg.length;j++){
drops[j]=Math.random()*-100;
dropSpeeds[j]=0.5+Math.random()*1.5;
}
clearInterval(matrixInterval);
currentSpeed=50;
matrixInterval=setInterval(draw,currentSpeed);
}
}
}
}
matrixInterval=setInterval(draw,currentSpeed);
}

function stopMatrix() {
  if (matrixInterval) {
    clearInterval(matrixInterval);
    matrixInterval = null;
  }
}

els.easterEgg.addEventListener('click', () => {
  if (matrixActive) return;
  
  matrixActive = true;
  els.easterEggOverlay.classList.add('visible');
  playRandomTrack();
  
  setTimeout(() => {
    els.easterEggLogo.style.animation = 'none';
    els.easterEggLogo.style.opacity = '0';
    els.easterEggLogo.style.transition = 'opacity 0.5s';
    
    setTimeout(() => {
      els.easterEggLogo.style.display = 'none';
      els.matrixCanvas.classList.add('visible');
      startMatrix();
    }, 500);
  }, 1000);
});

els.easterEggOverlay.addEventListener('click', () => {
  if (!matrixActive) return;
  
  matrixActive = false;
  els.matrixCanvas.classList.remove('visible');
  stopMatrix();
  stopMusic();
  
  setTimeout(() => {
    els.easterEggLogo.style.display = 'block';
    els.easterEggLogo.style.animation = 'spin-out 1s ease-in forwards';
    
    setTimeout(() => {
      els.easterEggOverlay.classList.remove('visible');
      els.easterEggLogo.style.animation = 'spin-in 1s ease-out forwards, egg-glow 2s ease-in-out infinite 1s';
    }, 1000);
  }, 500);
});

(function loadMockupImages() {
  const images = [
    { key: 'phone', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/Mockups/iphone.png' },
    { key: 'bottle', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/Mockups/bottle.png' },
    { key: 'tote', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/Mockups/tote.png' },
    { key: 'bandana', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/Mockups/bandana.png' },
    { key: 'bedspread', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/Mockups/bedspread.png' },
    { key: 'ipad', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/Mockups/ipad.png' },
    { key: 'mug', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/Mockups/mug.png' }
  ];
  
  images.forEach(({ key, url }) => {
    const img = new Image();
    img.crossOrigin = 'anonymous';
    img.src = url;
    img.onload = () => {
      mockupImages[key] = img;
      if (tileImage) draw();
    };
    img.onerror = () => console.error(`${key} failed to load`);
  });
})();

function updateCanvasInfo() {
  els.infoCanvas.textContent = `${maxCanvasSize}px`;
}

function resizeCanvas() {
  const size = Math.min(els.canvas.parentElement.clientWidth - 64, maxCanvasSize);
  els.canvas.width = size;
  els.canvas.height = size;
  updateBackground();
  updateCanvasInfo();
  draw();
}

window.addEventListener('resize', resizeCanvas);
resizeCanvas();

getEl('logo').addEventListener('click', () => {
  showLoading(true);
  setTimeout(() => location.reload(), 2800);
});

els.canvas.addEventListener('click', () => {
  if (!tileImage && !isDragging) els.fileInput.click();
});

els.uploadBtn.addEventListener('click', () => els.fileInput.click());

els.sampleSelect.addEventListener('change', (e) => {
  const url = e.target.value;
  if (!url) return;
  
  showLoading(false);
  const img = new Image();
  img.crossOrigin = 'anonymous';
  
  img.onload = () => {
    tileImage = img;
    scale = Math.max(0.05, Math.min(5, 300 / tileImage.width));
    
    let sliderVal;
    if (scale <= 1.0) {
      sliderVal = Math.round(((scale - 0.05) / 0.95) * 50);
    } else {
      sliderVal = Math.round(50 + ((scale - 1.0) / 4.0) * 50);
    }
    
    els.patternScale.value = sliderVal;
    els.scaleValue.textContent = scale.toFixed(2) + '√ó';
    updateBackground();
    analyzePattern();
    els.patternInfo.classList.add('visible');
    draw();
    hideLoading();
    e.target.value = '';
  };
  
  img.onerror = () => {
    hideLoading();
    alert('Failed to load sample!');
    e.target.value = '';
  };
  
  img.src = url;
});

els.canvasQuality.addEventListener('change', (e) => {
  maxCanvasSize = parseInt(e.target.value);
  resizeCanvas();
});

function updateBackground() {
  if (tileImage) {
    els.canvas.style.background = backgroundColor === 'checker' ?
      'repeating-conic-gradient(#ccc 0% 25%,#999 0% 50%,#ccc 50% 75%,#999 75% 100%)' : backgroundColor;
    els.canvas.style.backgroundSize = backgroundColor === 'checker' ? '40px 40px' : '100% 100%';
  } else {
    els.canvas.style.background = 'repeating-conic-gradient(#2a2a2a 0% 25%,#1a1a1a 0% 50%,#2a2a2a 50% 75%,#1a1a1a 75% 100%)';
    els.canvas.style.backgroundSize = '40px 40px';
  }
}

function drawPatternToContext(ctx, startX, startY, width, height, tileSize) {
  const tilesX = Math.ceil(width / tileSize) + 4;
  const tilesY = Math.ceil(height / tileSize) + 4;
  
  for (let i = -2; i < tilesX; i++) {
    for (let j = -2; j < tilesY; j++) {
      let drawX = startX + i * tileSize + offsetPercentX * tileSize;
      let drawY = startY + j * tileSize + offsetPercentY * tileSize;
      
      if (repeatType === 'half-drop') {
        drawY += (Math.abs(i) % 2 === 1) ? tileSize / 2 : 0;
      } else if (repeatType === 'brick') {
        drawX += (Math.abs(j) % 2 === 1) ? tileSize / 2 : 0;
      }
      
      ctx.drawImage(tileImage, drawX, drawY, tileSize, tileSize);
    }
  }
}

function drawSeamlessTest(tileSize) {
  ctx.save();
  ctx.strokeStyle = 'rgba(255,0,0,0.8)';
  ctx.lineWidth = 3 / zoom;
  
  const tilesX = Math.ceil(els.canvas.width / tileSize / zoom) + 6;
  const tilesY = Math.ceil(els.canvas.height / tileSize / zoom) + 6;
  const startTileX = Math.floor(-panX / (tileSize * zoom)) - 3;
  const startTileY = Math.floor(-panY / (tileSize * zoom)) - 3;
  
  for (let i = startTileX; i < startTileX + tilesX; i++) {
    for (let j = startTileY; j < startTileY + tilesY; j++) {
      let drawX = i * tileSize + offsetPercentX * tileSize;
      let drawY = j * tileSize + offsetPercentY * tileSize;
      
      if (repeatType === 'half-drop') {
        drawY += (Math.abs(i) % 2 === 1) ? tileSize / 2 : 0;
      } else if (repeatType === 'brick') {
        drawX += (Math.abs(j) % 2 === 1) ? tileSize / 2 : 0;
      }
      
      ctx.strokeRect(drawX, drawY, tileSize, tileSize);
    }
  }
  
  ctx.restore();
}

function drawGridOverlay(tileSize) {
  if (gridOverlaySize === 0) return;
  
  ctx.save();
  ctx.strokeStyle = 'rgba(255,255,255,0.5)';
  ctx.lineWidth = 2 / zoom;
  ctx.setLineDash([5 / zoom, 5 / zoom]);
  
  const dpi = 150;
  const gridPixelSize = gridOverlaySize * dpi;
  
  const startX = Math.floor(-panX / zoom / gridPixelSize) * gridPixelSize;
  const startY = Math.floor(-panY / zoom / gridPixelSize) * gridPixelSize;
  const endX = startX + Math.ceil(els.canvas.width / zoom / gridPixelSize + 2) * gridPixelSize;
  const endY = startY + Math.ceil(els.canvas.height / zoom / gridPixelSize + 2) * gridPixelSize;
  
  for (let x = startX; x <= endX; x += gridPixelSize) {
    ctx.beginPath();
    ctx.moveTo(x, startY);
    ctx.lineTo(x, endY);
    ctx.stroke();
  }
  
  for (let y = startY; y <= endY; y += gridPixelSize) {
    ctx.beginPath();
    ctx.moveTo(startX, y);
    ctx.lineTo(endX, y);
    ctx.stroke();
  }
  
  ctx.restore();
}

function drawMockup(mockupImg) {
  if (!mockupImg || !mockupImg.complete || !mockupImg.naturalWidth) return;
  
  const displaySize = Math.min(els.canvas.width, els.canvas.height) * 0.72 * mockupZoom;
  
  const patternCanvas = doc.createElement('canvas');
  patternCanvas.width = displaySize;
  patternCanvas.height = displaySize;
  const patternCtx = patternCanvas.getContext('2d');
  
  patternCtx.save();
  patternCtx.translate(displaySize / 2, displaySize / 2);
  patternCtx.scale(zoom, zoom);
  patternCtx.translate(-displaySize / 2, -displaySize / 2);
  drawPatternToContext(patternCtx, 0, 0, displaySize, displaySize, tileImage.width * scale);
  patternCtx.restore();
  
  const maskCanvas = doc.createElement('canvas');
  maskCanvas.width = displaySize;
  maskCanvas.height = displaySize;
  const maskCtx = maskCanvas.getContext('2d');
  maskCtx.drawImage(mockupImg, 0, 0, displaySize, displaySize);
  
  const imgData = maskCtx.getImageData(0, 0, displaySize, displaySize);
  const data = imgData.data;
  
  for (let i = 0; i < data.length; i += 4) {
    if (data[i + 3] === 0) {
      data[i] = 255;
      data[i + 1] = 255;
      data[i + 2] = 255;
      data[i + 3] = 255;
    } else {
      data[i + 3] = 0;
    }
  }
  
  maskCtx.putImageData(imgData, 0, 0);
  
  patternCtx.globalCompositeOperation = 'destination-in';
  patternCtx.drawImage(maskCanvas, 0, 0);
  
  ctx.save();
  ctx.rotate(mockupRotate * Math.PI / 180);
  ctx.drawImage(patternCanvas, -displaySize / 2, -displaySize / 2);
  ctx.restore();
  
  const overlayCanvas = doc.createElement('canvas');
  overlayCanvas.width = displaySize;
  overlayCanvas.height = displaySize;
  const overlayCtx = overlayCanvas.getContext('2d');
  overlayCtx.drawImage(mockupImg, 0, 0, displaySize, displaySize);
  
  const overlayData = overlayCtx.getImageData(0, 0, displaySize, displaySize).data;
  for (let i = 0; i < overlayData.length; i += 4) {
    if (overlayData[i + 1] > 100 && overlayData[i] < 100 && overlayData[i + 2] < 100) {
      overlayData[i + 3] = 0;
    }
  }
  overlayCtx.putImageData(new ImageData(overlayData, displaySize, displaySize), 0, 0);
  
  ctx.save();
  ctx.rotate(mockupRotate * Math.PI / 180);
  ctx.drawImage(overlayCanvas, -displaySize / 2, -displaySize / 2);
  ctx.restore();
}

function draw() {
  ctx.clearRect(0, 0, els.canvas.width, els.canvas.height);
  
  if (!tileImage) {
    els.emptyState.classList.add('visible');
    els.canvas.classList.remove('has-image');
    els.exportBtn.disabled = true;
    return;
  }
  
  els.emptyState.classList.remove('visible');
  els.canvas.classList.add('has-image');
  els.exportBtn.disabled = false;
  
  const tileSize = tileImage.width * scale;
  const showGrid = viewMode === 'tile-grid';
  
  ctx.imageSmoothingEnabled = true;
  ctx.imageSmoothingQuality = 'high';
  ctx.save();
  
  if (viewMode === 'tile' || viewMode === 'tile-grid') {
    ctx.translate(panX, panY);
    ctx.scale(zoom, zoom);
    
    const tilesX = Math.ceil(els.canvas.width / tileSize / zoom) + 6;
    const tilesY = Math.ceil(els.canvas.height / tileSize / zoom) + 6;
    const startTileX = Math.floor(-panX / (tileSize * zoom)) - 3;
    const startTileY = Math.floor(-panY / (tileSize * zoom)) - 3;
    
    for (let i = startTileX; i < startTileX + tilesX; i++) {
      for (let j = startTileY; j < startTileY + tilesY; j++) {
        let drawX = i * tileSize + offsetPercentX * tileSize;
        let drawY = j * tileSize + offsetPercentY * tileSize;
        
        if (repeatType === 'half-drop') {
          drawY += (Math.abs(i) % 2 === 1) ? tileSize / 2 : 0;
        } else if (repeatType === 'brick') {
          drawX += (Math.abs(j) % 2 === 1) ? tileSize / 2 : 0;
        }
        
        ctx.drawImage(tileImage, drawX, drawY, tileSize, tileSize);
      }
    }
    
    if (showGrid) {
      ctx.strokeStyle = 'rgba(255,255,255,0.4)';
      ctx.lineWidth = 1 / zoom;
      
      for (let i = startTileX; i < startTileX + tilesX + 1; i++) {
        let lineX = i * tileSize + offsetPercentX * tileSize;
        ctx.beginPath();
        ctx.moveTo(lineX, startTileY * tileSize - tileSize);
        ctx.lineTo(lineX, (startTileY + tilesY + 1) * tileSize);
        ctx.stroke();
      }
      
      for (let j = startTileY; j < startTileY + tilesY + 1; j++) {
        let lineY = j * tileSize + offsetPercentY * tileSize;
        ctx.beginPath();
        ctx.moveTo(startTileX * tileSize - tileSize, lineY);
        ctx.lineTo((startTileX + tilesX + 1) * tileSize, lineY);
        ctx.stroke();
      }
    }
    
    if (seamlessTestMode) {
      drawSeamlessTest(tileSize);
    }
    
    if (gridOverlaySize > 0) {
      drawGridOverlay(tileSize);
    }
    
  } else {
    ctx.translate(els.canvas.width / 2, els.canvas.height / 2);
    
    const mockups = {
      phone: mockupImages.phone,
      ipad: mockupImages.ipad,
      tote: mockupImages.tote,
      bandana: mockupImages.bandana,
      bedspread: mockupImages.bedspread,
      mug: mockupImages.mug,
      bottle: mockupImages.bottle
    };
    
    if (mockups[viewMode]) {
      drawMockup(mockups[viewMode]);
    } else if (viewMode === 'fabric') {
      const maxSize = Math.min(els.canvas.width, els.canvas.height) * 0.6;
      const fabricWidth = maxSize * 0.95;
      const fabricHeight = fabricWidth * 0.8;
      
      ctx.save();
      roundedRect(ctx, -fabricWidth / 2, -fabricHeight / 2, fabricWidth, fabricHeight, 15);
      ctx.fillStyle = '#2a2a2a';
      ctx.fill();
      ctx.strokeStyle = '#444';
      ctx.lineWidth = 2;
      ctx.stroke();
      ctx.clip();
      
      drawPatternToContext(ctx, -fabricWidth / 2, -fabricHeight / 2, fabricWidth, fabricHeight, tileSize);
      ctx.restore();
    }
  }
  
  ctx.restore();
}

function loadImage(file) {
  if (!file) return;
  
  showLoading(false);
  const reader = new FileReader();
  
  reader.onload = (e) => {
    const img = new Image();
    
    img.onload = () => {
      tileImage = img;
      scale = Math.max(0.05, Math.min(5, 300 / tileImage.width));
      
      let sliderVal;
      if (scale <= 1.0) {
        sliderVal = Math.round(((scale - 0.05) / 0.95) * 50);
      } else {
        sliderVal = Math.round(50 + ((scale - 1.0) / 4.0) * 50);
      }
      
      els.patternScale.value = sliderVal;
      els.scaleValue.textContent = scale.toFixed(2) + '√ó';
      updateBackground();
      analyzePattern();
      els.patternInfo.classList.add('visible');
      draw();
      hideLoading();
    };
    
    img.onerror = () => {
      hideLoading();
      alert('Failed to load image!');
    };
    
    img.src = e.target.result;
  };
  
  reader.readAsDataURL(file);
}

els.fileInput.addEventListener('change', (e) => loadImage(e.target.files[0]));

els.canvas.addEventListener('dragover', (e) => {
  e.preventDefault();
  els.canvas.style.opacity = '0.7';
});

els.canvas.addEventListener('dragleave', () => {
  els.canvas.style.opacity = '1';
});

els.canvas.addEventListener('drop', (e) => {
  e.preventDefault();
  els.canvas.style.opacity = '1';
  loadImage(e.dataTransfer.files[0]);
});

els.canvas.addEventListener('pointerdown', (e) => {
  if (!tileImage || (viewMode !== 'tile' && viewMode !== 'tile-grid')) return;
  isDragging = true;
  dragStartX = e.clientX - panX;
  dragStartY = e.clientY - panY;
  els.canvas.setPointerCapture(e.pointerId);
});

els.canvas.addEventListener('pointermove', (e) => {
  if (!isDragging || (viewMode !== 'tile' && viewMode !== 'tile-grid')) return;
  panX = e.clientX - dragStartX;
  panY = e.clientY - dragStartY;
  draw();
});

els.canvas.addEventListener('pointerup', () => isDragging = false);
els.canvas.addEventListener('pointerleave', () => isDragging = false);

els.canvas.addEventListener('wheel', (e) => {
  if (!tileImage) return;
  e.preventDefault();
  
  const zoomFactor = e.deltaY < 0 ? 1.1 : 0.9;
  const rect = els.canvas.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;
  
  let newZoom = Math.max(MIN_ZOOM, Math.min(MAX_ZOOM, zoom * zoomFactor));
  const scaleChange = newZoom - zoom;
  
  panX -= (mouseX - panX) * (scaleChange / zoom);
  panY -= (mouseY - panY) * (scaleChange / zoom);
  zoom = newZoom;
  
  const zoomPercent = Math.round(zoom * 100);
  
  let sliderVal;
  if (zoomPercent <= 100) {
    sliderVal = Math.round(((zoomPercent - 1) / 99) * 50);
  } else {
    sliderVal = Math.round(50 + ((zoomPercent - 100) / 700) * 50);
  }
  
  els.zoomSlider.value = sliderVal;
  els.zoomValue.textContent = zoomPercent + '%';
  draw();
}, { passive: false });

let lastTouchDistance = 0;

els.canvas.addEventListener('touchstart', (e) => {
  if (e.touches.length === 2 && tileImage) {
    e.preventDefault();
    const touch1 = e.touches[0];
    const touch2 = e.touches[1];
    lastTouchDistance = Math.hypot(touch2.clientX - touch1.clientX, touch2.clientY - touch1.clientY);
  }
}, { passive: false });

els.canvas.addEventListener('touchmove', (e) => {
  if (e.touches.length === 2 && tileImage) {
    e.preventDefault();
    const touch1 = e.touches[0];
    const touch2 = e.touches[1];
    const currentDistance = Math.hypot(touch2.clientX - touch1.clientX, touch2.clientY - touch1.clientY);
    
    if (lastTouchDistance > 0) {
      const zoomFactor = currentDistance / lastTouchDistance;
      const rect = els.canvas.getBoundingClientRect();
      const centerX = ((touch1.clientX + touch2.clientX) / 2) - rect.left;
      const centerY = ((touch1.clientY + touch2.clientY) / 2) - rect.top;
      
      let newZoom = Math.max(MIN_ZOOM, Math.min(MAX_ZOOM, zoom * zoomFactor));
      const scaleChange = newZoom - zoom;
      
      panX -= (centerX - panX) * (scaleChange / zoom);
      panY -= (centerY - panY) * (scaleChange / zoom);
      zoom = newZoom;
      
      const zoomPercent = Math.round(zoom * 100);
      
      let sliderVal;
      if (zoomPercent <= 100) {
        sliderVal = Math.round(((zoomPercent - 1) / 99) * 50);
      } else {
        sliderVal = Math.round(50 + ((zoomPercent - 100) / 700) * 50);
      }
      
      els.zoomSlider.value = sliderVal;
      els.zoomValue.textContent = zoomPercent + '%';
      draw();
    }
    
    lastTouchDistance = currentDistance;
  }
}, { passive: false });

els.canvas.addEventListener('touchend', () => lastTouchDistance = 0);

els.repeatType.addEventListener('change', (e) => {
  repeatType = e.target.value;
  draw();
});

els.viewMode.addEventListener('change', (e) => {
  viewMode = e.target.value;
  draw();
});

els.bgColor.addEventListener('change', (e) => {
  backgroundColor = e.target.value;
  updateBackground();
  draw();
});

els.patternScale.addEventListener('input', (e) => {
  const sliderVal = parseInt(e.target.value);
  
  if (sliderVal <= 50) {
    scale = 0.05 + (sliderVal / 50) * 0.95;
  } else {
    scale = 1.0 + ((sliderVal - 50) / 50) * 4.0;
  }
  
  els.scaleValue.textContent = scale.toFixed(2) + '√ó';
  draw();
});

els.patternScale.addEventListener('change', (e) => {
  const sliderVal = parseInt(e.target.value);
  
  if (sliderVal <= 50) {
    scale = 0.05 + (sliderVal / 50) * 0.95;
  } else {
    scale = 1.0 + ((sliderVal - 50) / 50) * 4.0;
  }
  
  scale = snapScale(scale);
  
  let newSliderVal;
  if (scale <= 1.0) {
    newSliderVal = Math.round(((scale - 0.05) / 0.95) * 50);
  } else {
    newSliderVal = Math.round(50 + ((scale - 1.0) / 4.0) * 50);
  }
  
  els.patternScale.value = newSliderVal;
  els.scaleValue.textContent = scale.toFixed(2) + '√ó';
  draw();
});

els.zoomSlider.addEventListener('input', (e) => {
  const sliderVal = parseInt(e.target.value);
  
  if (sliderVal <= 50) {
    zoom = (1 + (sliderVal / 50) * 99) / 100;
  } else {
    zoom = (100 + ((sliderVal - 50) / 50) * 700) / 100;
  }
  
  els.zoomValue.textContent = Math.round(zoom * 100) + '%';
  draw();
});

els.zoomSlider.addEventListener('change', (e) => {
  const sliderVal = parseInt(e.target.value);
  
  if (sliderVal <= 50) {
    zoom = (1 + (sliderVal / 50) * 99) / 100;
  } else {
    zoom = (100 + ((sliderVal - 50) / 50) * 700) / 100;
  }
  
  const zoomPercent = Math.round(zoom * 100);
  const snapped = snapZoom(zoomPercent);
  zoom = snapped / 100;
  
  let newSliderVal;
  if (snapped <= 100) {
    newSliderVal = Math.round(((snapped - 1) / 99) * 50);
  } else {
    newSliderVal = Math.round(50 + ((snapped - 100) / 700) * 50);
  }
  
  els.zoomSlider.value = newSliderVal;
  els.zoomValue.textContent = snapped + '%';
  draw();
});

els.offsetX.addEventListener('input', (e) => {
  offsetPercentX = parseInt(e.target.value) / 100;
  els.offsetXValue.textContent = e.target.value + '%';
  draw();
});

els.offsetX.addEventListener('change', (e) => {
  const snapped = snap(parseInt(e.target.value), 10);
  offsetPercentX = snapped / 100;
  els.offsetX.value = snapped;
  els.offsetXValue.textContent = snapped + '%';
  draw();
});

els.offsetY.addEventListener('input', (e) => {
  offsetPercentY = parseInt(e.target.value) / 100;
  els.offsetYValue.textContent = e.target.value + '%';
  draw();
});

els.offsetY.addEventListener('change', (e) => {
  const snapped = snap(parseInt(e.target.value), 10);
  offsetPercentY = snapped / 100;
  els.offsetY.value = snapped;
  els.offsetYValue.textContent = snapped + '%';
  draw();
});

els.mockupZoom.addEventListener('input', (e) => {
  mockupZoom = parseInt(e.target.value) / 100;
  els.mockupZoomValue.textContent = e.target.value + '%';
  draw();
});

els.mockupRotate.addEventListener('input', (e) => {
  mockupRotate = parseInt(e.target.value);
  els.mockupRotateValue.textContent = e.target.value + '¬∞';
  draw();
});

draw();
</script>
</body>
</html>
