<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>Watcher by Rudeboy‚Ñ¢</title>

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --accent-purple: #764ba2;
      --accent-green: #10b981;
      --accent-red: #ef4444;
      --glass-bg: rgba(30, 30, 50, 0.35);
      --poster-glow: 0 0 20px rgba(118, 75, 162, 0.4);
      --hover-glow: 0 25px 50px rgba(0,0,0,0.6), 0 0 40px rgba(118,75,162,0.6);
      --title-glow: 0 0 15px rgba(118, 75, 162, 0.3), 0 0 30px rgba(16, 185, 129, 0.2);
      --card-gap: 1.2rem;
      --section-padding: 0 1rem;
    }

    * { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0; 
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: linear-gradient(135deg, #000 0%, #0a0a1a 50%, #1a1a2e 100%);
      color: #f0f0f5;
      min-height: 100vh;
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    }

    h1, h2, .title-text { 
      font-family: 'Bebas Neue', cursive; 
      letter-spacing: 1.8px; 
    }

    #loading-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.94);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.5s;
    }
    #loading-overlay.hidden { 
      opacity: 0; 
      pointer-events: none; 
    }

    .loader-logo { 
      width: 110px; 
      animation: spin-glow 4s linear infinite; 
    }
    @keyframes spin-glow {
      0%, 100% { 
        filter: drop-shadow(0 0 14px var(--accent-green)); 
        transform: rotate(0deg);
      }
      50% { 
        filter: drop-shadow(0 0 32px var(--accent-purple)); 
        transform: rotate(180deg);
      }
    }

    .loader-text { 
      margin-top: 1.8rem; 
      font-size: 1.5rem; 
      font-weight: 600; 
    }

    #header {
      padding: 1rem 1.5rem;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(50px);
      border-bottom: 1px solid rgba(118,75,162,0.25);
    }

    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    /* Logo with glow */
    #logo { 
      height: 44px;
      filter: drop-shadow(0 0 12px rgba(118, 75, 162, 0.6));
      transition: filter 0.3s;
      cursor: pointer;
    }

    #logo:hover {
      filter: drop-shadow(0 0 20px rgba(16, 185, 129, 0.8));
      animation: pulse-logo 0.5s ease-in-out;
    }

    @keyframes pulse-logo {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .title-text { 
      font-size: 2rem; 
      margin: 0;
      transition: all 0.3s;
      text-shadow: var(--title-glow);
    }

    .title-text.adult-mode {
      color: var(--accent-red);
      text-shadow: 0 0 20px rgba(239, 68, 68, 0.6), 0 0 40px rgba(239, 68, 68, 0.3);
    }

    #mode-indicator {
      font-size: 2rem;
      display: none;
      animation: pulse-glow 2s infinite;
      cursor: default;
    }

    #mode-indicator.active {
      display: block;
    }

    @keyframes pulse-glow {
      0%, 100% { 
        filter: drop-shadow(0 0 10px rgba(239,68,68,0.6)); 
      }
      50% { 
        filter: drop-shadow(0 0 20px rgba(239,68,68,0.9)); 
      }
    }

    #search-container {
      width: 100%;
      position: relative;
    }

    #search-input {
      width: 100%;
      padding: 0.9rem 1.2rem;
      font-size: 1rem;
      background: var(--glass-bg);
      border: 1px solid rgba(118,75,162,0.5);
      border-radius: 999px;
      color: white;
      backdrop-filter: blur(20px);
      transition: all 0.3s;
      line-height: 1.2;
    }

    #search-input:focus {
      outline: none;
      border-color: var(--accent-green);
      box-shadow: 0 0 20px rgba(16,185,129,0.3);
    }

    #search-input::placeholder {
      color: rgba(255,255,255,0.5);
    }

    section { 
      padding: var(--section-padding); 
      margin-bottom: 2rem;
    }

    /* Section titles with glow */
    h2 {
      font-size: 2.2rem;
      margin: 0.5rem 0 1rem;
      background: linear-gradient(90deg, var(--accent-green), var(--accent-purple));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-transform: none;
      text-shadow: var(--title-glow);
      filter: drop-shadow(0 0 12px rgba(118, 75, 162, 0.4)) drop-shadow(0 0 20px rgba(16, 185, 129, 0.3));
    }

    .horizontal-scroll {
      display: flex;
      overflow-x: auto;
      gap: var(--card-gap);
      padding: 0.5rem 0 1.5rem;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
    }

    .horizontal-scroll::-webkit-scrollbar {
      height: 6px;
    }

    .horizontal-scroll::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
    }

    .horizontal-scroll::-webkit-scrollbar-thumb {
      background: var(--accent-purple);
      border-radius: 10px;
    }

    .horizontal-scroll .card { 
      flex: 0 0 100px;
      scroll-snap-align: start; 
    }

    .card {
      background: var(--glass-bg);
      border: 1px solid rgba(118,75,162,0.35);
      border-radius: 16px;
      overflow: hidden;
      backdrop-filter: blur(16px);
      transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      position: relative;
    }

    .card:hover {
      transform: translateY(-10px) scale(1.05);
      box-shadow: var(--hover-glow);
      border-color: var(--accent-green);
    }

    .poster { 
      width: 100%; 
      aspect-ratio: 2/3; 
      object-fit: cover; 
      background: #111;
      display: block;
      filter: drop-shadow(var(--poster-glow));
      transition: filter 0.35s;
      border-radius: 0;
    }

    .card:hover .poster {
      filter: drop-shadow(0 0 30px rgba(118,75,162,0.7));
    }

    .backdrop {
      width: 100%;
      aspect-ratio: 16/9;
      object-fit: cover;
      background: #111;
      filter: drop-shadow(var(--poster-glow));
    }

    .info {
      padding: 0.4rem 0.9rem 0.5rem;
      text-align: center;
      min-height: 2.2rem;
    }

    .card-title {
      display: none;
    }

    .year {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--accent-green);
      opacity: 1;
      line-height: 1.2;
    }

    .poster-placeholder {
      width: 100%;
      aspect-ratio: 2/3;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: rgba(255,255,255,0.3);
      font-size: 0.75rem;
      text-align: center;
      padding: 1rem;
    }

    .card.highlight {
      border: 2px solid var(--accent-green);
      box-shadow: 0 0 20px rgba(16,185,129,0.6);
    }

    #detail-view {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.96);
      backdrop-filter: blur(12px);
      z-index: 1000;
      display: none;
      overflow-y: auto;
      padding: 1rem;
      animation: fadeIn 0.3s;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    #detail-view.active {
      display: block;
    }

    #detail-content {
      background: rgba(20,20,40,0.9);
      border: 1px solid rgba(118,75,162,0.3);
      border-radius: 20px;
      padding: 2rem 1.5rem;
      max-width: 1000px;
      margin: 0 auto;
      position: relative;
    }

    #detail-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      font-size: 2.5rem;
      color: var(--accent-green);
      cursor: pointer;
      transition: transform 0.2s;
      z-index: 10;
      line-height: 1;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #detail-close:hover {
      transform: rotate(90deg) scale(1.2);
    }

    #detail-content h2 {
      font-size: 1.25rem;
      margin-bottom: 1rem;
      text-shadow: var(--title-glow);
    }

    #detail-content h3 {
      font-size: 1.8rem;
      margin-top: 2rem;
      margin-bottom: 1rem;
      color: var(--accent-green);
      font-family: 'Bebas Neue', cursive;
      letter-spacing: 1.5px;
      text-shadow: 0 0 10px rgba(16, 185, 129, 0.4);
    }

    .rating {
      display: inline-block;
      background: rgba(16,185,129,0.2);
      color: var(--accent-green);
      padding: 0.4rem 0.8rem;
      border-radius: 8px;
      font-weight: 700;
      margin-left: 1rem;
      font-size: 0.9rem;
    }

    .overview {
      line-height: 1.4;
      margin: 1rem 0;
      color: rgba(255,255,255,0.9);
      font-size: 0.8rem;
    }

    .trailer-container {
      margin: 2rem 0;
      aspect-ratio: 16/9;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
      background: #000;
    }

    .trailer-container iframe,
    .trailer-container video {
      width: 100%;
      height: 100%;
      border: none;
    }

    /* ACTOR CREDITS - VERTICAL GRID (not horizontal scroll) */
    .credits-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 1rem;
      padding: 1rem 0;
    }

    .credits-grid .card {
      flex: none;
    }

    /* Filter buttons for actor credits */
    .filter-buttons {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 0.5rem 1rem;
      background: rgba(118,75,162,0.2);
      color: var(--accent-purple);
      border: 1px solid rgba(118,75,162,0.5);
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .filter-btn:hover {
      background: rgba(118,75,162,0.3);
      border-color: var(--accent-purple);
    }

    .filter-btn.active {
      background: var(--accent-green);
      color: #000;
      border-color: var(--accent-green);
    }

    .actor-profile {
      text-align: center;
      margin-bottom: 2rem;
    }

    .actor-profile img {
      max-width: 240px;
      border-radius: 12px;
      margin: 1rem auto;
      display: block;
      border: 2px solid rgba(118,75,162,0.5);
      box-shadow: 0 0 30px rgba(118, 75, 162, 0.4);
    }

    .seasons-accordion {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin: 1rem 0;
    }

    .season-item {
      background: rgba(30,30,50,0.5);
      border-radius: 12px;
      border: 1px solid rgba(118,75,162,0.3);
      overflow: hidden;
      transition: all 0.3s;
    }

    .season-header {
      padding: 1rem;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background 0.3s;
    }

    .season-header:hover {
      background: rgba(118,75,162,0.2);
    }

    .season-item.active .season-header {
      background: rgba(16,185,129,0.1);
      border-bottom: 1px solid rgba(118,75,162,0.3);
    }

    .season-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--accent-green);
    }

    .season-info {
      font-size: 0.85rem;
      color: rgba(255,255,255,0.7);
      margin-top: 0.25rem;
    }

    .season-arrow {
      font-size: 1.5rem;
      color: var(--accent-purple);
      transition: transform 0.3s;
    }

    .season-item.active .season-arrow {
      transform: rotate(180deg);
    }

    .episodes-list {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
    }

    .season-item.active .episodes-list {
      max-height: 5000px;
      transition: max-height 0.5s ease-in;
    }

    .episodes-content {
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .episode-item {
      background: rgba(20,20,40,0.6);
      padding: 1rem;
      border-radius: 10px;
      border-left: 3px solid var(--accent-purple);
    }

    .episode-number {
      font-size: 0.75rem;
      color: var(--accent-green);
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .episode-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .episode-overview {
      font-size: 0.85rem;
      color: rgba(255,255,255,0.7);
      line-height: 1.4;
    }

    .episode-air-date {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.5);
      margin-top: 0.5rem;
    }

    .image-gallery {
      margin: 3rem 0 1rem;
    }

    .gallery-scroll {
      display: flex;
      gap: 1rem;
      overflow-x: auto;
      padding: 1rem 0;
      scroll-snap-type: x mandatory;
    }

    .gallery-image {
      flex: 0 0 200px;
      height: 300px;
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.3s;
      scroll-snap-align: start;
      border: 2px solid rgba(118,75,162,0.3);
    }

    .gallery-image:hover {
      transform: scale(1.05);
      border-color: var(--accent-green);
    }

    .gallery-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .recommendations-scroll {
      display: flex;
      gap: 1rem;
      overflow-x: auto;
      padding: 1rem 0;
    }

    .recommendation-card {
      flex: 0 0 120px;
      cursor: pointer;
    }

    .btn {
      display: inline-block;
      padding: 0.8rem 1.5rem;
      background: var(--accent-green);
      color: #000;
      font-weight: 700;
      border-radius: 999px;
      text-decoration: none;
      border: none;
      cursor: pointer;
      transition: all 0.3s;
      margin: 0.5rem 0.5rem 0.5rem 0;
    }

    .btn:hover {
      background: var(--accent-purple);
      color: #fff;
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(118,75,162,0.4);
    }
    .weather-widget {
      display: none;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.65rem 0.75rem;
      margin-bottom: 1rem;
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(40px) saturate(180%) brightness(1.1);
      -webkit-backdrop-filter: blur(40px) saturate(180%) brightness(1.1);
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.2);
      box-shadow: 0 4px 20px rgba(0,0,0,0.3), inset 0 2px 0 rgba(255,255,255,0.3), inset 0 -2px 0 rgba(0,0,0,0.2);
      font-size: 0.8rem;
      animation: weather-glow 4s ease-in-out infinite;
      max-width: 100%;
      flex-wrap: wrap;
    }

    @keyframes weather-glow {
      0%, 100% { 
        box-shadow: 0 4px 20px rgba(0,0,0,0.3), 0 0 15px rgba(118,75,162,0.4), 
                    inset 0 2px 0 rgba(255,255,255,0.3), inset 0 -2px 0 rgba(0,0,0,0.2); 
      }
      50% { 
        box-shadow: 0 4px 20px rgba(0,0,0,0.3), 0 0 15px rgba(16,185,129,0.4), 
                    inset 0 2px 0 rgba(255,255,255,0.3), inset 0 -2px 0 rgba(0,0,0,0.2); 
      }
    }

    .weather-widget.visible { display: flex; }
    .weather-widget.loading { opacity: 0.6; }

    .weather-icon-temp { 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      gap: 0.15rem; 
      flex-shrink: 0; 
    }

    .weather-icon { 
      font-size: 1.1rem; 
      line-height: 1; 
      flex-shrink: 0; 
    }

    .weather-temp {
      font-size: 0.85rem;
      font-weight: 700;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      flex-shrink: 0;
      white-space: nowrap;
    }

    .weather-time-wrapper { 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      flex-shrink: 0; 
    }

    .weather-time { 
      font-size: 0.8rem; 
      font-weight: 600; 
      color: var(--accent-green); 
      white-space: nowrap; 
    }

    .weather-divider { 
      color: rgba(255,255,255,0.3); 
      font-weight: 300; 
      flex-shrink: 0; 
    }

    .weather-condition-wrapper { 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      text-align: center; 
      max-width: 70px; 
      flex-shrink: 1; 
    }

    .weather-condition {
      font-size: 0.7rem;
      font-weight: 600;
      animation: condition-glow 4s ease-in-out infinite;
      word-wrap: break-word;
      line-height: 1.1;
    }

    @keyframes condition-glow {
      0%, 100% { 
        color: #764ba2; 
        text-shadow: 0 0 10px rgba(118,75,162,0.6); 
      }
      50% { 
        color: #10b981; 
        text-shadow: 0 0 10px rgba(16,185,129,0.6); 
      }
    }

    .weather-location-wrapper { 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      text-align: center; 
      max-width: 70px; 
      flex-shrink: 1; 
    }

    .weather-location {
      font-size: 0.7rem;
      font-weight: 600;
      animation: location-glow 4s ease-in-out infinite;
      word-wrap: break-word;
      line-height: 1.1;
    }

    @keyframes location-glow {
      0%, 100% { 
        color: #10b981; 
        text-shadow: 0 0 8px rgba(16,185,129,0.6); 
      }
      50% { 
        color: #764ba2; 
        text-shadow: 0 0 8px rgba(118,75,162,0.6); 
      }
    }

    /* Trailers horizontal scroll - LIMITED TO 5 */
    .trailers-scroll {
      display: flex;
      gap: 1rem;
      overflow-x: auto;
      padding: 1rem 0;
      scroll-snap-type: x mandatory;
    }

    .trailers-scroll .trailer-container {
      flex: 0 0 400px;
      scroll-snap-align: start;
      margin: 0;
    }

    @media (max-width: 768px) {
      .trailers-scroll .trailer-container {
        flex: 0 0 300px;
      }
    }

    #footer {
      padding: 2rem;
      text-align: center;
      background: rgba(0,0,0,0.55);
      backdrop-filter: blur(50px);
      border-top: 1px solid rgba(118,75,162,0.3);
      margin-top: 3rem;
    }

    #easterEgg {
      font-weight: 700;
      font-size: 1.4rem;
      cursor: pointer;
      background: linear-gradient(90deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      transition: transform 0.3s;
      display: inline-block;
    }

    #easterEgg:hover {
      transform: scale(1.1);
    }

    #easter-egg-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.98);
      backdrop-filter: blur(35px);
      z-index: 2000;
      display: none;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      cursor: pointer;
    }

    #easter-egg-overlay.active {
      display: flex;
    }

    .matrix-canvas { 
      position: absolute; 
      inset: 0; 
    }

    @media (max-width: 768px) {
      .header-top {
        flex-wrap: wrap;
      }

      .title-text {
        font-size: 1.5rem;
      }

      h2 {
        font-size: 1.8rem;
      }

      #detail-content {
        padding: 1.5rem 1rem;
      }

      .credits-grid {
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      }
    }
  </style>
</head>
<body>

  <div id="loading-overlay">
    <img class="loader-logo" src="https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/icons/icon.png" alt="Rudeboy">
    <div class="loader-text">Loading Watcher...</div>
  </div>

  <div id="header">
    <div class="header-top">
      <div class="header-left">
        <img id="logo" src="https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/icons/icon.png" alt="Rudeboy" title="Click to refresh">
        <h1 class="title-text" id="app-title">Watcher</h1>
      </div>
      <div id="mode-indicator">üîû</div>
    </div>

    <div id="search-container">
      <input 
        type="text" 
        id="search-input" 
        placeholder="Search movies, TV, actors, or year..." 
        autocomplete="off"
      />
    </div>
  </div>

  <!-- NORMAL MODE SECTIONS -->
  
  <section id="section-digital">
    <h2>Latest Digital Releases</h2>
    <div class="horizontal-scroll" id="digital-grid"></div>
  </section>

  <section id="section-airing">
    <h2>Airing Today</h2>
    <div class="horizontal-scroll" id="airing-grid"></div>
  </section>

  <section id="section-best-month">
    <h2>Best of the Month</h2>
    <div class="horizontal-scroll" id="best-month-grid"></div>
  </section>

  <section id="section-trending">
    <h2>Trending This Week</h2>
    <div class="horizontal-scroll" id="trending-grid"></div>
  </section>

  <section id="section-top-tv">
    <h2>Top TV This Week</h2>
    <div class="horizontal-scroll" id="top-tv-grid"></div>
  </section>

  <!-- ADULT MODE SECTIONS -->
  
  <section id="section-adult-new" style="display:none;">
    <h2>üîû New XXX Releases</h2>
    <div class="horizontal-scroll" id="adult-new-grid"></div>
  </section>

  <section id="section-adult-popular" style="display:none;">
    <h2>üîû Popular XXX</h2>
    <div class="horizontal-scroll" id="adult-popular-grid"></div>
  </section>

  <section id="section-adult-toprated" style="display:none;">
    <h2>üîû Top Rated XXX</h2>
    <div class="horizontal-scroll" id="adult-toprated-grid"></div>
  </section>

  <section id="section-adult-trending" style="display:none;">
    <h2>üîû Trending XXX</h2>
    <div class="horizontal-scroll" id="adult-trending-grid"></div>
  </section>

  <div id="detail-view">
    <div id="detail-content">
      <span id="detail-close">√ó</span>
      <div id="detail-body"></div>
    </div>
  </div>

  <div id="footer">
    <div class="weather-widget" id="weatherWidget">
      <div class="weather-icon-temp">
        <span class="weather-icon" id="weatherIcon">üå§Ô∏è</span>
        <span class="weather-temp" id="weatherTemp">--¬∞</span>
      </div>
      <span class="weather-divider">|</span>
      <div class="weather-time-wrapper">
        <span class="weather-time" id="weatherTime">--:--</span>
      </div>
      <span class="weather-divider">|</span>
      <div class="weather-condition-wrapper">
        <span class="weather-condition" id="weatherCondition">Loading...</span>
      </div>
      <span class="weather-divider">|</span>
      <div class="weather-location-wrapper">
        <span class="weather-location" id="weatherLocation">--</span>
      </div>
    </div>

    <div id="easterEgg">Created by Rudeboy‚Ñ¢</div>
  </div>

  <div id="easter-egg-overlay">
    <canvas id="matrixCanvas" class="matrix-canvas"></canvas>
  </div>

  <audio id="easterAudio" preload="none"></audio>
  <script>
    const TMDB_KEY = "e39f22e3483a5eac3cc41faf13d05194";
    const FANART_KEY = "9cd6959542f3be1a6abf078871f18d2e";
    
    const TMDB_BASE = "https://api.themoviedb.org/3";
    const TMDB_IMG = "https://image.tmdb.org/t/p/w500";
    const YT_EMBED = "https://www.youtube.com/embed/";

    let isAdultMode = localStorage.getItem('adultMode') === 'true';
    let currentMovieId = null;
    let searchTimeout = null;

    function showLoader() {
      document.getElementById('loading-overlay').classList.remove('hidden');
    }

    function hideLoader() {
      document.getElementById('loading-overlay').classList.add('hidden');
    }

    // Logo click to refresh
    document.getElementById('logo').onclick = () => {
      location.reload();
    };

    async function tmdb(endpoint, params = {}) {
      const url = new URL(`${TMDB_BASE}${endpoint}`);
      url.searchParams.set('api_key', TMDB_KEY);
      url.searchParams.set('language', 'en-US');
      url.searchParams.set('include_adult', 'false');

      Object.entries(params).forEach(([k, v]) => {
        if (!url.searchParams.has(k)) {
          url.searchParams.set(k, v);
        }
      });

      const res = await fetch(url);
      if (!res.ok) throw new Error(`TMDB ${res.status}`);
      return res.json();
    }

    async function tmdbAdult(endpoint, params = {}) {
      const url = new URL(`${TMDB_BASE}${endpoint}`);
      url.searchParams.set('api_key', TMDB_KEY);
      url.searchParams.set('language', 'en-US');
      url.searchParams.set('include_adult', 'true');

      Object.entries(params).forEach(([k, v]) => {
        if (!url.searchParams.has(k)) {
          url.searchParams.set(k, v);
        }
      });

      const res = await fetch(url);
      if (!res.ok) throw new Error(`TMDB ${res.status}`);
      return res.json();
    }

    async function getImageUrl(item, type = 'poster') {
      if (type === 'poster' && item.poster_path) {
        return `${TMDB_IMG}${item.poster_path}`;
      }

      if (item.backdrop_path) {
        return `${TMDB_IMG}${item.backdrop_path}`;
      }

      try {
        const mediaType = item.media_type === 'tv' ? 'tv' : 'movies';
        const fanartUrl = `https://webservice.fanart.tv/v3/${mediaType}/${item.id}?api_key=${FANART_KEY}`;
        const response = await fetch(fanartUrl);
        
        if (response.ok) {
          const data = await response.json();
          
          if (data.movieposter && data.movieposter[0]) {
            return data.movieposter[0].url;
          }
          if (data.tvposter && data.tvposter[0]) {
            return data.tvposter[0].url;
          }
          if (data.moviebackground && data.moviebackground[0]) {
            return data.moviebackground[0].url;
          }
          if (data.showbackground && data.showbackground[0]) {
            return data.showbackground[0].url;
          }
        }
      } catch (err) {
        console.log('Fanart.tv fallback failed:', err);
      }

      return null;
    }

    async function renderHorizontal(gridId, items) {
      const grid = document.getElementById(gridId);
      if (!grid) return;
      
      grid.innerHTML = '';

      for (const item of items) {
        const title = item.title || item.name || 'Unknown';
        const year = (item.release_date || item.first_air_date || '').slice(0, 4);
        const imageUrl = await getImageUrl(item);

        const card = document.createElement('div');
        card.className = 'card';

        if (imageUrl) {
          card.innerHTML = `
            <img class="poster" src="${imageUrl}" loading="lazy" alt="${title}">
            <div class="info">
              ${year ? `<div class="year">${year}</div>` : ''}
            </div>
          `;
        } else {
          card.innerHTML = `
            <div class="poster-placeholder">
              <span>No Image</span>
            </div>
            <div class="info">
              ${year ? `<div class="year">${year}</div>` : ''}
            </div>
          `;
        }

        card.onclick = () => openDetail(item);
        grid.appendChild(card);
      }
    }

    async function loadSection(endpoint, params, gridId, maxPages = 3, useAdultAPI = false) {
      let allResults = [];
      
      for (let page = 1; page <= maxPages; page++) {
        try {
          const apiFunc = useAdultAPI ? tmdbAdult : tmdb;
          const { results } = await apiFunc(endpoint, { ...params, page });
          allResults = allResults.concat(results || []);
        } catch (err) {
          console.error(`Failed to load page ${page}:`, err);
          break;
        }
      }

      await renderHorizontal(gridId, allResults);
    }

    async function loadAdultSections() {
      console.log('Loading TMDB adult content...');
      
      const today = new Date().toISOString().split('T')[0];
      const monthAgo = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];

      try {
        await Promise.all([
          loadSection('/discover/movie', {
            'sort_by': 'release_date.desc',
            'primary_release_date.lte': today,
            'primary_release_date.gte': monthAgo
          }, 'adult-new-grid', 3, true),

          loadSection('/movie/popular', {}, 'adult-popular-grid', 3, true),

          loadSection('/movie/top_rated', {}, 'adult-toprated-grid', 3, true),

          loadSection('/trending/movie/week', {}, 'adult-trending-grid', 3, true)
        ]);
      } catch (err) {
        console.error('Failed to load adult sections:', err);
      }
    }

    async function loadHome() {
      showLoader();

      const today = new Date().toISOString().split('T')[0];
      const monthAgo = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];

      try {
        if (isAdultMode) {
          document.getElementById('section-digital').style.display = 'none';
          document.getElementById('section-airing').style.display = 'none';
          document.getElementById('section-best-month').style.display = 'none';
          document.getElementById('section-trending').style.display = 'none';
          document.getElementById('section-top-tv').style.display = 'none';
          
          document.getElementById('section-adult-new').style.display = 'block';
          document.getElementById('section-adult-popular').style.display = 'block';
          document.getElementById('section-adult-toprated').style.display = 'block';
          document.getElementById('section-adult-trending').style.display = 'block';
          
          await loadAdultSections();
        } else {
          document.getElementById('section-adult-new').style.display = 'none';
          document.getElementById('section-adult-popular').style.display = 'none';
          document.getElementById('section-adult-toprated').style.display = 'none';
          document.getElementById('section-adult-trending').style.display = 'none';
          
          document.getElementById('section-digital').style.display = 'block';
          document.getElementById('section-airing').style.display = 'block';
          document.getElementById('section-best-month').style.display = 'block';
          document.getElementById('section-trending').style.display = 'block';
          document.getElementById('section-top-tv').style.display = 'block';

          await Promise.all([
            loadSection('/discover/movie', {
              'sort_by': 'release_date.desc',
              'with_release_type': '4',
              'primary_release_date.lte': today,
              'primary_release_date.gte': monthAgo
            }, 'digital-grid'),

            loadSection('/tv/airing_today', {}, 'airing-grid'),

            loadSection('/discover/movie', {
              'sort_by': 'vote_average.desc',
              'vote_count.gte': '50',
              'primary_release_date.gte': monthAgo,
              'primary_release_date.lte': today
            }, 'best-month-grid'),

            loadSection('/trending/all/week', {}, 'trending-grid'),

            loadSection('/trending/tv/week', {}, 'top-tv-grid')
          ]);
        }

      } catch (err) {
        console.error('Error loading home:', err);
      }

      hideLoader();
    }

    function openDetail(item) {
      if (item.media_type === 'person' || item.known_for_department) {
        openActorDetail(item.id);
      } else if (item.media_type === 'tv' || item.first_air_date) {
        openTVDetail(item.id);
      } else {
        openMovieDetail(item.id);
      }
    }
        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       MOVIE DETAIL VIEW - ALL backdrops with correct orientation
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

    async function openMovieDetail(movieId) {
      currentMovieId = movieId;
      showLoader();

      try {
        const apiFunc = isAdultMode ? tmdbAdult : tmdb;
        const data = await apiFunc(`/movie/${movieId}`, {
          append_to_response: 'credits,videos,images,recommendations'
        });

        const title = data.title || 'Unknown';
        const rating = data.vote_average ? data.vote_average.toFixed(1) : 'N/A';
        const overview = data.overview || 'No overview available.';
        const allTrailers = data.videos?.results?.filter(v => v.site === 'YouTube') || [];
        const trailers = allTrailers.slice(0, 5);
        const cast = data.credits?.cast || [];
        const posters = data.images?.posters || []; // ALL posters
        const backdrops = data.images?.backdrops || []; // ALL backdrops
        const recommendations = data.recommendations?.results?.slice(0, 10) || [];

        let html = `
          <h2>${title} <span class="rating">${rating}‚òÖ</span></h2>
          <p class="overview">${overview}</p>
        `;

        // TRAILERS
        if (trailers.length > 0) {
          html += '<h3>Trailers</h3>';
          html += '<div class="trailers-scroll">';
          trailers.forEach((trailer) => {
            html += `
              <div class="trailer-container">
                <iframe
                  src="${YT_EMBED}${trailer.key}?rel=0&playsinline=1"
                  frameborder="0"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen>
                </iframe>
              </div>
            `;
          });
          html += '</div>';
        }

        // CAST
        if (cast.length > 0) {
          html += '<h3>Cast</h3>';
          html += '<div class="credits-grid" id="cast-grid"></div>';
        }

        // RECOMMENDATIONS
        if (recommendations.length > 0) {
          html += '<h3>You Might Also Like</h3><div class="recommendations-scroll" id="recommendations-scroll"></div>';
        }

        // ALL POSTERS & BACKDROPS - WITH CORRECT ORIENTATION
        if (posters.length > 0 || backdrops.length > 0) {
          html += '<div class="image-gallery">';
          
          // POSTERS - Vertical (portrait)
          if (posters.length > 0) {
            html += `<h3>Posters (${posters.length})</h3><div class="gallery-scroll">`;
            posters.forEach(img => {
              const isPortrait = img.aspect_ratio < 1; // aspect_ratio < 1 = portrait
              const height = isPortrait ? '300px' : 'auto';
              const width = isPortrait ? 'auto' : '300px';
              
              html += `
                <div class="gallery-image" style="width: ${width}; height: ${height};">
                  <img src="${TMDB_IMG}${img.file_path}" alt="Poster" style="object-fit: contain;">
                </div>
              `;
            });
            html += '</div>';
          }

          // BACKDROPS - Horizontal (landscape) or Vertical based on aspect ratio
          if (backdrops.length > 0) {
            html += `<h3>Backdrops (${backdrops.length})</h3><div class="gallery-scroll">`;
            backdrops.forEach(img => {
              const isLandscape = img.aspect_ratio > 1; // aspect_ratio > 1 = landscape
              const height = isLandscape ? '200px' : '300px';
              const width = isLandscape ? 'auto' : '200px';
              
              html += `
                <div class="gallery-image" style="width: ${width}; height: ${height};">
                  <img src="${TMDB_IMG}${img.file_path}" alt="Backdrop" style="object-fit: contain;">
                </div>
              `;
            });
            html += '</div>';
          }

          html += '</div>';
        }

        html += '<button class="btn" id="back-btn">Back to Browse</button>';

        document.getElementById('detail-body').innerHTML = html;
        document.getElementById('detail-view').classList.add('active');

        // Render cast
        if (cast.length > 0) {
          const castGrid = document.getElementById('cast-grid');
          for (const actor of cast) {
            const card = document.createElement('div');
            card.className = 'card';
            const actorImg = actor.profile_path ? TMDB_IMG + actor.profile_path : '';
            
            if (actorImg) {
              card.innerHTML = `
                <img class="poster" src="${actorImg}" loading="lazy" alt="${actor.name}">
                <div class="info">
                  <div class="year" style="font-size: 0.65rem;">${actor.name}</div>
                </div>
              `;
            } else {
              card.innerHTML = `
                <div class="poster-placeholder">
                  <span style="font-size: 0.6rem;">${actor.name}</span>
                </div>
              `;
            }
            
            card.onclick = () => openActorDetail(actor.id);
            castGrid.appendChild(card);
          }
        }

        // Render recommendations
        if (recommendations.length > 0) {
          const recScroll = document.getElementById('recommendations-scroll');
          for (const rec of recommendations) {
            const recCard = document.createElement('div');
            recCard.className = 'recommendation-card';
            const recImg = await getImageUrl(rec);
            recCard.innerHTML = `
              <img class="poster" src="${recImg || ''}" alt="${rec.title || rec.name}" onerror="this.parentElement.style.display='none'">
            `;
            recCard.onclick = () => openMovieDetail(rec.id);
            recScroll.appendChild(recCard);
          }
        }

        document.getElementById('detail-close').onclick = closeDetail;
        document.getElementById('back-btn').onclick = closeDetail;

      } catch (err) {
        document.getElementById('detail-body').innerHTML = '<p style="color:#ff6666;">Error loading movie details</p>';
        console.error(err);
      }

      hideLoader();
    }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       MOVIE DETAIL VIEW - FETCH ALL IMAGES (include_image_language)
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

    async function openMovieDetail(movieId) {
      currentMovieId = movieId;
      showLoader();

      try {
        const apiFunc = isAdultMode ? tmdbAdult : tmdb;
        
        // CRITICAL: Add include_image_language=null to get ALL images
        const data = await apiFunc(`/movie/${movieId}`, {
          append_to_response: 'credits,videos,images,recommendations',
          include_image_language: 'en,null' // Gets English AND images without language tag
        });

        const title = data.title || 'Unknown';
        const rating = data.vote_average ? data.vote_average.toFixed(1) : 'N/A';
        const overview = data.overview || 'No overview available.';
        const allTrailers = data.videos?.results?.filter(v => v.site === 'YouTube') || [];
        const trailers = allTrailers.slice(0, 5);
        const cast = data.credits?.cast || [];
        const posters = data.images?.posters || []; // NOW GETS ALL
        const backdrops = data.images?.backdrops || []; // NOW GETS ALL
        const recommendations = data.recommendations?.results?.slice(0, 10) || [];

        console.log(`Found ${posters.length} posters, ${backdrops.length} backdrops for "${title}"`);

        let html = `
          <h2>${title} <span class="rating">${rating}‚òÖ</span></h2>
          <p class="overview">${overview}</p>
        `;

        // TRAILERS
        if (trailers.length > 0) {
          html += '<h3>Trailers</h3>';
          html += '<div class="trailers-scroll">';
          trailers.forEach((trailer) => {
            html += `
              <div class="trailer-container">
                <iframe
                  src="${YT_EMBED}${trailer.key}?rel=0&playsinline=1"
                  frameborder="0"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen>
                </iframe>
              </div>
            `;
          });
          html += '</div>';
        }

        // CAST
        if (cast.length > 0) {
          html += '<h3>Cast</h3>';
          html += '<div class="credits-grid" id="cast-grid"></div>';
        }

        // RECOMMENDATIONS
        if (recommendations.length > 0) {
          html += '<h3>You Might Also Like</h3><div class="recommendations-scroll" id="recommendations-scroll"></div>';
        }

        // ALL POSTERS & BACKDROPS
        if (posters.length > 0 || backdrops.length > 0) {
          html += '<div class="image-gallery">';
          
          // POSTERS
          if (posters.length > 0) {
            html += `<h3>Posters (${posters.length})</h3><div class="gallery-scroll">`;
            posters.forEach(img => {
              const isPortrait = img.aspect_ratio < 1;
              const height = isPortrait ? '300px' : 'auto';
              const width = isPortrait ? 'auto' : '300px';
              
              html += `
                <div class="gallery-image" style="width: ${width}; height: ${height};">
                  <img src="${TMDB_IMG}${img.file_path}" alt="Poster" style="object-fit: contain;">
                </div>
              `;
            });
            html += '</div>';
          }

          // BACKDROPS
          if (backdrops.length > 0) {
            html += `<h3>Backdrops (${backdrops.length})</h3><div class="gallery-scroll">`;
            backdrops.forEach(img => {
              const isLandscape = img.aspect_ratio > 1;
              const height = isLandscape ? '200px' : '300px';
              const width = isLandscape ? 'auto' : '200px';
              
              html += `
                <div class="gallery-image" style="width: ${width}; height: ${height};">
                  <img src="${TMDB_IMG}${img.file_path}" alt="Backdrop" style="object-fit: contain;">
                </div>
              `;
            });
            html += '</div>';
          }

          html += '</div>';
        }

        html += '<button class="btn" id="back-btn">Back to Browse</button>';

        document.getElementById('detail-body').innerHTML = html;
        document.getElementById('detail-view').classList.add('active');

        // Render cast
        if (cast.length > 0) {
          const castGrid = document.getElementById('cast-grid');
          for (const actor of cast) {
            const card = document.createElement('div');
            card.className = 'card';
            const actorImg = actor.profile_path ? TMDB_IMG + actor.profile_path : '';
            
            if (actorImg) {
              card.innerHTML = `
                <img class="poster" src="${actorImg}" loading="lazy" alt="${actor.name}">
                <div class="info">
                  <div class="year" style="font-size: 0.65rem;">${actor.name}</div>
                </div>
              `;
            } else {
              card.innerHTML = `
                <div class="poster-placeholder">
                  <span style="font-size: 0.6rem;">${actor.name}</span>
                </div>
              `;
            }
            
            card.onclick = () => openActorDetail(actor.id);
            castGrid.appendChild(card);
          }
        }

        // Render recommendations
        if (recommendations.length > 0) {
          const recScroll = document.getElementById('recommendations-scroll');
          for (const rec of recommendations) {
            const recCard = document.createElement('div');
            recCard.className = 'recommendation-card';
            const recImg = await getImageUrl(rec);
            recCard.innerHTML = `
              <img class="poster" src="${recImg || ''}" alt="${rec.title || rec.name}" onerror="this.parentElement.style.display='none'">
            `;
            recCard.onclick = () => openMovieDetail(rec.id);
            recScroll.appendChild(recCard);
          }
        }

        document.getElementById('detail-close').onclick = closeDetail;
        document.getElementById('back-btn').onclick = closeDetail;

      } catch (err) {
        document.getElementById('detail-body').innerHTML = '<p style="color:#ff6666;">Error loading movie details</p>';
        console.error(err);
      }

      hideLoader();
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       TV SHOW DETAIL VIEW - FETCH ALL IMAGES
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

    async function openTVDetail(tvId) {
      currentMovieId = tvId;
      showLoader();

      try {
        const apiFunc = isAdultMode ? tmdbAdult : tmdb;
        
        // CRITICAL: Add include_image_language=null to get ALL images
        const data = await apiFunc(`/tv/${tvId}`, {
          append_to_response: 'credits,videos,images,recommendations',
          include_image_language: 'en,null' // Gets English AND images without language tag
        });

        const title = data.name || 'Unknown';
        const rating = data.vote_average ? data.vote_average.toFixed(1) : 'N/A';
        const overview = data.overview || 'No overview available.';
        const allTrailers = data.videos?.results?.filter(v => v.site === 'YouTube') || [];
        const trailers = allTrailers.slice(0, 5);
        const cast = data.credits?.cast || [];
        const seasons = data.seasons || [];
        const posters = data.images?.posters || []; // NOW GETS ALL
        const backdrops = data.images?.backdrops || []; // NOW GETS ALL
        const recommendations = data.recommendations?.results?.slice(0, 10) || [];

        console.log(`Found ${posters.length} posters, ${backdrops.length} backdrops for "${title}"`);

        let html = `
          <h2>${title} <span class="rating">${rating}‚òÖ</span></h2>
          <p class="overview">${overview}</p>
        `;

        // TRAILERS
        if (trailers.length > 0) {
          html += '<h3>Trailers</h3>';
          html += '<div class="trailers-scroll">';
          trailers.forEach((trailer) => {
            html += `
              <div class="trailer-container">
                <iframe
                  src="${YT_EMBED}${trailer.key}?rel=0&playsinline=1"
                  frameborder="0"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen>
                </iframe>
              </div>
            `;
          });
          html += '</div>';
        }

        // CAST
        if (cast.length > 0) {
          html += '<h3>Cast</h3>';
          html += '<div class="credits-grid" id="cast-grid"></div>';
        }

        // SEASONS
        if (seasons.length > 0) {
          html += '<h3>Seasons</h3><div class="seasons-accordion" id="seasons-accordion"></div>';
        }

        // RECOMMENDATIONS
        if (recommendations.length > 0) {
          html += '<h3>You Might Also Like</h3><div class="recommendations-scroll" id="recommendations-scroll"></div>';
        }

        // ALL POSTERS & BACKDROPS
        if (posters.length > 0 || backdrops.length > 0) {
          html += '<div class="image-gallery">';
          
          // POSTERS
          if (posters.length > 0) {
            html += `<h3>Posters (${posters.length})</h3><div class="gallery-scroll">`;
            posters.forEach(img => {
              const isPortrait = img.aspect_ratio < 1;
              const height = isPortrait ? '300px' : 'auto';
              const width = isPortrait ? 'auto' : '300px';
              
              html += `
                <div class="gallery-image" style="width: ${width}; height: ${height};">
                  <img src="${TMDB_IMG}${img.file_path}" alt="Poster" style="object-fit: contain;">
                </div>
              `;
            });
            html += '</div>';
          }

          // BACKDROPS
          if (backdrops.length > 0) {
            html += `<h3>Backdrops (${backdrops.length})</h3><div class="gallery-scroll">`;
            backdrops.forEach(img => {
              const isLandscape = img.aspect_ratio > 1;
              const height = isLandscape ? '200px' : '300px';
              const width = isLandscape ? 'auto' : '200px';
              
              html += `
                <div class="gallery-image" style="width: ${width}; height: ${height};">
                  <img src="${TMDB_IMG}${img.file_path}" alt="Backdrop" style="object-fit: contain;">
                </div>
              `;
            });
            html += '</div>';
          }

          html += '</div>';
        }

        html += '<button class="btn" id="back-btn">Back to Browse</button>';

        document.getElementById('detail-body').innerHTML = html;
        document.getElementById('detail-view').classList.add('active');

        // Render cast (same as before)
        if (cast.length > 0) {
          const castGrid = document.getElementById('cast-grid');
          for (const actor of cast) {
            const card = document.createElement('div');
            card.className = 'card';
            const actorImg = actor.profile_path ? TMDB_IMG + actor.profile_path : '';
            
            if (actorImg) {
              card.innerHTML = `
                <img class="poster" src="${actorImg}" loading="lazy" alt="${actor.name}">
                <div class="info">
                  <div class="year" style="font-size: 0.65rem;">${actor.name}</div>
                </div>
              `;
            } else {
              card.innerHTML = `
                <div class="poster-placeholder">
                  <span style="font-size: 0.6rem;">${actor.name}</span>
                </div>
              `;
            }
            
            card.onclick = () => openActorDetail(actor.id);
            castGrid.appendChild(card);
          }
        }

        // Render seasons (same as before - keeping full code)
        const seasonsAccordion = document.getElementById('seasons-accordion');
        if (seasonsAccordion) {
          seasons.forEach(season => {
            const seasonDiv = document.createElement('div');
            seasonDiv.className = 'season-item';
            seasonDiv.innerHTML = `
              <div class="season-header">
                <div>
                  <div class="season-title">${season.name}</div>
                  <div class="season-info">${season.episode_count} episodes ${season.air_date ? '‚Ä¢ Aired: ' + season.air_date : ''}</div>
                </div>
                <div class="season-arrow">‚ñº</div>
              </div>
              <div class="episodes-list">
                <div class="episodes-content" id="episodes-${season.season_number}"></div>
              </div>
            `;

            const header = seasonDiv.querySelector('.season-header');
            header.onclick = async () => {
              const isActive = seasonDiv.classList.contains('active');
              
              document.querySelectorAll('.season-item').forEach(el => el.classList.remove('active'));
              
              if (!isActive) {
                seasonDiv.classList.add('active');
                
                const episodesDiv = document.getElementById(`episodes-${season.season_number}`);
                if (episodesDiv.children.length === 0) {
                  episodesDiv.innerHTML = '<p style="text-align:center; color: #666;">Loading episodes...</p>';
                  try {
                    const apiFunc = isAdultMode ? tmdbAdult : tmdb;
                    const seasonData = await apiFunc(`/tv/${tvId}/season/${season.season_number}`);
                    episodesDiv.innerHTML = '';
                    
                    seasonData.episodes.forEach(ep => {
                      const epDiv = document.createElement('div');
                      epDiv.className = 'episode-item';
                      epDiv.innerHTML = `
                        <div class="episode-number">Episode ${ep.episode_number}</div>
                        <div class="episode-title">${ep.name || 'Untitled'}</div>
                        <div class="episode-overview">${ep.overview || 'No description available.'}</div>
                        <div class="episode-air-date">Aired: ${ep.air_date || 'Unknown'}</div>
                      `;
                      episodesDiv.appendChild(epDiv);
                    });
                  } catch (err) {
                    episodesDiv.innerHTML = '<p style="color: #ff6666;">Failed to load episodes</p>';
                  }
                }
              }
            };

            seasonsAccordion.appendChild(seasonDiv);
          });
        }

        // Render recommendations
        if (recommendations.length > 0) {
          const recScroll = document.getElementById('recommendations-scroll');
          for (const rec of recommendations) {
            const recCard = document.createElement('div');
            recCard.className = 'recommendation-card';
            const recImg = await getImageUrl(rec);
            recCard.innerHTML = `
              <img class="poster" src="${recImg || ''}" alt="${rec.title || rec.name}" onerror="this.parentElement.style.display='none'">
            `;
            recCard.onclick = () => openTVDetail(rec.id);
            recScroll.appendChild(recCard);
          }
        }

        document.getElementById('detail-close').onclick = closeDetail;
        document.getElementById('back-btn').onclick = closeDetail;

      } catch (err) {
        document.getElementById('detail-body').innerHTML = '<p style="color:#ff6666;">Error loading TV show details</p>';
        console.error(err);
      }

      hideLoader();
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       TV SHOW DETAIL VIEW - Max 5 trailers, horizontal scroll
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

    async function openTVDetail(tvId) {
      currentMovieId = tvId;
      showLoader();

      try {
        const apiFunc = isAdultMode ? tmdbAdult : tmdb;
        const data = await apiFunc(`/tv/${tvId}`, {
          append_to_response: 'credits,videos,images,recommendations'
        });

        const title = data.name || 'Unknown';
        const rating = data.vote_average ? data.vote_average.toFixed(1) : 'N/A';
        const overview = data.overview || 'No overview available.';
        const allTrailers = data.videos?.results?.filter(v => v.site === 'YouTube') || [];
        const trailers = allTrailers.slice(0, 5); // LIMIT TO 5
        const cast = data.credits?.cast || []; // NO LIMIT
        const seasons = data.seasons || [];
        const posters = data.images?.posters || [];
        const backdrops = data.images?.backdrops || [];
        const recommendations = data.recommendations?.results?.slice(0, 10) || [];

        let html = `
          <h2>${title} <span class="rating">${rating}‚òÖ</span></h2>
          <p class="overview">${overview}</p>
        `;

        // TRAILERS - Horizontal scroll, max 5
        if (trailers.length > 0) {
          html += '<h3>Trailers</h3>';
          html += '<div class="trailers-scroll">';
          trailers.forEach((trailer) => {
            html += `
              <div class="trailer-container">
                <iframe
                  src="${YT_EMBED}${trailer.key}?rel=0&playsinline=1"
                  frameborder="0"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen>
                </iframe>
              </div>
            `;
          });
          html += '</div>';
        }

        // Cast - show ALL
        if (cast.length > 0) {
          html += '<h3>Cast</h3>';
          html += '<div class="credits-grid" id="cast-grid"></div>';
        }

        // Seasons accordion
        if (seasons.length > 0) {
          html += '<h3>Seasons</h3><div class="seasons-accordion" id="seasons-accordion"></div>';
        }

        // Recommendations
        if (recommendations.length > 0) {
          html += '<h3>You Might Also Like</h3><div class="recommendations-scroll" id="recommendations-scroll"></div>';
        }

        // ALL POSTERS & BACKDROPS
        if (posters.length > 0 || backdrops.length > 0) {
          html += '<div class="image-gallery">';
          
          if (posters.length > 0) {
            html += '<h3>Posters</h3><div class="gallery-scroll">';
            posters.forEach(img => {
              html += `
                <div class="gallery-image">
                  <img src="${TMDB_IMG}${img.file_path}" alt="Poster">
                </div>
              `;
            });
            html += '</div>';
          }

          if (backdrops.length > 0) {
            html += '<h3>Backdrops</h3><div class="gallery-scroll">';
            backdrops.forEach(img => {
              html += `
                <div class="gallery-image">
                  <img src="${TMDB_IMG}${img.file_path}" alt="Backdrop">
                </div>
              `;
            });
            html += '</div>';
          }

          html += '</div>';
        }

        html += '<button class="btn" id="back-btn">Back to Browse</button>';

        document.getElementById('detail-body').innerHTML = html;
        document.getElementById('detail-view').classList.add('active');

        // Render ALL cast in grid
        if (cast.length > 0) {
          const castGrid = document.getElementById('cast-grid');
          for (const actor of cast) {
            const card = document.createElement('div');
            card.className = 'card';
            const actorImg = actor.profile_path ? TMDB_IMG + actor.profile_path : '';
            
            if (actorImg) {
              card.innerHTML = `
                <img class="poster" src="${actorImg}" loading="lazy" alt="${actor.name}">
                <div class="info">
                  <div class="year" style="font-size: 0.65rem;">${actor.name}</div>
                </div>
              `;
            } else {
              card.innerHTML = `
                <div class="poster-placeholder">
                  <span style="font-size: 0.6rem;">${actor.name}</span>
                </div>
              `;
            }
            
            card.onclick = () => openActorDetail(actor.id);
            castGrid.appendChild(card);
          }
        }

        // Render seasons accordion
        const seasonsAccordion = document.getElementById('seasons-accordion');
        if (seasonsAccordion) {
          seasons.forEach(season => {
            const seasonDiv = document.createElement('div');
            seasonDiv.className = 'season-item';
            seasonDiv.innerHTML = `
              <div class="season-header">
                <div>
                  <div class="season-title">${season.name}</div>
                  <div class="season-info">${season.episode_count} episodes ${season.air_date ? '‚Ä¢ Aired: ' + season.air_date : ''}</div>
                </div>
                <div class="season-arrow">‚ñº</div>
              </div>
              <div class="episodes-list">
                <div class="episodes-content" id="episodes-${season.season_number}"></div>
              </div>
            `;

            const header = seasonDiv.querySelector('.season-header');
            header.onclick = async () => {
              const isActive = seasonDiv.classList.contains('active');
              
              document.querySelectorAll('.season-item').forEach(el => el.classList.remove('active'));
              
              if (!isActive) {
                seasonDiv.classList.add('active');
                
                const episodesDiv = document.getElementById(`episodes-${season.season_number}`);
                if (episodesDiv.children.length === 0) {
                  episodesDiv.innerHTML = '<p style="text-align:center; color: #666;">Loading episodes...</p>';
                  try {
                    const apiFunc = isAdultMode ? tmdbAdult : tmdb;
                    const seasonData = await apiFunc(`/tv/${tvId}/season/${season.season_number}`);
                    episodesDiv.innerHTML = '';
                    
                    seasonData.episodes.forEach(ep => {
                      const epDiv = document.createElement('div');
                      epDiv.className = 'episode-item';
                      epDiv.innerHTML = `
                        <div class="episode-number">Episode ${ep.episode_number}</div>
                        <div class="episode-title">${ep.name || 'Untitled'}</div>
                        <div class="episode-overview">${ep.overview || 'No description available.'}</div>
                        <div class="episode-air-date">Aired: ${ep.air_date || 'Unknown'}</div>
                      `;
                      episodesDiv.appendChild(epDiv);
                    });
                  } catch (err) {
                    episodesDiv.innerHTML = '<p style="color: #ff6666;">Failed to load episodes</p>';
                  }
                }
              }
            };

            seasonsAccordion.appendChild(seasonDiv);
          });
        }

        // Render recommendations
        if (recommendations.length > 0) {
          const recScroll = document.getElementById('recommendations-scroll');
          for (const rec of recommendations) {
            const recCard = document.createElement('div');
            recCard.className = 'recommendation-card';
            const recImg = await getImageUrl(rec);
            recCard.innerHTML = `
              <img class="poster" src="${recImg || ''}" alt="${rec.title || rec.name}" onerror="this.parentElement.style.display='none'">
            `;
            recCard.onclick = () => openTVDetail(rec.id);
            recScroll.appendChild(recCard);
          }
        }

        document.getElementById('detail-close').onclick = closeDetail;
        document.getElementById('back-btn').onclick = closeDetail;

      } catch (err) {
        document.getElementById('detail-body').innerHTML = '<p style="color:#ff6666;">Error loading TV show details</p>';
        console.error(err);
      }

      hideLoader();
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       ACTOR DETAIL VIEW - No limits, vertical grid, All/TV/Movies filters
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

    async function openActorDetail(actorId) {
      showLoader();

      try {
        const apiFunc = isAdultMode ? tmdbAdult : tmdb;
        const data = await apiFunc(`/person/${actorId}`, {
          append_to_response: 'combined_credits,images'
        });

        const name = data.name || 'Unknown';
        const bio = data.biography 
          ? data.biography.substring(0, 400) + (data.biography.length > 400 ? '...' : '') 
          : 'No biography available.';
        const profileImg = data.profile_path ? `${TMDB_IMG}${data.profile_path}` : null;
        const profileImages = data.images?.profiles || [];
        let allCredits = data.combined_credits?.cast || [];

        // Separate movies and TV
        const movieCredits = allCredits.filter(c => c.media_type === 'movie');
        const tvCredits = allCredits.filter(c => c.media_type === 'tv');

        // Sort by popularity
        allCredits.sort((a, b) => {
          if (a.id === currentMovieId) return -1;
          if (b.id === currentMovieId) return 1;
          return (b.popularity || 0) - (a.popularity || 0);
        });
        movieCredits.sort((a, b) => (b.popularity || 0) - (a.popularity || 0));
        tvCredits.sort((a, b) => (b.popularity || 0) - (a.popularity || 0));

        let html = `
          <div class="actor-profile">
            <h2>${name}</h2>
            ${profileImg ? `<img src="${profileImg}" alt="${name}">` : ''}
            <p><em>Known for: ${data.known_for_department || 'Acting'}</em></p>
            <p class="overview">${bio}</p>
          </div>
        `;

        // Filter buttons - ONLY if they have both movies and TV
        if (movieCredits.length > 0 && tvCredits.length > 0) {
          html += `
            <div class="filter-buttons">
              <button class="filter-btn active" data-filter="all">All (${allCredits.length})</button>
              <button class="filter-btn" data-filter="movies">Movies (${movieCredits.length})</button>
              <button class="filter-btn" data-filter="tv">TV (${tvCredits.length})</button>
            </div>
          `;
        }

        html += '<h3>Credits</h3>';
        html += '<div class="credits-grid" id="actor-credits"></div>';

        // Profile images
        if (profileImages.length > 0) {
          html += '<h3>Photos</h3><div class="gallery-scroll">';
          profileImages.forEach(img => {
            html += `
              <div class="gallery-image">
                <img src="${TMDB_IMG}${img.file_path}" alt="Photo">
              </div>
            `;
          });
          html += '</div>';
        }

        html += '<button class="btn" id="back-to-movie">Back</button>';

        document.getElementById('detail-body').innerHTML = html;
        document.getElementById('detail-view').classList.add('active');

        // Render credits function
        async function renderCredits(credits) {
          const creditsGrid = document.getElementById('actor-credits');
          creditsGrid.innerHTML = '';

          for (const item of credits) {
            const title = item.title || item.name || 'Unknown';
            const year = (item.release_date || item.first_air_date || '').slice(0, 4);
            const imageUrl = await getImageUrl(item);

            const card = document.createElement('div');
            card.className = 'card';
            
            if (item.id === currentMovieId) {
              card.classList.add('highlight');
            }

            if (imageUrl) {
              card.innerHTML = `
                <img class="poster" src="${imageUrl}" loading="lazy" alt="${title}">
                <div class="info">
                  ${year ? `<div class="year">${year}</div>` : ''}
                </div>
              `;
            } else {
              card.innerHTML = `
                <div class="poster-placeholder">
                  <span>No Image</span>
                </div>
                <div class="info">
                  ${year ? `<div class="year">${year}</div>` : ''}
                </div>
              `;
            }

            card.onclick = () => openDetail(item);
            creditsGrid.appendChild(card);
          }
        }

        // Initial render - ALL credits
        await renderCredits(allCredits);

        // Filter button handlers
        const filterBtns = document.querySelectorAll('.filter-btn');
        filterBtns.forEach(btn => {
          btn.onclick = async () => {
            filterBtns.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            const filter = btn.dataset.filter;
            showLoader();
            
            if (filter === 'all') {
              await renderCredits(allCredits);
            } else if (filter === 'movies') {
              await renderCredits(movieCredits);
            } else if (filter === 'tv') {
              await renderCredits(tvCredits);
            }
            
            hideLoader();
          };
        });

        document.getElementById('detail-close').onclick = closeDetail;
        document.getElementById('back-to-movie').onclick = closeDetail;

      } catch (err) {
        document.getElementById('detail-body').innerHTML = '<p style="color:#ff6666;">Error loading actor details</p>';
        console.error(err);
      }

      hideLoader();
    }

    function closeDetail() {
      document.getElementById('detail-view').classList.remove('active');
    }
    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       SEARCH & MODE TOGGLE
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

    function toggleAdultMode(force) {
      if (typeof force === 'boolean') {
        isAdultMode = force;
      } else {
        isAdultMode = !isAdultMode;
      }

      localStorage.setItem('adultMode', isAdultMode);

      const modeIndicator = document.getElementById('mode-indicator');
      const appTitle = document.getElementById('app-title');
      
      if (isAdultMode) {
        modeIndicator.classList.add('active');
        appTitle.classList.add('adult-mode');
        alert('üîû Adult Mode Enabled');
      } else {
        modeIndicator.classList.remove('active');
        appTitle.classList.remove('adult-mode');
        alert('üßº Safe Mode Enabled');
      }

      document.getElementById('search-input').value = '';
      
      const searchSection = document.getElementById('search-results');
      if (searchSection) searchSection.remove();

      loadHome();
    }

    async function performSearch(query) {
      if (!query) {
        const searchSection = document.getElementById('search-results');
        if (searchSection) searchSection.remove();
        
        loadHome();
        return;
      }

      showLoader();

      try {
        let results = [];
        let displayQuery = query;

        const yearMatch = query.match(/^\d{4}$/);
        const apiFunc = isAdultMode ? tmdbAdult : tmdb;

        if (yearMatch) {
          const year = yearMatch[0];
          const data = await apiFunc('/discover/movie', {
            primary_release_year: year,
            sort_by: 'popularity.desc'
          });
          results = data.results || [];
          displayQuery = `Movies from ${year}`;
        } else {
          const data = await apiFunc('/search/multi', {
            query: query,
            page: 1
          });
          results = data.results || [];
          displayQuery = `"${query}"`;
        }

        document.querySelectorAll('section[id^="section-"]').forEach(s => s.style.display = 'none');

        let searchSection = document.getElementById('search-results');
        if (!searchSection) {
          searchSection = document.createElement('section');
          searchSection.id = 'search-results';
          document.querySelector('#section-digital').before(searchSection);
        }

        searchSection.innerHTML = `
          <h2>Search Results for ${displayQuery}</h2>
          <div class="horizontal-scroll" id="search-grid"></div>
        `;
        searchSection.style.display = 'block';

        await renderHorizontal('search-grid', results);

      } catch (err) {
        console.error('Search failed:', err);
      }

      hideLoader();
    }

    const searchInput = document.getElementById('search-input');
    
    searchInput.addEventListener('input', (e) => {
      const query = e.target.value.trim();

      if (query === '42069') {
        toggleAdultMode(true);
        searchInput.value = '';
        return;
      }

      if (query === '143') {
        toggleAdultMode(false);
        searchInput.value = '';
        return;
      }

      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        performSearch(query);
      }, 500);
    });

    searchInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        clearTimeout(searchTimeout);
        performSearch(searchInput.value.trim());
      }
    });
    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       WEATHER WIDGET
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

    function updateTime() {
      const now = new Date();
      const hours = now.getHours();
      const minutes = now.getMinutes();
      const ampm = hours >= 12 ? 'PM' : 'AM';
      const displayHours = hours % 12 || 12;
      const displayMinutes = minutes < 10 ? '0' + minutes : minutes;
      document.getElementById('weatherTime').textContent = `${displayHours}:${displayMinutes} ${ampm}`;
    }

    setInterval(updateTime, 1000);
    updateTime();

    async function getCityName(lat, lon) {
      try {
        const response = await fetch(
          `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`
        );
        const data = await response.json();

        if (data && data.address) {
          const city = data.address.city ||
                       data.address.town ||
                       data.address.village ||
                       data.address.county ||
                       data.address.state;
          const country = data.address.country;

          if (city && country) return `${city}, ${country}`;
          if (city) return city;
          if (country) return country;
        }
        return 'Your Location';
      } catch (error) {
        return 'Your Location';
      }
    }

    async function getWeather() {
      const widget = document.getElementById('weatherWidget');
      widget.classList.add('visible');
      widget.classList.add('loading');

      if (!navigator.geolocation) {
        document.getElementById('weatherCondition').textContent = 'Location unavailable';
        document.getElementById('weatherLocation').textContent = 'Not supported';
        widget.classList.remove('loading');
        return;
      }

      navigator.geolocation.getCurrentPosition(async (position) => {
        const { latitude, longitude } = position.coords;

        try {
          const [weatherResponse, cityName] = await Promise.all([
            fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true`),
            getCityName(latitude, longitude)
          ]);

          const data = await weatherResponse.json();

          if (data.current_weather) {
            const tempC = Math.round(data.current_weather.temperature);
            const tempF = Math.round((tempC * 9/5) + 32);

            const isUS = (latitude > 24 && latitude < 50 && longitude > -125 && longitude < -66);
            const temp = isUS ? tempF : tempC;
            const unit = isUS ? '¬∞F' : '¬∞C';

            document.getElementById('weatherTemp').textContent = `${temp}${unit}`;
            document.getElementById('weatherCondition').textContent = getRudeboyWeatherCondition(data.current_weather.weathercode);
            document.getElementById('weatherLocation').textContent = cityName;
            document.getElementById('weatherIcon').textContent = getWeatherIconFromCode(data.current_weather.weathercode);
          }
        } catch (error) {
          document.getElementById('weatherCondition').textContent = 'Unavailable';
          document.getElementById('weatherIcon').textContent = 'üåê';
          document.getElementById('weatherLocation').textContent = 'Service down';
        }
        widget.classList.remove('loading');
      }, (error) => {
        document.getElementById('weatherCondition').textContent = 'Location denied';
        document.getElementById('weatherIcon').textContent = 'üìç';
        document.getElementById('weatherLocation').textContent = 'Enable location';
        widget.classList.remove('loading');
      });
    }

    function getWeatherIconFromCode(code) {
      if (code === 0) return '‚òÄÔ∏è';
      if (code === 1 || code === 2) return 'üå§Ô∏è';
      if (code === 3) return '‚òÅÔ∏è';
      if (code === 45 || code === 48) return 'üå´Ô∏è';
      if (code >= 51 && code <= 67) return 'üåßÔ∏è';
      if (code >= 71 && code <= 77) return '‚ùÑÔ∏è';
      if (code >= 80 && code <= 82) return 'üå¶Ô∏è';
      if (code >= 85 && code <= 86) return '‚ùÑÔ∏è';
      if (code >= 95 && code <= 99) return '‚õàÔ∏è';
      return 'üå°Ô∏è';
    }

    function getRudeboyWeatherCondition(code) {
      if (code === 0) return 'SunnySide Up';
      if (code === 1 || code === 2) return "It's Cloudy Bitch";
      if (code === 3) return "It's Cloudy Bitch";
      if (code === 45 || code === 48) return "Can't see shit";
      if (code >= 51 && code <= 67) return 'Wet T-Shirt Weather';
      if (code >= 71 && code <= 77) return 'Fucking Snow';
      if (code >= 80 && code <= 82) return "She's a squirter";
      if (code >= 85 && code <= 86) return 'Fucking Snow';
      if (code >= 95 && code <= 99) return 'Zeus is Pissed';
      return 'Unknown';
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       EASTER EGG - Matrix Animation
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

    const playlist = [
      {title: 'Capone', artist: 'Hey Pluto', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/capone.mp3'},
      {title: 'Count', artist: 'Fonss', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/count.mp3'},
      {title: 'Falling Softly', artist: 'Richard Smithson', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/falling%20softly.mp3'},
      {title: 'Fluid', artist: 'Mountaineer', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/fluid.mp3'},
      {title: 'I Wanna Take Your Body Higher', artist: 'SkyGaze', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/i%20wanna%20take%20your%20body%20higher.mp3'},
      {title: 'Journey', artist: 'Tatami', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/journey.mp3'},
      {title: 'Moments', artist: 'Tatami', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/moments.mp3'},
      {title: 'Stardrive', artist: 'Simon Folwar', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/stardrive.mp3'},
      {title: 'Sunset In Junipero', artist: 'Bach', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/sunset%20in%20junipero.mp3'},
      {title: 'I Know', artist: 'Matrika', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/IKnow.mp3'},
      {title: 'Other Worlds', artist: 'Carpetman', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/OtherWorlds.mp3'},
      {title: 'JaffaDays', artist: 'ToneBreak', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/JaffaDays.mp3'},
      {title: 'Baby Blue', artist: 'Action Bronson', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/BabyBlue.mp3'}
    ];

    let shuffledPlaylist = [...playlist];
    let currentTrackIndex = 0;

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    shuffleArray(shuffledPlaylist);

    function playRandomTrack() {
      if (currentTrackIndex >= shuffledPlaylist.length) {
        shuffleArray(shuffledPlaylist);
        currentTrackIndex = 0;
      }

      const track = shuffledPlaylist[currentTrackIndex];
      currentTrackIndex++;

      const audio = document.getElementById('easterAudio');
      audio.src = track.url;
      audio.volume = 0;
      audio.loop = false;

      audio.play().then(() => {
        let vol = 0;
        const fadeIn = setInterval(() => {
          vol += 0.05;
          audio.volume = Math.min(vol, 0.5);
          if (vol >= 0.5) clearInterval(fadeIn);
        }, 100);
      }).catch(() => {
        if (document.getElementById('easter-egg-overlay').classList.contains('active')) {
          playRandomTrack();
        }
      });
    }

    document.getElementById('easterAudio').addEventListener('ended', () => {
      if (document.getElementById('easter-egg-overlay').classList.contains('active')) {
        playRandomTrack();
      }
    });

    document.getElementById('easterEgg').onclick = () => {
      const overlay = document.getElementById('easter-egg-overlay');
      overlay.classList.add('active');
      playRandomTrack();

      const canvas = document.getElementById('matrixCanvas');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      const msg = "CREATED BY RUDEBOY‚Ñ¢";
      const fontSize = Math.ceil(canvas.width / msg.length);
      const drops = [];
      const dropSpeeds = [];

      for (let i = 0; i < msg.length; i++) {
        drops[i] = Math.random() * -100;
        dropSpeeds[i] = 0.5 + Math.random() * 1.5;
      }

      let messageMode = false;
      let activeWords = [];
      const words = ['CREATED', 'BY', 'RUDEBOY‚Ñ¢'];
      const wordStartPositions = [0, 8, 11];
      const wordLengths = [7, 2, 9];
      let messageTimer = 0;
      const MESSAGE_INTERVAL = 30000;
      let currentSpeed = 50;

      function glitchChar(ctx, char, x, y, fontSize) {
        const offsetX = (Math.random() - 0.5) * 4;
        const offsetY = (Math.random() - 0.5) * 4;
        const colors = ['#10b981', '#764ba2', '#ffffff'];
        ctx.fillStyle = colors[Math.floor(Math.random() * colors.length)];
        ctx.fillText(char, x + offsetX, y + offsetY);
      }

      function draw() {
        if (messageMode) {
          ctx.fillStyle = 'rgba(0,0,0,0.05)';
        } else {
          ctx.fillStyle = 'rgba(0,0,0,0.25)';
        }
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.font = fontSize + 'px monospace';

        if (!messageMode) {
          messageTimer += currentSpeed;
          if (messageTimer >= MESSAGE_INTERVAL) {
            messageMode = true;
            activeWords = [0];
            messageTimer = 0;
            for (let i = 0; i < msg.length; i++) {
              drops[i] = -100;
              dropSpeeds[i] = 1;
            }
            for (let i = 0; i < 7; i++) drops[i] = 0;
            clearInterval(matrixInterval);
            currentSpeed = 75;
            matrixInterval = setInterval(draw, currentSpeed);
          }
        }

        for (let i = 0; i < msg.length; i++) {
          let char;
          if (messageMode) {
            let shouldShow = false;
            for (let w of activeWords) {
              const wordStart = wordStartPositions[w];
              const wordEnd = wordStart + wordLengths[w];
              if (i >= wordStart && i < wordEnd) {
                char = msg[i];
                shouldShow = true;
                break;
              }
            }
            if (!shouldShow) char = ' ';
          } else {
            char = msg[i];
          }

          if (messageMode) {
            glitchChar(ctx, char, i * fontSize, drops[i] * fontSize, fontSize);
          } else {
            ctx.fillStyle = i % 2 === 0 ? '#10b981' : '#764ba2';
            ctx.fillText(char, i * fontSize, drops[i] * fontSize);
          }

          if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
            drops[i] = Math.random() * -100;
            if (!messageMode) dropSpeeds[i] = 0.5 + Math.random() * 1.5;
          }

          drops[i] += dropSpeeds[i];
        }

        if (messageMode) {
          if (activeWords.length === 1 && activeWords[0] === 0) {
            const createdMaxDrop = Math.max(...drops.slice(0, 7));
            if (createdMaxDrop * fontSize > canvas.height / 2) {
              activeWords.push(1);
              for (let j = 8; j < 10; j++) drops[j] = 0;
            }
          }
          if (activeWords.length === 2 && activeWords[1] === 1) {
            const byMaxDrop = Math.max(...drops.slice(8, 10));
            if (byMaxDrop * fontSize > canvas.height / 2) {
              activeWords.push(2);
              for (let j = 11; j < 19; j++) drops[j] = 0;
            }
          }
          if (activeWords.length === 3) {
            const rudeboyMaxDrop = Math.max(...drops.slice(11, 19));
            if (rudeboyMaxDrop * fontSize > canvas.height + fontSize * 5) {
              messageMode = false;
              activeWords = [];
              for (let j = 0; j < msg.length; j++) {
                drops[j] = Math.random() * -100;
                dropSpeeds[j] = 0.5 + Math.random() * 1.5;
              }
              clearInterval(matrixInterval);
              currentSpeed = 50;
              matrixInterval = setInterval(draw, currentSpeed);
            }
          }
        }
      }

      let matrixInterval = setInterval(draw, currentSpeed);

      overlay.onclick = () => {
        clearInterval(matrixInterval);
        overlay.classList.remove('active');
        const audio = document.getElementById('easterAudio');
        let vol = audio.volume;
        const fadeOut = setInterval(() => {
          vol -= 0.05;
          audio.volume = Math.max(vol, 0);
          if (vol <= 0) {
            clearInterval(fadeOut);
            audio.pause();
            audio.currentTime = 0;
          }
        }, 50);
      };
    };

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       INITIALIZATION
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

    if (isAdultMode) {
      document.getElementById('mode-indicator').classList.add('active');
      document.getElementById('app-title').classList.add('adult-mode');
    }

    loadHome();
    getWeather();
  </script>
</body>
</html>
