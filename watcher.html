<!DOCTYPE html>

<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>Watcher by Rudeboyâ„¢</title>

  <!-- Open Graph / Link Preview Meta Tags -->
  <meta property="og:title" content="Watcher by Rudeboyâ„¢">
  <meta property="og:description" content="Stream and discover movies, TV shows, and more">
  <meta property="og:image" content="https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/icons/view.png">
  <meta property="og:url" content="https://rud3boy.vercel.app/watcher">
  <meta property="og:type" content="website">
  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Watcher by Rudeboyâ„¢">
  <meta name="twitter:description" content="Stream and discover movies, TV shows, and more">
  <meta name="twitter:image" content="https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/icons/view.png">

  <!-- iOS/Android App Icons -->

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Watcher">
  <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/icons/view.png">
  <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/icons/view.png">
  <meta name="mobile-web-app-capable" content="yes">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       THEME COLORS - CUSTOMIZE HERE
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    :root {
      --accent-purple: #764ba2;
      --accent-green: #10b981;
      --accent-red: #ef4444;
      --glass-bg: rgba(30, 30, 50, 0.35);
      --poster-glow: 0 0 20px rgba(118, 75, 162, 0.4);
      --hover-glow: 0 25px 50px rgba(0,0,0,0.6), 0 0 40px rgba(118,75,162,0.6);
      --title-glow: 0 0 15px rgba(118, 75, 162, 0.3), 0 0 30px rgba(16, 185, 129, 0.2);
      --card-gap: 1.2rem;
      --section-padding: 0 1rem;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BASE STYLES
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    * { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0; 
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: linear-gradient(135deg, #000 0%, #0a0a1a 50%, #1a1a2e 100%);
      color: #f0f0f5;
      min-height: 100vh;
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    }

    h1, h2, .title-text { 
      font-family: 'Bebas Neue', cursive; 
      letter-spacing: 1.8px; 
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LOADING OVERLAY
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.85);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 10000;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .loading-overlay.visible {
      display: flex;
      opacity: 1;
    }

    .loading-logo {
      width: 120px;
      height: 120px;
      opacity: 0.8;
      animation: spin-glow 3s linear infinite;
    }

    @keyframes spin-glow {
      0% {
        transform: rotate(0deg);
        filter: drop-shadow(0 0 20px rgba(16,185,129,1)) drop-shadow(0 0 40px rgba(16,185,129,0.8));
      }
      50% {
        transform: rotate(360deg);
        filter: drop-shadow(0 0 20px rgba(16,185,129,1)) drop-shadow(0 0 40px rgba(16,185,129,0.8));
      }
      51% {
        filter: drop-shadow(0 0 20px rgba(118,75,162,1)) drop-shadow(0 0 40px rgba(118,75,162,0.8));
      }
      100% {
        transform: rotate(720deg);
        filter: drop-shadow(0 0 20px rgba(118,75,162,1)) drop-shadow(0 0 40px rgba(118,75,162,0.8));
      }
    }

    .loading-text {
      font-size: 1.2rem;
      font-weight: 600;
      color: #eee;
      margin-top: 1.5rem;
      text-align: center;
      opacity: 0.9;
    }

    .loading-subtext {
      font-size: 0.9rem;
      color: #999;
      margin-top: 0.5rem;
      text-align: center;
      display: none;
    }

    .loading-subtext:not(:empty) {
      display: block;
    }

    .progress-bar-container {
      width: 280px;
      height: 6px;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      margin: 1.5rem auto 0;
      overflow: hidden;
      display: none;
      border: 1px solid rgba(255,255,255,0.2);
    }

    .progress-bar-container.visible {
      display: block;
    }

    .progress-bar-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #10b981 0%, #764ba2 100%);
      border-radius: 10px;
      transition: width 0.3s ease;
      box-shadow: 0 0 10px rgba(16,185,129,0.6);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HEADER with LOGO ANIMATION
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #header {
      padding: 1rem 1.5rem;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(50px);
      border-bottom: 1px solid rgba(118,75,162,0.25);
    }

    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      margin-bottom: 1rem;
      position: relative;
    }

    .title-text { 
      font-size: 2rem; 
      margin: 0;
      transition: all 0.3s;
      text-shadow: var(--title-glow);
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
    }
    
    #logo {
      height: 44px;
      width: auto;
      cursor: pointer;
      transition: transform 0.3s, filter 0.3s;
      filter: drop-shadow(0 0 0px rgba(16,185,129,0));
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% {
        filter: drop-shadow(0 0 0px rgba(16,185,129,0));
      }
      50% {
        filter: drop-shadow(0 0 6px rgba(16,185,129,1)) drop-shadow(0 0 12px rgba(16,185,129,1));
      }
    }

    #logo:hover {
      transform: scale(1.05);
    }

    #logo:active {
      animation: glow-pulse 0.4s ease-out;
      transform: scale(0.98);
    }

    @keyframes glow-pulse {
      0% {
        filter: drop-shadow(0 0 0px rgba(16,185,129,0));
      }
      50% {
        filter: drop-shadow(0 0 20px rgba(16,185,129,1)) drop-shadow(0 0 30px rgba(16,185,129,0.8));
      }
      100% {
        filter: drop-shadow(0 0 0px rgba(16,185,129,0));
      }
    }

    .title-text.adult-mode {
      color: var(--accent-red);
      text-shadow: 0 0 20px rgba(239, 68, 68, 0.6), 0 0 40px rgba(239, 68, 68, 0.3);
    }

    #mode-indicator {
      font-size: 2rem;
      display: none;
      animation: pulse-glow-red 2s infinite;
      cursor: default;
    }

    #mode-indicator.active {
      display: block;
    }

    @keyframes pulse-glow-red {
      0%, 100% { 
        filter: drop-shadow(0 0 10px rgba(239,68,68,0.6)); 
      }
      50% { 
        filter: drop-shadow(0 0 20px rgba(239,68,68,0.9)); 
      }
    }

    #search-container {
      width: 100%;
      position: relative;
    }

    #search-input {
      width: 100%;
      padding: 0.9rem 1.2rem;
      font-size: 1rem;
      background: var(--glass-bg);
      border: 1px solid rgba(118,75,162,0.5);
      border-radius: 999px;
      color: white;
      backdrop-filter: blur(20px);
      transition: all 0.3s;
      line-height: 1.2;
    }

    #search-input:focus {
      outline: none;
      border-color: var(--accent-green);
      box-shadow: 0 0 20px rgba(16,185,129,0.3);
    }

    #search-input::placeholder {
      color: rgba(255,255,255,0.5);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTIONS
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    section { 
      padding: var(--section-padding); 
      margin-bottom: 2rem;
    }

    h2 {
      font-size: 2.2rem;
      margin: 0.5rem 0 1rem;
      background: linear-gradient(90deg, var(--accent-green), var(--accent-purple));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-transform: none;
      text-shadow: var(--title-glow);
      filter: drop-shadow(0 0 12px rgba(118, 75, 162, 0.4)) drop-shadow(0 0 20px rgba(16, 185, 129, 0.3));
    }

    .horizontal-scroll {
      display: flex;
      overflow-x: auto;
      gap: var(--card-gap);
      padding: 0.5rem 0 1.5rem;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
    }

    .horizontal-scroll::-webkit-scrollbar {
      height: 6px;
    }

    .horizontal-scroll::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
    }

    .horizontal-scroll::-webkit-scrollbar-thumb {
      background: var(--accent-purple);
      border-radius: 10px;
    }

    .horizontal-scroll .card { 
      flex: 0 0 100px;
      scroll-snap-align: start; 
    }

    .vertical-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: var(--card-gap);
      padding: 0.5rem 0;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       GENRE BUTTONS - NEW
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .genre-buttons-container {
      margin: 2rem 0;
      padding: 0 1rem;
    }

    .genre-buttons-scroll {
      display: flex;
      overflow-x: auto;
      gap: 0.8rem;
      padding: 1rem 0;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
    }

    .genre-buttons-scroll::-webkit-scrollbar {
      height: 6px;
    }

    .genre-buttons-scroll::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
    }

    .genre-buttons-scroll::-webkit-scrollbar-thumb {
      background: var(--accent-purple);
      border-radius: 10px;
    }

    .genre-btn {
      flex: 0 0 auto;
      padding: 0.7rem 1.5rem;
      border: none;
      border-radius: 25px;
      font-weight: 700;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
      scroll-snap-align: start;
      white-space: nowrap;
    }

    .genre-btn.green-bg {
      background: var(--accent-green);
      color: var(--accent-purple);
    }

    .genre-btn.purple-bg {
      background: var(--accent-purple);
      color: var(--accent-green);
    }

    .genre-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 20px rgba(118,75,162,0.5);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CARDS - UPDATED FAVORITE BUTTON POSITION
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .card {
  background: var(--glass-bg);
  border: 1px solid rgba(118,75,162,0.35);
  border-radius: 16px;
  overflow: hidden;
  backdrop-filter: blur(16px);
  transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
  cursor: pointer;
  position: relative;
}

.card:active {
  transform: scale(0.98);
}

@media (hover: hover) and (pointer: fine) {
  .card:hover {
    transform: translateY(-10px) scale(1.05);
    box-shadow: var(--hover-glow);
    border-color: var(--accent-green);
  }
}

@media (hover: none) {
  .card:active {
    transform: scale(0.98);
    box-shadow: 0 5px 15px rgba(118,75,162,0.4);
  }
}

    /* Favorite star button on cards - UPDATED POSITION */
    .favorite-btn {
      position: absolute;
      top: 0.2rem;
      right: 0.2rem;
      background: rgba(0,0,0,0.50);
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 10;
      transition: all 0.3s ease;
      font-size: 1rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.4);
    }

    .favorite-btn:hover {
      transform: scale(1.2);
      background: rgba(0,0,0,0.9);
    }

    .favorite-btn.favorited {
      color: #ffd700;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
    }

    .favorite-btn:not(.favorited) {
  color: rgba(16, 185, 129, 0.7); /* Green star outline */
}

    .poster { 
      width: 100%; 
      aspect-ratio: 2/3; 
      object-fit: cover; 
      background: #111;
      display: block;
      filter: drop-shadow(var(--poster-glow));
      transition: filter 0.35s;
    }

    .card:hover .poster {
      filter: drop-shadow(0 0 30px rgba(118,75,162,0.7));
    }

    .info {
      padding: 0.4rem 0.9rem 0.5rem;
      text-align: center;
      min-height: 2.2rem;
    }

    .card-title {
      display: none;
    }

    .year {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--accent-green);
      opacity: 1;
      line-height: 1.2;
    }

    .poster-placeholder {
      width: 100%;
      aspect-ratio: 2/3;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: rgba(255,255,255,0.3);
      font-size: 0.75rem;
      text-align: center;
      padding: 1rem;
    }

    .card.highlight {
      border: 2px solid var(--accent-green);
      box-shadow: 0 0 20px rgba(16,185,129,0.6);
    }

    .actor-name-label {
      font-size: 0.7rem;
      color: rgba(255,255,255,0.8);
      margin-top: 0.25rem;
      text-align: center;
      line-height: 1.2;
      padding: 0 0.5rem;
    }

.actor-info-stacked {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.15rem;
  padding: 0 0.5rem;
}

.actor-name {
  font-size: 0.7rem;
  color: rgba(255,255,255,0.9);
  font-weight: 600;
  text-align: center;
  line-height: 1.2;
}

.actor-role {
  font-size: 0.6rem;
  color: var(--accent-green);
  font-weight: 500;
  text-align: center;
  line-height: 1.1;
  font-style: italic;
  opacity: 0.85;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CREW INFO (DIRECTOR/PRODUCTION)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.crew-info {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  margin: 1rem 0;
  padding: 1rem;
  background: rgba(118, 75, 162, 0.1);
  border-left: 3px solid var(--accent-purple);
  border-radius: 8px;
}

.crew-item {
  display: flex;
  gap: 0.5rem;
  font-size: 0.85rem;
  line-height: 1.4;
}

.crew-label {
  font-weight: 700;
  color: var(--accent-green);
  min-width: 80px;
}

.crew-value {
  color: rgba(255, 255, 255, 0.9);
}

.director-card {
  flex: 0 0 100px;
  scroll-snap-align: start;
}

.director-info-stacked {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.15rem;
  padding: 0 0.5rem;
}

.director-name {
  font-size: 0.7rem;
  color: rgba(255,255,255,0.9);
  font-weight: 600;
  text-align: center;
  line-height: 1.2;
}

.director-role {
  font-size: 0.6rem;
  color: var(--accent-purple);
  font-weight: 500;
  text-align: center;
  line-height: 1.1;
  font-style: italic;
  opacity: 0.85;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DETAIL VIEW
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#detail-view {

  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.96);
  backdrop-filter: blur(12px);
  z-index: 1000;
  display: none;
  overflow-y: auto;
  padding: 1rem;
  animation: fadeIn 0.3s;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

#detail-view.active {
  display: block;
}

#detail-content {
  background: rgba(20,20,40,0.9);
  border: 1px solid rgba(118,75,162,0.3);
  border-radius: 20px;
  padding: 2rem 1.5rem;
  max-width: 1000px;
  margin: 0 auto;
  position: relative;
}

#detail-close {
  position: absolute;
  top: 1rem;
  right: 1rem;
  font-size: 2.5rem;
  color: var(--accent-green);
  cursor: pointer;
  transition: transform 0.2s;
  z-index: 10;
  line-height: 1;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
}

#detail-close:hover {
  transform: rotate(90deg) scale(1.2);
}

.detail-hero {
  position: relative;
  margin: -2rem -1.5rem 2rem;
  border-radius: 20px 20px 0 0;
  overflow: hidden;
}

.detail-backdrop {
  width: 100%;
  height: 225px;
  object-fit: cover;
  opacity: 0.4;
}

.detail-hero-content {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 2rem 1.5rem 1rem;
  background: linear-gradient(to top, rgba(20,20,40,0.95), transparent);
  display: flex;
  gap: 1.5rem;
  align-items: flex-end;
}

.detail-poster {
  width: 120px;
  border-radius: 12px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.8);
  border: 2px solid rgba(118,75,162,0.5);
}

.detail-title-block h2 {
  font-size: 1.8rem;
  margin-bottom: 0.5rem;
  text-shadow: var(--title-glow);
  filter: none;
  background: none;
  -webkit-background-clip: unset;
  background-clip: unset;
  color: #fff;
}

.release-date {
  font-size: 0.9rem;
  color: rgba(255,255,255,0.7);
  margin-top: 0.5rem;
}

#detail-content h3 {
  font-size: 1.8rem;
  margin-top: 2rem;
  margin-bottom: 1rem;
  color: var(--accent-green);
  font-family: 'Bebas Neue', cursive;
  letter-spacing: 1.5px;
  text-shadow: 0 0 10px rgba(16, 185, 129, 0.4);
}

.rating {
  display: inline-block;
  background: rgba(16,185,129,0.2);
  color: var(--accent-green);
  padding: 0.4rem 0.8rem;
  border-radius: 8px;
  font-weight: 700;
  font-size: 0.9rem;
}

.overview {
  line-height: 1.4;
  margin: 1rem 0;
  color: rgba(255,255,255,0.9);
  font-size: 0.85rem;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DETAIL ACTION BUTTONS CONTAINER - NEW
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.detail-actions {
  display: flex;
  gap: 0.6rem;
  flex-wrap: wrap;
  margin: 1rem 0;
  align-items: center;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WHERE TO WATCH BUTTON
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.where-to-watch-btn {
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
  padding: 0.5rem 0.8rem;
  background: var(--accent-purple);
  color: var(--accent-green);
  border: none;
  border-radius: 16px;
  font-weight: 700;
  font-size: 0.75rem;
  cursor: pointer;
  transition: all 0.3s ease;
  text-decoration: none;
  white-space: nowrap;
}

.where-to-watch-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(118,75,162,0.5);
}

.where-to-watch-icon {
  width: 16px;
  height: 16px;
  object-fit: contain;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DETAIL FAVORITE BUTTON - NEW
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.detail-favorite-btn {
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
  padding: 0.5rem 0.8rem;
  background: rgba(255, 215, 0, 0.15);
  color: #ffd700;
  border: 2px solid rgba(255, 215, 0, 0.3);
  border-radius: 16px;
  font-weight: 700;
  font-size: 0.75rem;
  cursor: pointer;
  transition: all 0.3s ease;
  text-decoration: none;
  white-space: nowrap;
}

.detail-favorite-btn:hover {
  transform: translateY(-2px);
  background: rgba(255, 215, 0, 0.25);
  border-color: rgba(255, 215, 0, 0.5);
  box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
}

.detail-favorite-btn.favorited {
  background: rgba(255, 215, 0, 0.25);
  border-color: #ffd700;
  box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
}

.detail-favorite-btn .star-icon {
  font-size: 1rem;
  filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.6));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TRAILERS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.trailers-scroll {
  display: flex;
  gap: 1rem;
  overflow-x: auto;
  padding: 1rem 0;
  scroll-snap-type: x mandatory;
}

.trailers-scroll .trailer-container {
  flex: 0 0 400px;
  scroll-snap-align: start;
  margin: 0;
  aspect-ratio: 16/9;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 10px 40px rgba(0,0,0,0.5);
  background: #000;
}

.trailer-container iframe,
.trailer-container video {
  width: 100%;
  height: 100%;
  border: none;
}

@media (max-width: 768px) {
  .trailers-scroll .trailer-container {
    flex: 0 0 300px;
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CAST
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cast-scroll {
  display: flex;
  overflow-x: auto;
  gap: 1rem;
  padding: 1rem 0;
  scroll-snap-type: x mandatory;
}

.cast-scroll .card {
  flex: 0 0 100px;
  scroll-snap-align: start;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FILTER BUTTONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.filter-buttons {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1rem;
  flex-wrap: wrap;
}

.filter-btn,
.search-filter-btn {
  padding: 0.5rem 1rem;
  background: rgba(118,75,162,0.2);
  color: var(--accent-purple);
  border: 1px solid rgba(118,75,162,0.5);
  border-radius: 999px;
  cursor: pointer;
  transition: all 0.3s;
  font-size: 0.85rem;
  font-weight: 600;
  box-shadow: 0 0 10px rgba(118,75,162,0.3);
}

.filter-btn:hover,
.search-filter-btn:hover {
  background: rgba(118,75,162,0.3);
  border-color: var(--accent-purple);
  box-shadow: 0 0 15px rgba(118,75,162,0.5);
  transform: translateY(-2px);
}

.filter-btn.active,
.search-filter-btn.active {
  background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-purple) 100%);
  color: #fff;
  border-color: var(--accent-green);
  box-shadow: 0 0 20px rgba(16,185,129,0.6), 0 0 40px rgba(118,75,162,0.4);
  font-weight: 700;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACTOR PROFILE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.actor-profile {
  text-align: center;
  margin-bottom: 2rem;
}

.actor-profile img {
  max-width: 240px;
  border-radius: 12px;
  margin: 1rem auto;
  display: block;
  border: 2px solid rgba(118,75,162,0.5);
  box-shadow: 0 0 30px rgba(118, 75, 162, 0.4);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SEASONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.season-selector-container {
  margin: 1rem 0;
}

.season-dropdown {
  width: 100%;
  padding: 1rem;
  font-size: 1rem;
  background: rgba(30,30,50,0.8);
  color: var(--accent-green);
  border: 2px solid rgba(118,75,162,0.5);
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s;
  font-weight: 600;
}

.season-dropdown:focus {
  outline: none;
  border-color: var(--accent-green);
  box-shadow: 0 0 20px rgba(16,185,129,0.3);
}

.season-dropdown option {
  background: #1a1a2e;
  color: #fff;
  padding: 1rem;
}

#episodes-container {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.episode-item {
  background: rgba(20,20,40,0.6);
  padding: 1rem;
  border-radius: 10px;
  border-left: 3px solid var(--accent-purple);
  display: flex;
  gap: 1rem;
}

.episode-still {
  width: 150px;
  height: 84px;
  object-fit: cover;
  border-radius: 8px;
  flex-shrink: 0;
  background: #111;
}

.episode-details {
  flex: 1;
}

.episode-number {
  font-size: 0.75rem;
  color: var(--accent-green);
  font-weight: 700;
  margin-bottom: 0.5rem;
}

.episode-title {
  font-size: 1rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
}

.episode-overview {
  font-size: 0.85rem;
  color: rgba(255,255,255,0.7);
  line-height: 1.4;
}

.episode-air-date {
  font-size: 0.75rem;
  color: rgba(255,255,255,0.5);
  margin-top: 0.5rem;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   IMAGE GALLERIES with LIGHTBOX
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.image-gallery {
  margin: 3rem 0 1rem;
}

.gallery-scroll {
  display: flex;
  gap: 1rem;
  overflow-x: auto;
  padding: 1rem 0;
  scroll-snap-type: x mandatory;
}

.gallery-image {
  flex: 0 0 200px;
  height: 300px;
  border-radius: 12px;
  overflow: hidden;
  cursor: pointer;
  transition: transform 0.3s;
  scroll-snap-align: start;
  border: 2px solid rgba(118,75,162,0.3);
}

.gallery-image:hover {
  transform: scale(1.05);
  border-color: var(--accent-green);
}

.gallery-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

#image-lightbox {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.95);
  z-index: 2001;
  display: none;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

#image-lightbox.active {
  display: flex;
}

#image-lightbox img {
  max-width: 90%;
  max-height: 90%;
  object-fit: contain;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RECOMMENDATIONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.recommendations-scroll {
  display: flex;
  gap: 1rem;
  overflow-x: auto;
  padding: 1rem 0;
}

.recommendation-card {
  flex: 0 0 120px;
  cursor: pointer;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUTTONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn {
  display: inline-block;
  padding: 0.8rem 1.5rem;
  background: var(--accent-green);
  color: #000;
  font-weight: 700;
  border-radius: 999px;
  text-decoration: none;
  border: none;
  cursor: pointer;
  transition: all 0.3s;
  margin: 0.5rem 0.5rem 0.5rem 0;
}

.btn:hover {
  background: var(--accent-purple);
  color: #fff;
  transform: translateY(-2px);
  box-shadow: 0 5px 20px rgba(118,75,162,0.4);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COLLECTIONS BUTTON
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.collections-btn {
  display: inline-block;
  padding: 0.8rem 1.5rem;
  background: linear-gradient(135deg, #9b59b6, #8e44ad);
  color: #fff;
  font-weight: 700;
  border-radius: 999px;
  text-decoration: none;
  border: none;
  cursor: pointer;
  transition: all 0.3s;
  margin: 0.5rem 0.5rem 0.5rem 0;
}

.collections-btn:hover {
  background: linear-gradient(135deg, #8e44ad, #732d91);
  transform: translateY(-2px);
  box-shadow: 0 5px 20px rgba(155, 89, 182, 0.6);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TMDB ATTRIBUTION - NEW
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tmdb-attribution {
  text-align: center;
  padding: 0.05rem 0.05rem 0.05rem;
  margin-top: 0.05rem;
}

.tmdb-attribution img {
  max-width: 200px;
  height: auto;
  opacity: 0.8;
  transition: opacity 0.3s;
}

.tmdb-attribution img:hover {
  opacity: 1;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WEATHER WIDGET
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.weather-widget {
  display: none;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 0.65rem 0.75rem;
  margin-bottom: 1rem;
  background: rgba(0,0,0,0.8);
  backdrop-filter: blur(40px) saturate(180%) brightness(1.1);
  -webkit-backdrop-filter: blur(40px) saturate(180%) brightness(1.1);
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,0.2);
  box-shadow: 0 4px 20px rgba(0,0,0,0.3), inset 0 2px 0 rgba(255,255,255,0.3), inset 0 -2px 0 rgba(0,0,0,0.2);
  font-size: 0.8rem;
  animation: weather-glow 4s ease-in-out infinite;
  max-width: 100%;
  flex-wrap: wrap;
}

@keyframes weather-glow {
  0%, 100% { 
    box-shadow: 0 4px 20px rgba(0,0,0,0.3), 0 0 15px rgba(118,75,162,0.4), 
                inset 0 2px 0 rgba(255,255,255,0.3), inset 0 -2px 0 rgba(0,0,0,0.2); 
  }
  50% { 
    box-shadow: 0 4px 20px rgba(0,0,0,0.3), 0 0 15px rgba(16,185,129,0.4), 
                inset 0 2px 0 rgba(255,255,255,0.3), inset 0 -2px 0 rgba(0,0,0,0.2); 
  }
}

.weather-widget.visible { display: flex; }
.weather-widget.loading { opacity: 0.6; }
.weather-icon-temp { display: flex; flex-direction: column; align-items: center; gap: 0.15rem; flex-shrink: 0; }
.weather-icon { font-size: 1.1rem; line-height: 1; flex-shrink: 0; }
.weather-temp { font-size: 0.85rem; font-weight: 700; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; background-clip: text; color: transparent; flex-shrink: 0; white-space: nowrap; }
.weather-time-wrapper { display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
.weather-time { font-size: 0.8rem; font-weight: 600; color: var(--accent-green); white-space: nowrap; }
.weather-divider { color: rgba(255,255,255,0.3); font-weight: 300; flex-shrink: 0; }
.weather-condition-wrapper { display: flex; align-items: center; justify-content: center; text-align: center; max-width: 70px; flex-shrink: 1; }
.weather-condition { font-size: 0.7rem; font-weight: 600; animation: condition-glow 4s ease-in-out infinite; word-wrap: break-word; line-height: 1.1; }
@keyframes condition-glow { 0%, 100% { color: #764ba2; text-shadow: 0 0 10px rgba(118,75,162,0.6); } 50% { color: #10b981; text-shadow: 0 0 10px rgba(16,185,129,0.6); } }
.weather-location-wrapper { display: flex; align-items: center; justify-content: center; text-align: center; max-width: 70px; flex-shrink: 1; }
.weather-location { font-size: 0.7rem; font-weight: 600; animation: location-glow 4s ease-in-out infinite; word-wrap: break-word; line-height: 1.1; }
@keyframes location-glow { 0%, 100% { color: #10b981; text-shadow: 0 0 8px rgba(16,185,129,0.6); } 50% { color: #764ba2; text-shadow: 0 0 8px rgba(118,75,162,0.6); } }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FOOTER & EASTER EGG
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#footer { padding: 2rem; text-align: center; background: rgba(0,0,0,0.55); backdrop-filter: blur(50px); border-top: 1px solid rgba(118,75,162,0.3); margin-top: 3rem; }
#easterEgg { font-weight: 700; font-size: 1.4rem; cursor: pointer; background: linear-gradient(90deg, #667eea, #764ba2); -webkit-background-clip: text; background-clip: text; color: transparent; transition: transform 0.3s; display: inline-block; }
#easterEgg:hover { transform: scale(1.1); }
#easter-egg-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.98); backdrop-filter: blur(35px); z-index: 2000; display: none; align-items: center; justify-content: center; overflow: hidden; cursor: pointer; }
#easter-egg-overlay.active { display: flex; }
.matrix-canvas { position: absolute; inset: 0; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 768px) {
  .header-top { flex-wrap: wrap; }
  .title-text { font-size: 1.5rem; }
  h2 { font-size: 1.8rem; }
  #detail-content { padding: 1.5rem 1rem; }
  .detail-hero { margin: -1.5rem -1rem 1.5rem; }
  .detail-hero-content { padding: 1.5rem 1rem 0.75rem; }
  .detail-poster { width: 100px; }
  .vertical-grid { grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); }
  .episode-item { flex-direction: column; }
  .episode-still { width: 100%; height: auto; }
}


  </style>
</head>
<body>
  <div class="loading-overlay" id="loadingOverlay">
    <img class="loading-logo" src="https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/icons/icon.png" alt="Loading">
    <div class="loading-text" id="loadingText">Loading...</div>
    <div class="loading-subtext" id="loadingSubtext"></div>
    <div class="progress-bar-container" id="progressBarContainer">
      <div class="progress-bar-fill" id="progressBarFill"></div>
    </div>
  </div>

  <div id="header">
    <div class="header-top">
      <img id="logo" src="https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/icons/icon.png" alt="Rudeboy" title="Click to refresh">
      <h1 class="title-text" id="app-title">Watcher</h1>
      <div id="mode-indicator">ğŸ”</div>
    </div>

<div id="search-container">
  <input 
    type="text" 
    id="search-input" 
    placeholder="Movies, TV, Actors, Genres, or Year" 
    autocomplete="off"
  />
</div>

  </div>

  <!-- NORMAL MODE SECTIONS -->

  <section id="section-airing">
    <h2>Airing Today</h2>
    <div class="horizontal-scroll" id="airing-grid"></div>
  </section>

  <section id="section-new-releases">
    <h2>New Releases</h2>
    <div class="horizontal-scroll" id="new-releases-grid"></div>
  </section>

  <section id="section-trending-tv">
    <h2>Trending TV</h2>
    <div class="horizontal-scroll" id="trending-tv-grid"></div>
  </section>

  <section id="section-trending-movies">
    <h2>Trending Movies</h2>
    <div class="horizontal-scroll" id="trending-movies-grid"></div>
  </section>

  <section id="section-tv-week">
    <h2>TV This Week</h2>
    <div class="horizontal-scroll" id="tv-week-grid"></div>
  </section>

  <section id="section-movies-week">
    <h2>Movies This Week</h2>
    <div class="horizontal-scroll" id="movies-week-grid"></div>
  </section>

  <section id="section-anticipated-tv">
    <h2>Most Anticipated TV Shows</h2>
    <div class="horizontal-scroll" id="anticipated-tv-grid"></div>
  </section>

  <section id="section-anticipated-movies">
    <h2>Most Anticipated Movies</h2>
    <div class="horizontal-scroll" id="anticipated-movies-grid"></div>
  </section>

  <!-- FAVORITES SECTION - NORMAL MODE -->

  <section id="section-favorites" style="display:none;">
    <h2>â­ My Favorites</h2>
    <div class="filter-buttons">
      <button class="filter-btn active" data-filter="all-fav">All</button>
      <button class="filter-btn" data-filter="movies-fav">Movies</button>
      <button class="filter-btn" data-filter="tv-fav">TV Shows</button>
      <button class="filter-btn" data-filter="actors-fav">Actors</button>
    </div>
    <div class="vertical-grid" id="favorites-grid"></div>
  </section>

  <!-- XXX SECTIONS (20 total) -->

  <section id="section-xxx-new-releases" style="display:none;">
    <h2>ğŸ” New Releases</h2>
    <div class="horizontal-scroll" id="xxx-new-releases-grid"></div>
  </section>

  <section id="section-adult-my-first-sex-teacher" style="display:none;">
    <h2>ğŸ” My First Sex Teacher</h2>
    <div class="horizontal-scroll" id="adult-my-first-sex-teacher-grid"></div>
  </section>

  <section id="section-adult-moms-teach-sex" style="display:none;">
    <h2>ğŸ” Moms Teach Sex</h2>
    <div class="horizontal-scroll" id="adult-moms-teach-sex-grid"></div>
  </section>

  <section id="section-adult-my-friends-hot-mom" style="display:none;">
    <h2>ğŸ” My Friends Hot Mom</h2>
    <div class="horizontal-scroll" id="adult-my-friends-hot-mom-grid"></div>
  </section>

  <section id="section-adult-bus-bang" style="display:none;">
    <h2>ğŸ” Bus Bang</h2>
    <div class="horizontal-scroll" id="adult-bus-bang-grid"></div>
  </section>

  <section id="section-adult-moms-licks-teen" style="display:none;">
    <h2>ğŸ” Moms Lick Teens</h2>
    <div class="horizontal-scroll" id="adult-moms-licks-teen-grid"></div>
  </section>

  <section id="section-adult-moms-in-control" style="display:none;">
    <h2>ğŸ” Moms in Control</h2>
    <div class="horizontal-scroll" id="adult-moms-in-control-grid"></div>
  </section>

  <section id="section-adult-moms-bang-teens" style="display:none;">
    <h2>ğŸ” Moms Bang Teens</h2>
    <div class="horizontal-scroll" id="adult-moms-bang-teens-grid"></div>
  </section>

  <section id="section-adult-mom-is-horny" style="display:none;">
    <h2>ğŸ” Mom is Horny</h2>
    <div class="horizontal-scroll" id="adult-mom-is-horny-grid"></div>
  </section>

  <section id="section-adult-seduced-by-cougar" style="display:none;">
    <h2>ğŸ” Seduced by a Cougar</h2>
    <div class="horizontal-scroll" id="adult-seduced-by-cougar-grid"></div>
  </section>

  <section id="section-adult-sharing-with-stepmom" style="display:none;">
    <h2>ğŸ” Sharing with Stepmom</h2>
    <div class="horizontal-scroll" id="adult-sharing-with-stepmom-grid"></div>
  </section>

  <section id="section-adult-sneaky-sex" style="display:none;">
    <h2>ğŸ” Sneaky Sex</h2>
    <div class="horizontal-scroll" id="adult-sneaky-sex-grid"></div>
  </section>

  <section id="section-adult-step-siblings-caught" style="display:none;">
    <h2>ğŸ” Step Siblings Caught</h2>
    <div class="horizontal-scroll" id="adult-step-siblings-caught-grid"></div>
  </section>

  <section id="section-adult-size-does-matter" style="display:none;">
    <h2>ğŸ” Size Does Matter</h2>
    <div class="horizontal-scroll" id="adult-size-does-matter-grid"></div>
  </section>

  <section id="section-adult-anal-creampie-lessons" style="display:none;">
    <h2>ğŸ” Anal Creampie Lessons</h2>
    <div class="horizontal-scroll" id="adult-anal-creampie-lessons-grid"></div>
  </section>

  <section id="section-adult-hookup-hotshot" style="display:none;">
    <h2>ğŸ” Hookup Hotshot</h2>
    <div class="horizontal-scroll" id="adult-hookup-hotshot-grid"></div>
  </section>

  <section id="section-adult-anal" style="display:none;">
    <h2>ğŸ” Anal Sluts</h2>
    <div class="horizontal-scroll" id="adult-anal-grid"></div>
  </section>

  <section id="section-adult-milfs" style="display:none;">
    <h2>ğŸ” MILFs</h2>
    <div class="horizontal-scroll" id="adult-milfs-grid"></div>
  </section>

  <section id="section-adult-teen" style="display:none;">
    <h2>ğŸ” Teens</h2>
    <div class="horizontal-scroll" id="adult-teen-grid"></div>
  </section>

    <section id="section-adult-moms" style="display:none;">
    <h2>ğŸ” Horny Moms</h2>
    <div class="horizontal-scroll" id="adult-moms-grid"></div>
  </section>

  <section id="section-adult-xxx-parody" style="display:none;">
    <h2>ğŸ” XXX Parody</h2>
    <div class="horizontal-scroll" id="adult-xxx-parody-grid"></div>
  </section>

  <!-- FAVORITES SECTION - XXX MODE -->

  <section id="section-xxx-favorites" style="display:none;">
    <h2>ğŸ”â­ XXX Favorites</h2>
    <div class="filter-buttons">
      <button class="filter-btn active" data-filter="all-xxx-fav">All</button>
      <button class="filter-btn" data-filter="movies-xxx-fav">Movies</button>
      <button class="filter-btn" data-filter="actors-xxx-fav">Actors</button>
    </div>
    <div class="vertical-grid" id="xxx-favorites-grid"></div>
  </section>

  <!-- GENRE BUTTONS - NEW -->

  <div class="genre-buttons-container" id="genre-buttons-container">
    <h2>Browse by Genre</h2>
    <div class="genre-buttons-scroll" id="genre-buttons"></div>
  </div>

  <!-- TMDB ATTRIBUTION - NEW -->

  <div class="tmdb-attribution">
    <a href="https://www.themoviedb.org" target="_blank" rel="noopener">
      <img src="https://www.themoviedb.org/assets/2/v4/logos/v2/blue_long_2-9665a76b1ae401a510ec1e0ca40ddcb3b0cfe45f1d51b77a308fea0845885648.svg" alt="Powered by TMDB">
    </a>
  </div>

  <div id="detail-view">
    <div id="detail-content">
      <span id="detail-close">Ã—</span>
      <div id="detail-body"></div>
    </div>
  </div>

  <div id="image-lightbox">
    <img id="lightbox-img" src="" alt="Full size">
  </div>

  <div id="footer">
    <div class="weather-widget" id="weatherWidget">
      <div class="weather-icon-temp">
        <span class="weather-icon" id="weatherIcon">ğŸŒ¤ï¸</span>
        <span class="weather-temp" id="weatherTemp">--Â°</span>
      </div>
      <span class="weather-divider">|</span>
      <div class="weather-time-wrapper">
        <span class="weather-time" id="weatherTime">--:--</span>
      </div>
      <span class="weather-divider">|</span>
      <div class="weather-condition-wrapper">
        <span class="weather-condition" id="weatherCondition">Loading...</span>
      </div>
      <span class="weather-divider">|</span>
      <div class="weather-location-wrapper">
        <span class="weather-location" id="weatherLocation">--</span>
      </div>
    </div>

<div id="easterEgg">Created by Rudeboyâ„¢</div>

  </div>

  <div id="easter-egg-overlay">
    <canvas id="matrixCanvas" class="matrix-canvas"></canvas>
  </div>

<audio id="easterAudio" preload="none"></audio>

  <script>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       API CONFIGURATION
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    const API_PROXY = "/api/tmdb"; // Use Vercel serverless function for both APIs
const TMDB_IMG = "https://image.tmdb.org/t/p/w500";
const YT_EMBED = "https://www.youtube.com/embed/";

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       GLOBAL STATE
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    let isAdultMode = localStorage.getItem('adultMode') === 'true';
    let currentMovieId = null;
    let currentDetailItem = null; // Store current detail item for favorite toggle
    let searchTimeout = null;

    // Favorites storage (localStorage)
    let favorites = JSON.parse(localStorage.getItem('favorites')) || { movies: [], tv: [], actors: [] };
    let xxxFavorites = JSON.parse(localStorage.getItem('xxxFavorites')) || { movies: [], actors: [] };

    // Genre list with IDs from TMDB (NORMAL MODE)
    const GENRES = [
      { id: 28, name: 'Action' },
      { id: 12, name: 'Adventure' },
      { id: 16, name: 'Animation' },
      { id: 35, name: 'Comedy' },
      { id: 80, name: 'Crime' },
      { id: 99, name: 'Documentary' },
      { id: 18, name: 'Drama' },
      { id: 10751, name: 'Family' },
      { id: 14, name: 'Fantasy' },
      { id: 36, name: 'History' },
      { id: 27, name: 'Horror' },
      { id: 10402, name: 'Music' },
      { id: 9648, name: 'Mystery' },
      { id: 10749, name: 'Romance' },
      { id: 878, name: 'Sci-Fi' },
      { id: 10770, name: 'TV Movie' },
      { id: 53, name: 'Thriller' },
      { id: 10752, name: 'War' },
      { id: 37, name: 'Western' }
    ];

    // Adult genre list (XXX MODE) - Top 8 adult search terms
    const ADULT_GENRES = [
      { query: 'milfs', name: 'MILFs' },
      { query: 'anal', name: 'Anal' },
      { query: 'creampie', name: 'Creampie' },
      { query: 'threesome lesbian', name: 'Threesome' },
      { query: 'big tits', name: 'Big Tits' },
      { query: 'teen', name: 'Teen' },
      { query: 'stepmom', name: 'Stepmom' },
		{ query: 'Family Pies', name: 'Family Pies' },
		{ query: 'Comes First', name: 'Comes First' },
		{ query: 'I have a wife', name: 'I have a Wife' },
		{ query: 'Like it Big', name: 'Like it Big' },
		{ query: 'Wet Ass', name: 'Wet Ass' },
      { query: 'squirting', name: 'Squirting' }
    ];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FAVORITES SYSTEM
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function saveFavorites() {
  localStorage.setItem('favorites', JSON.stringify(favorites));
  localStorage.setItem('xxxFavorites', JSON.stringify(xxxFavorites));
}

function isFavorited(id, type) {
  const favList = isAdultMode ? xxxFavorites : favorites;
  if (type === 'person' || type === 'actor') {
    return favList.actors.some(f => f.id === id);
  } else if (type === 'tv') {
    return isAdultMode ? false : favList.tv.some(f => f.id === id);
  } else {
    return favList.movies.some(f => f.id === id);
  }
}

function toggleFavorite(item, type) {
  const favList = isAdultMode ? xxxFavorites : favorites;
  const id = item.id;
  
  if (type === 'person' || type === 'actor') {
    const index = favList.actors.findIndex(f => f.id === id);
    if (index > -1) {
      favList.actors.splice(index, 1);
    } else {
      favList.actors.push({ ...item, media_type: 'person' });
    }
  } else if (type === 'tv') {
    if (isAdultMode) return; // No TV in XXX mode
    const index = favList.tv.findIndex(f => f.id === id);
    if (index > -1) {
      favList.tv.splice(index, 1);
    } else {
      favList.tv.push({ ...item, media_type: 'tv' });
    }
  } else {
    const index = favList.movies.findIndex(f => f.id === id);
    if (index > -1) {
      favList.movies.splice(index, 1);
    } else {
      favList.movies.push({ ...item, media_type: 'movie' });
    }
  }
  
  saveFavorites();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOADING FUNCTIONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function showLoading(options = {}) {
  const { message = 'Loading...', subtext = '', showProgress = false, progress = 0 } = options;
  const loadingText = document.getElementById('loadingText');
  if (loadingText) loadingText.textContent = message;
  const loadingSubtext = document.getElementById('loadingSubtext');
  if (loadingSubtext) loadingSubtext.textContent = subtext;
  const progressContainer = document.getElementById('progressBarContainer');
  const progressFill = document.getElementById('progressBarFill');
  if (showProgress && progressContainer && progressFill) {
    progressContainer.classList.add('visible');
    progressFill.style.width = `${progress}%`;
  } else if (progressContainer) {
    progressContainer.classList.remove('visible');
  }
  document.getElementById('loadingOverlay').classList.add('visible');
}

function hideLoading() {
  setTimeout(() => {
    document.getElementById('loadingOverlay').classList.remove('visible');
    const progressContainer = document.getElementById('progressBarContainer');
    const progressFill = document.getElementById('progressBarFill');
    if (progressContainer) progressContainer.classList.remove('visible');
    if (progressFill) progressFill.style.width = '0%';
  }, 500);
}

function updateLoadingProgress(percent, message) {
  const progressFill = document.getElementById('progressBarFill');
  const loadingText = document.getElementById('loadingText');
  if (progressFill) progressFill.style.width = `${percent}%`;
  if (loadingText && message) loadingText.textContent = message;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOGO CLICK - RELOAD WITH ANIMATION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('logo').addEventListener('click', () => {
  showLoading({ message: 'Reloading...', subtext: 'Refreshing Watcher', showProgress: true, progress: 50 });
  let prog = 50;
  const reloadInterval = setInterval(() => {
    prog += 10;
    updateLoadingProgress(Math.min(prog, 90), 'Reloading...');
  }, 280);
  setTimeout(() => {
    clearInterval(reloadInterval);
    updateLoadingProgress(100, 'Complete!');
    setTimeout(() => location.reload(), 200);
  }, 3000);
});

document.getElementById('image-lightbox').onclick = () => {
  document.getElementById('image-lightbox').classList.remove('active');
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TMDB API CALLS WITH FILTERING
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

// Helper function to check if content should be filtered (gay/trans content)
function shouldFilterContent(item) {
  if (!isAdultMode) return false; // Only filter in adult mode
  
  const title = (item.title || item.name || '').toLowerCase();
  const overview = (item.overview || '').toLowerCase();
  const combined = title + ' ' + overview;
  
  // Keywords that specifically indicate gay male content (must be whole words or clear context)
  const gayKeywords = [
    'gay ', ' gay', 'gay,', 'gay.', 'gay:', 'gay;',
    'homosexual', 'twink', 'gay men', 'gay sex', 
    'men loving men', 'male on male', 'gay porn',
    'gay couple', 'gay relationship', 'gay love'
  ];
  
  // Keywords for trans content
  const transKeywords = [
    'trans ', ' trans', 'transgender', 'shemale', 'ladyboy',
    'trans woman', 'trans man', 'transsexual'
  ];
  
  // Suspicious keywords that often appear in gay content titles
  const suspiciousKeywords = [
    'doctor', 'doctors', 'cavity', 'exam', 'medical',
    'police', 'officer', 'prisoner', 'jail', 'inmate',
    'coach', 'locker', 'teammate', 'jock', 'athlete',
    'military', 'soldier', 'barracks', 'army', 'marine',
    'frat', 'fraternity', 'brother', 'hazing',
    'mechanic', 'garage', 'construction', 'worker'
  ];
  
  // Check for gay male keywords
  for (const keyword of gayKeywords) {
    if (combined.includes(keyword)) {
      return true; // Filter this content
    }
  }
  
  // Check for trans keywords
  for (const keyword of transKeywords) {
    if (combined.includes(keyword)) {
      return true; // Filter this content
    }
  }
  
  // Check for suspicious keywords combined with numbers (common pattern: "Doctors Tapes 9")
  for (const keyword of suspiciousKeywords) {
    if (title.includes(keyword)) {
      // If title has suspicious keyword + number, likely gay content
      if (/\d+/.test(title)) {
        return true; // Filter numbered series with suspicious keywords
      }
      
      // If title ONLY has suspicious keywords without female indicators, filter it
      const hasFemaleIndicators = 
        combined.includes('girl') || combined.includes('woman') || 
        combined.includes('milf') || combined.includes('mom') ||
        combined.includes('teen girl') || combined.includes('she ') ||
        combined.includes('her ') || combined.includes('lesbian') ||
        combined.includes('cougar') || combined.includes('wife') ||
        combined.includes('step mom') || combined.includes('stepmom') ||
        combined.includes('step sister') || combined.includes('stepsister');
      
      if (!hasFemaleIndicators && title.split(' ').length <= 4) {
        // Short title with suspicious keyword and no female indicators = likely gay
        return true;
      }
    }
  }
  
  return false; // Don't filter
}

async function tmdb(endpoint, params = {}) {
  const url = new URL(API_PROXY, window.location.origin);
  url.searchParams.set('api', 'tmdb');
  url.searchParams.set('endpoint', endpoint);
  url.searchParams.set('language', 'en-US');
  url.searchParams.set('include_adult', 'false');
  Object.entries(params).forEach(([k, v]) => {
    url.searchParams.set(k, v);
  });
  const res = await fetch(url);
  if (!res.ok) throw new Error(`TMDB ${res.status}`);
  return res.json();
}

async function tmdbAdult(endpoint, params = {}) {
  const url = new URL(API_PROXY, window.location.origin);
  url.searchParams.set('api', 'tmdb');
  url.searchParams.set('endpoint', endpoint);
  url.searchParams.set('language', 'en-US');
  url.searchParams.set('include_adult', 'true');
  Object.entries(params).forEach(([k, v]) => {
    url.searchParams.set(k, v);
  });
  const res = await fetch(url);
  if (!res.ok) throw new Error(`TMDB ${res.status}`);
  const data = await res.json();
  
  if (data.results && isAdultMode) {
    data.results = data.results.filter(item => !shouldFilterContent(item));
  }
  
  return data;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   IMAGE HELPERS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

async function getImageUrl(item, type = 'poster') {
  if (type === 'poster' && item.poster_path) {
    return `${TMDB_IMG}${item.poster_path}`;
  }
  if (item.backdrop_path) {
    return `${TMDB_IMG}${item.backdrop_path}`;
  }
  try {
  const mediaType = item.media_type === 'tv' ? 'tv' : 'movies';
  const url = new URL(API_PROXY, window.location.origin);
  url.searchParams.set('api', 'fanart');
  url.searchParams.set('endpoint', `/${mediaType}/${item.id}`);
  
  const response = await fetch(url);
  if (response.ok) {
    const data = await response.json();
    if (data.movieposter && data.movieposter[0]) return data.movieposter[0].url;
    if (data.tvposter && data.tvposter[0]) return data.tvposter[0].url;
    if (data.moviebackground && data.moviebackground[0]) return data.moviebackground[0].url;
    if (data.showbackground && data.showbackground[0]) return data.showbackground[0].url;
  }
} catch (err) {
  console.log('Fanart.tv fallback failed:', err);
}
  return null;
}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARD RENDERING WITH FAVORITES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

async function renderHorizontal(gridId, items) {
  const grid = document.getElementById(gridId);
  if (!grid) return;
  grid.innerHTML = '';
  for (const item of items) {
    if (!item.poster_path && !item.backdrop_path && !item.profile_path) continue;
    const title = item.title || item.name || 'Unknown';
    const year = (item.release_date || item.first_air_date || '').slice(0, 4);
    let imageUrl;
    if (item.media_type === 'person' || item.known_for_department) {
      imageUrl = item.profile_path ? `${TMDB_IMG}${item.profile_path}` : null;
    } else {
      imageUrl = await getImageUrl(item);
    }
    if (!imageUrl) continue;
    
    const card = document.createElement('div');
    card.className = 'card';
    
    // Determine type for favorites
    const type = item.media_type || (item.known_for_department ? 'person' : (item.first_air_date ? 'tv' : 'movie'));
    const favorited = isFavorited(item.id, type);
    
    card.innerHTML = `
      <button class="favorite-btn ${favorited ? 'favorited' : ''}" onclick="event.stopPropagation(); toggleFavoriteFromCard(${item.id}, '${type}', this, ${JSON.stringify(item).replace(/"/g, '&quot;')})">
        ${favorited ? 'â­' : 'â˜†'}
      </button>
      <img class="poster" src="${imageUrl}" loading="lazy" alt="${title}">
      <div class="info">
        ${year ? `<div class="year">${year}</div>` : ''}
      </div>
    `;
    card.onclick = () => openDetail(item);
    grid.appendChild(card);
  }
}

async function renderVerticalGrid(gridId, items, showActorNames = false) {
  const grid = document.getElementById(gridId);
  if (!grid) return;
  grid.innerHTML = '';
  grid.className = 'vertical-grid';
  for (const item of items) {
    if (!item.poster_path && !item.backdrop_path && !item.profile_path) continue;
    const title = item.title || item.name || 'Unknown';
    const year = (item.release_date || item.first_air_date || '').slice(0, 4);
    let imageUrl;
    if (item.media_type === 'person' || item.known_for_department) {
      imageUrl = item.profile_path ? `${TMDB_IMG}${item.profile_path}` : null;
    } else {
      imageUrl = await getImageUrl(item);
    }
    if (!imageUrl) continue;
    
    const card = document.createElement('div');
    card.className = 'card';
    
    const type = item.media_type || (item.known_for_department ? 'person' : (item.first_air_date ? 'tv' : 'movie'));
    const favorited = isFavorited(item.id, type);
    
    let infoHtml = '';
    if (showActorNames && (item.media_type === 'person' || item.known_for_department)) {
      infoHtml = `<div class="actor-name-label">${title}</div>`;
    } else {
      infoHtml = year ? `<div class="year">${year}</div>` : '';
    }
    
    card.innerHTML = `
      <button class="favorite-btn ${favorited ? 'favorited' : ''}" onclick="event.stopPropagation(); toggleFavoriteFromCard(${item.id}, '${type}', this, ${JSON.stringify(item).replace(/"/g, '&quot;')})">
        ${favorited ? 'â­' : 'â˜†'}
      </button>
      <img class="poster" src="${imageUrl}" loading="lazy" alt="${title}">
      <div class="info">${infoHtml}</div>
    `;
    card.onclick = () => openDetail(item);
    grid.appendChild(card);
  }
}

// Helper function to toggle favorite from card button
function toggleFavoriteFromCard(id, type, btn, itemData) {
  toggleFavorite(itemData, type);
  const favorited = isFavorited(id, type);
  btn.classList.toggle('favorited', favorited);
  btn.textContent = favorited ? 'â­' : 'â˜†';
  
  // Update detail view favorite button if open
  updateDetailFavoriteButton();
  
  // Update ALL other star buttons on the page for this same item
  document.querySelectorAll('.favorite-btn').forEach(otherBtn => {
    if (otherBtn === btn) return; // Skip the button we just clicked
    
    const onclickAttr = otherBtn.getAttribute('onclick');
    const idMatch = onclickAttr.match(/toggleFavoriteFromCard\((\d+),\s*'([^']+)'/);
    
    if (idMatch && parseInt(idMatch[1]) === id && idMatch[2] === type) {
      // This is the same item, update it
      otherBtn.classList.toggle('favorited', favorited);
      otherBtn.textContent = favorited ? 'â­' : 'â˜†';
    }
  });
  
  // Reload favorites section
  loadFavorites();
}

// Helper to update detail favorite button
function updateDetailFavoriteButton() {
  const detailFavBtn = document.getElementById('detail-favorite-btn');
  if (detailFavBtn && currentDetailItem) {
    const type = currentDetailItem.media_type || 
                 (currentDetailItem.known_for_department ? 'person' : 
                 (currentDetailItem.first_air_date ? 'tv' : 'movie'));
    const favorited = isFavorited(currentDetailItem.id, type);
    detailFavBtn.classList.toggle('favorited', favorited);
    detailFavBtn.innerHTML = `<span class="star-icon">${favorited ? 'â­' : 'â˜†'}</span> ${favorited ? 'Favorited' : 'Add Favorite'}`;
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION LOADING
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

async function loadSection(endpoint, params, gridId, maxPages = 3, useAdultAPI = false) {
  let allResults = [];
  for (let page = 1; page <= maxPages; page++) {
    try {
      const apiFunc = useAdultAPI ? tmdbAdult : tmdb;
      const { results } = await apiFunc(endpoint, { ...params, page });
      allResults = allResults.concat(results || []);
    } catch (err) {
      console.error(`Failed to load page ${page}:`, err);
      break;
    }
  }
  await renderHorizontal(gridId, allResults);
  
  // Enable infinite scroll for this section
  enableInfiniteScroll(endpoint, params, gridId);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GENRE BUTTONS RENDERING
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function renderGenreButtons() {
  const genreButtons = document.getElementById('genre-buttons');
  if (!genreButtons) return;
  
  genreButtons.innerHTML = '';
  const genreList = isAdultMode ? ADULT_GENRES : GENRES;
  
  genreList.forEach((genre, index) => {
    const btn = document.createElement('button');
    btn.className = `genre-btn ${index % 2 === 0 ? 'green-bg' : 'purple-bg'}`;
    btn.textContent = genre.name;
    
    if (isAdultMode) {
      btn.onclick = () => searchByAdultGenre(genre.query, genre.name);
    } else {
      btn.onclick = () => searchByGenre(genre.id, genre.name);
    }
    
    genreButtons.appendChild(btn);
  });
}

async function searchByGenre(genreId, genreName) {
  showLoading({ message: `Loading ${genreName}...`, showProgress: false });
  
  // Hide all normal sections
  document.querySelectorAll('section[id^="section-"]').forEach(s => s.style.display = 'none');
  document.getElementById('genre-buttons-container').style.display = 'none';
  
  let searchSection = document.getElementById('search-results');
  if (!searchSection) {
    searchSection = document.createElement('section');
    searchSection.id = 'search-results';
    document.querySelector('#section-airing').before(searchSection);
  }
  
  const apiFunc = isAdultMode ? tmdbAdult : tmdb;
  let allResults = [];
  
  // Load multiple pages for endless scroll effect
  for (let page = 1; page <= 5; page++) {
    try {
      const data = await apiFunc('/discover/movie', {
        with_genres: genreId,
        sort_by: 'popularity.desc',
        page: page
      });
      allResults = allResults.concat(data.results || []);
    } catch (err) {
      console.error(`Failed to load page ${page}:`, err);
      break;
    }
  }
  
  searchSection.innerHTML = `
    <h2>${genreName} Movies</h2>
    <div class="vertical-grid" id="search-grid"></div>
    <button class="btn" onclick="backToHome()">Back to Browse</button>
  `;
  searchSection.style.display = 'block';
  
  await renderVerticalGrid('search-grid', allResults);
  hideLoading();
}

async function searchByAdultGenre(query, genreName) {
  showLoading({ message: `Loading ${genreName}...`, showProgress: false });
  
  // Hide all sections
  document.querySelectorAll('section[id^="section-"]').forEach(s => s.style.display = 'none');
  document.getElementById('genre-buttons-container').style.display = 'none';
  
  let searchSection = document.getElementById('search-results');
  if (!searchSection) {
    searchSection = document.createElement('section');
    searchSection.id = 'search-results';
    document.querySelector('#section-xxx-new-releases').before(searchSection);
  }
  
  let allResults = [];
  
  // Load multiple pages
  for (let page = 1; page <= 5; page++) {
    try {
      const data = await tmdbAdult('/search/movie', { query: query, page: page });
      allResults = allResults.concat(data.results || []);
    } catch (err) {
      console.error(`Failed to load page ${page}:`, err);
      break;
    }
  }
  
  searchSection.innerHTML = `
    <h2>ğŸ” ${genreName}</h2>
    <div class="vertical-grid" id="search-grid"></div>
    <button class="btn" onclick="backToHome()">Back to Browse</button>
  `;
  searchSection.style.display = 'block';
  
  await renderVerticalGrid('search-grid', allResults);
  hideLoading();
}

function backToHome() {
  const searchSection = document.getElementById('search-results');
  if (searchSection) searchSection.remove();
  document.getElementById('genre-buttons-container').style.display = 'block';
  disableInfiniteScroll();
  loadHome();
}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADULT SECTIONS - RANDOMIZED
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function shuffleArray(array) {
  const shuffled = [...array];
  for (let i = shuffled.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
  }
  return shuffled;
}

async function loadAdultSections() {
  console.log('Loading adult content with randomization and filtering...');
  const today = new Date().toISOString().split('T')[0];
  try {
    await Promise.all([
      (async () => {
        const data = await tmdbAdult('/discover/movie', {
          'sort_by': 'release_date.desc',
          'with_release_type': '4',
          'certification_country': 'US',
          'certification': 'NC-17',
          'release_date.lte': today
        });
        const results = (data.results || []).filter(m => m.adult === true).slice(0, 20);
        await renderHorizontal('xxx-new-releases-grid', results);
      })(),
      (async () => {
        const data = await tmdbAdult('/search/movie', { query: 'my first sex teacher', page: 1 });
        const results = shuffleArray(data.results || []).slice(0, 20);
        await renderHorizontal('adult-my-first-sex-teacher-grid', results);
      })(),
      (async () => {
        const data = await tmdbAdult('/search/movie', { query: 'moms teach sex', page: 1 });
        const results = shuffleArray(data.results || []).slice(0, 20);
        await renderHorizontal('adult-moms-teach-sex-grid', results);
      })(),
      (async () => {
        const data = await tmdbAdult('/search/movie', { query: 'my friends hot mom', page: 1 });
        const results = shuffleArray(data.results || []).slice(0, 20);
        await renderHorizontal('adult-my-friends-hot-mom-grid', results);
      })(),
      (async () => {
        const data = await tmdbAdult('/search/movie', { query: 'bus bang', page: 1 });
        const results = shuffleArray(data.results || []).slice(0, 20);
        await renderHorizontal('adult-bus-bang-grid', results);
      })(),
      (async () => {
        const data = await tmdbAdult('/search/movie', { query: 'moms lick teens', page: 1 });
        const results = shuffleArray(data.results || []).slice(0, 20);
        await renderHorizontal('adult-moms-licks-teen-grid', results);
      })(),
      (async () => {
        const data = await tmdbAdult('/search/movie', { query: 'moms in control', page: 1 });
        const results = shuffleArray(data.results || []).slice(0, 20);
        await renderHorizontal('adult-moms-in-control-grid', results);
      })(),
      (async () => {
        const data = await tmdbAdult('/search/movie', { query: 'moms bang teens', page: 1 });
        const results = shuffleArray(data.results || []).slice(0, 20);
        await renderHorizontal('adult-moms-bang-teens-grid', results);
      })(),
      (async () => {
        const data = await tmdbAdult('/search/movie', { query: 'mom is horny', page: 1 });
        const results = shuffleArray(data.results || []).slice(0, 20);
        await renderHorizontal('adult-mom-is-horny-grid', results);
      })(),
      (async () => {
        const data = await tmdbAdult('/search/movie', { query: 'seduced by a cougar', page: 1 });
        const results = shuffleArray(data.results || []).slice(0, 20);
        await renderHorizontal('adult-seduced-by-cougar-grid', results);
      })(),
      (async () => {
        const data = await tmdbAdult('/search/movie', { query: 'sharing with stepmom', page: 1 });
        const results = shuffleArray(data.results || []).slice(0, 20);
        await renderHorizontal('adult-sharing-with-stepmom-grid', results);
      })(),
      (async () => {
        const data = await tmdbAdult('/search/movie', { query: 'sneaky sex', page: 1 });
        const results = shuffleArray(data.results || []).slice(0, 20);
        await renderHorizontal('adult-sneaky-sex-grid', results);
      })(),
      (async () => {
        const data = await tmdbAdult('/search/movie', { query: 'step siblings caught', page: 1 });
        const results = shuffleArray(data.results || []).slice(0, 20);
        await renderHorizontal('adult-step-siblings-caught-grid', results);
      })(),
      (async () => {
        const data = await tmdbAdult('/search/movie', { query: 'size does matter', page: 1 });
        const results = shuffleArray(data.results || []).slice(0, 20);
        await renderHorizontal('adult-size-does-matter-grid', results);
      })(),
      (async () => {
        const data = await tmdbAdult('/search/movie', { query: 'anal creampie lessons', page: 1 });
        const results = shuffleArray(data.results || []).slice(0, 20);
        await renderHorizontal('adult-anal-creampie-lessons-grid', results);
      })(),
      (async () => {
        const data = await tmdbAdult('/search/movie', { query: 'hookup hotshot', page: 1 });
        const results = shuffleArray(data.results || []).slice(0, 20);
        await renderHorizontal('adult-hookup-hotshot-grid', results);
      })(),
      (async () => {
        const data = await tmdbAdult('/search/movie', { query: 'anal sluts', page: 1 });
        const results = shuffleArray(data.results || []).slice(0, 20);
        await renderHorizontal('adult-anal-grid', results);
      })(),
      (async () => {
        const data = await tmdbAdult('/search/movie', { query: 'milfs', page: 1 });
        const results = shuffleArray(data.results || []).slice(0, 20);
        await renderHorizontal('adult-milfs-grid', results);
      })(),
      (async () => {
        const data = await tmdbAdult('/search/movie', { query: 'teens', page: 1 });
        const results = shuffleArray(data.results || []).slice(0, 20);
        await renderHorizontal('adult-teen-grid', results);
      })(),
            (async () => {
        const data = await tmdbAdult('/search/movie', { query: 'horny moms', page: 1 });
        const results = shuffleArray(data.results || []).slice(0, 20);
        await renderHorizontal('adult-moms-grid', results);
      })(),
      (async () => {
        const data = await tmdbAdult('/search/movie', { query: 'xxx parody', page: 1 });
        const results = shuffleArray(data.results || []).slice(0, 20);
        await renderHorizontal('adult-xxx-parody-grid', results);
      })()
    ]);
  } catch (err) {
    console.error('Failed to load adult sections:', err);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOAD FAVORITES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

async function loadFavorites() {
  const favList = isAdultMode ? xxxFavorites : favorites;
  const section = isAdultMode ? 
    document.getElementById('section-xxx-favorites') : 
    document.getElementById('section-favorites');
  
  if (!section) return;
  
  const allFavorites = [
    ...favList.movies,
    ...(isAdultMode ? [] : favList.tv),
    ...favList.actors
  ];
  
  if (allFavorites.length === 0) {
    section.style.display = 'none';
    return;
  }
  
  section.style.display = 'block';
  const gridId = isAdultMode ? 'xxx-favorites-grid' : 'favorites-grid';
  await renderVerticalGrid(gridId, allFavorites, true);
  
  // Setup filter buttons
  const filterPrefix = isAdultMode ? 'xxx-fav' : 'fav';
  document.querySelectorAll(`[data-filter$="${filterPrefix}"]`).forEach(btn => {
    btn.onclick = async () => {
      document.querySelectorAll(`[data-filter$="${filterPrefix}"]`).forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      const filter = btn.dataset.filter;
      let filtered = [];
      
      if (filter === `all-${filterPrefix}`) {
        filtered = allFavorites;
      } else if (filter === `movies-${filterPrefix}`) {
        filtered = favList.movies;
      } else if (filter === `tv-${filterPrefix}`) {
        filtered = favList.tv || [];
      } else if (filter === `actors-${filterPrefix}`) {
        filtered = favList.actors;
      }
      
      await renderVerticalGrid(gridId, filtered, filter.includes('actors'));
    };
  });
}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HOME PAGE LOADING
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

async function loadHome() {
  showLoading({ message: 'Loading Watcher...', showProgress: false });
  const today = new Date().toISOString().split('T')[0];
  const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
  const monthFromNow = new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];

  try {
    if (isAdultMode) {
      console.log('ğŸ” ADULT MODE');
      document.getElementById('section-airing').style.display = 'none';
      document.getElementById('section-new-releases').style.display = 'none';
      document.getElementById('section-trending-tv').style.display = 'none';
      document.getElementById('section-trending-movies').style.display = 'none';
      document.getElementById('section-tv-week').style.display = 'none';
      document.getElementById('section-movies-week').style.display = 'none';
      document.getElementById('section-anticipated-tv').style.display = 'none';
      document.getElementById('section-anticipated-movies').style.display = 'none';
      document.getElementById('section-favorites').style.display = 'none';
      
      document.getElementById('section-xxx-new-releases').style.display = 'block';
      document.getElementById('section-adult-my-first-sex-teacher').style.display = 'block';
      document.getElementById('section-adult-moms-teach-sex').style.display = 'block';
      document.getElementById('section-adult-my-friends-hot-mom').style.display = 'block';
      document.getElementById('section-adult-bus-bang').style.display = 'block';
      document.getElementById('section-adult-moms-licks-teen').style.display = 'block';
      document.getElementById('section-adult-moms-in-control').style.display = 'block';
      document.getElementById('section-adult-moms-bang-teens').style.display = 'block';
      document.getElementById('section-adult-mom-is-horny').style.display = 'block';
      document.getElementById('section-adult-seduced-by-cougar').style.display = 'block';
      document.getElementById('section-adult-sharing-with-stepmom').style.display = 'block';
      document.getElementById('section-adult-sneaky-sex').style.display = 'block';
      document.getElementById('section-adult-step-siblings-caught').style.display = 'block';
      document.getElementById('section-adult-size-does-matter').style.display = 'block';
      document.getElementById('section-adult-anal-creampie-lessons').style.display = 'block';
      document.getElementById('section-adult-hookup-hotshot').style.display = 'block';
      document.getElementById('section-adult-anal').style.display = 'block';
      document.getElementById('section-adult-milfs').style.display = 'block';
      document.getElementById('section-adult-teen').style.display = 'block';
            document.getElementById('section-adult-moms').style.display = 'block';
      document.getElementById('section-adult-xxx-parody').style.display = 'block';
      
      await loadAdultSections();
      await loadFavorites();
    } else {
      console.log('ğŸ¬ NORMAL MODE');
      document.getElementById('section-xxx-new-releases').style.display = 'none';
      document.getElementById('section-adult-my-first-sex-teacher').style.display = 'none';
      document.getElementById('section-adult-moms-teach-sex').style.display = 'none';
      document.getElementById('section-adult-my-friends-hot-mom').style.display = 'none';
      document.getElementById('section-adult-bus-bang').style.display = 'none';
      document.getElementById('section-adult-moms-licks-teen').style.display = 'none';
      document.getElementById('section-adult-moms-in-control').style.display = 'none';
      document.getElementById('section-adult-moms-bang-teens').style.display = 'none';
      document.getElementById('section-adult-mom-is-horny').style.display = 'none';
      document.getElementById('section-adult-seduced-by-cougar').style.display = 'none';
      document.getElementById('section-adult-sharing-with-stepmom').style.display = 'none';
      document.getElementById('section-adult-sneaky-sex').style.display = 'none';
      document.getElementById('section-adult-step-siblings-caught').style.display = 'none';
      document.getElementById('section-adult-size-does-matter').style.display = 'none';
      document.getElementById('section-adult-anal-creampie-lessons').style.display = 'none';
      document.getElementById('section-adult-hookup-hotshot').style.display = 'none';
      document.getElementById('section-adult-anal').style.display = 'none';
      document.getElementById('section-adult-milfs').style.display = 'none';
      document.getElementById('section-adult-teen').style.display = 'none';
            document.getElementById('section-adult-moms').style.display = 'none';
      document.getElementById('section-adult-xxx-parody').style.display = 'none';
      document.getElementById('section-xxx-favorites').style.display = 'none';
      document.getElementById('section-xxx-favorites').style.display = 'none';
      
      document.getElementById('section-airing').style.display = 'block';
      document.getElementById('section-new-releases').style.display = 'block';
      document.getElementById('section-trending-tv').style.display = 'block';
      document.getElementById('section-trending-movies').style.display = 'block';
      document.getElementById('section-tv-week').style.display = 'block';
      document.getElementById('section-movies-week').style.display = 'block';
      document.getElementById('section-anticipated-tv').style.display = 'block';
      document.getElementById('section-anticipated-movies').style.display = 'block';

      await Promise.all([
        loadSection('/tv/airing_today', {}, 'airing-grid'),
        loadSection('/discover/movie', {
          'sort_by': 'release_date.desc',
          'with_release_type': '4',
          'vote_count.gte': '50',
          'release_date.lte': today
        }, 'new-releases-grid'),
        loadSection('/trending/tv/week', {}, 'trending-tv-grid'),
        loadSection('/trending/movie/week', {}, 'trending-movies-grid'),
        loadSection('/discover/tv', {
          'sort_by': 'popularity.desc',
          'first_air_date.gte': weekAgo,
          'first_air_date.lte': today
        }, 'tv-week-grid'),
        loadSection('/discover/movie', {
          'sort_by': 'popularity.desc',
          'primary_release_date.gte': weekAgo,
          'primary_release_date.lte': today
        }, 'movies-week-grid'),
        loadSection('/discover/tv', {
          'sort_by': 'popularity.desc',
          'first_air_date.gte': today,
          'first_air_date.lte': monthFromNow
        }, 'anticipated-tv-grid'),
        loadSection('/discover/movie', {
          'sort_by': 'popularity.desc',
          'primary_release_date.gte': today,
          'primary_release_date.lte': monthFromNow
        }, 'anticipated-movies-grid')
      ]);
      
      await loadFavorites();
    }
    
    renderGenreButtons();
  } catch (err) {
    console.error('Error loading home:', err);
  }
  hideLoading();
}

function openDetail(item) {
  currentDetailItem = item; // Store for favorite toggle
  if (item.media_type === 'person' || item.known_for_department) {
    openActorDetail(item.id);
  } else if (item.media_type === 'tv' || item.first_air_date) {
    openTVDetail(item.id);
  } else {
    openMovieDetail(item.id);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODE TOGGLE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function toggleAdultMode(force) {
  if (typeof force === 'boolean') {
    isAdultMode = force;
  } else {
    isAdultMode = !isAdultMode;
  }
  localStorage.setItem('adultMode', isAdultMode);
  
  // Show loading and reload page
  showLoading({ message: 'Switching modes...', subtext: 'Reloading content', showProgress: true, progress: 50 });
  
  let prog = 50;
  const reloadInterval = setInterval(() => {
    prog += 10;
    updateLoadingProgress(Math.min(prog, 90), 'Switching modes...');
  }, 100);
  
  setTimeout(() => {
    clearInterval(reloadInterval);
    updateLoadingProgress(100, 'Complete!');
    setTimeout(() => {
      location.reload();
    }, 200);
  }, 1000);
}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MOVIE DETAIL VIEW - WITH WHERE TO WATCH & COLLECTIONS & FAVORITES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

async function openMovieDetail(movieId) {
  currentMovieId = movieId;
  showLoading({ message: 'Loading movie details...', showProgress: false });

  try {
    const apiFunc = isAdultMode ? tmdbAdult : tmdb;
    const data = await apiFunc(`/movie/${movieId}`, {
      append_to_response: 'credits,videos,images,recommendations,similar',
      include_image_language: 'en,null'
    });

    currentDetailItem = { ...data, media_type: 'movie' };

    const title = data.title || 'Unknown';
    const rating = data.vote_average ? data.vote_average.toFixed(1) : 'N/A';
    const overview = data.overview || 'No overview available.';
    const releaseDate = data.release_date || null;
    const allTrailers = data.videos?.results?.filter(v => v.site === 'YouTube') || [];
    const trailers = allTrailers.slice(0, 5);
    const cast = data.credits?.cast || [];
    const posters = data.images?.posters || [];
    const backdrops = data.images?.backdrops || [];
    
    let recommendations = [...(data.recommendations?.results || []), ...(data.similar?.results || [])];
    recommendations = recommendations.filter((item, index, self) => 
      index === self.findIndex(t => t.id === item.id)
    );
    recommendations = recommendations.sort((a, b) => (b.popularity || 0) - (a.popularity || 0)).slice(0, 10);

    let heroImage = null;
    let heroType = null;
    const allHeroImages = [];
    if (posters.length > 0) {
      posters.forEach(p => allHeroImages.push({ path: p.file_path, type: 'poster' }));
    }
    if (backdrops.length > 0) {
      backdrops.forEach(b => allHeroImages.push({ path: b.file_path, type: 'backdrop' }));
    }
    if (allHeroImages.length > 0) {
      const randomHero = allHeroImages[Math.floor(Math.random() * allHeroImages.length)];
      heroImage = randomHero.path;
      heroType = randomHero.type;
    }
    const heroPoster = posters[0]?.file_path || data.poster_path;

    let html = '';
    if (heroImage) {
      html += '<div class="detail-hero">';
      if (heroType === 'backdrop') {
        html += `<img class="detail-backdrop" src="${TMDB_IMG}${heroImage}" alt="Backdrop">`;
      } else {
        html += `<img class="detail-backdrop" src="${TMDB_IMG}${heroImage}" alt="Hero" style="opacity: 0.5;">`;
      }
      html += '<div class="detail-hero-content">';
      if (heroPoster) {
        html += `<img class="detail-poster" src="${TMDB_IMG}${heroPoster}" alt="Poster">`;
      }
      html += `
        <div class="detail-title-block">
          <h2>${title} <span class="rating">${rating}â˜…</span></h2>
          ${releaseDate ? `<div class="release-date">Released: ${new Date(releaseDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div>` : ''}
        </div>
      `;
      html += '</div></div>';
    } else {
      html += `<h2>${title} <span class="rating">${rating}â˜…</span></h2>`;
      if (releaseDate) {
        html += `<div class="release-date">Released: ${new Date(releaseDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div>`;
      }
    }

    html += `<p class="overview">${overview}</p>`;

// ADD DIRECTOR AND PRODUCTION INFO
const crew = data.credits?.crew || [];
const directors = crew.filter(c => c.job === 'Director');
const producers = crew.filter(c => c.job === 'Producer').slice(0, 3);
const writers = crew.filter(c => c.job === 'Screenplay' || c.job === 'Writer').slice(0, 3);
const productionCompanies = data.production_companies?.slice(0, 3).map(c => c.name).join(', ') || '';

if (directors.length > 0 || producers.length > 0 || writers.length > 0 || productionCompanies) {
  html += '<div class="crew-info">';
  
  if (directors.length > 0) {
    html += `<div class="crew-item"><span class="crew-label">Director:</span><span class="crew-value">${directors.map(d => d.name).join(', ')}</span></div>`;
  }
  
  if (writers.length > 0) {
    html += `<div class="crew-item"><span class="crew-label">Writer:</span><span class="crew-value">${writers.map(w => w.name).join(', ')}</span></div>`;
  }
  
  if (producers.length > 0) {
    html += `<div class="crew-item"><span class="crew-label">Producer:</span><span class="crew-value">${producers.map(p => p.name).join(', ')}</span></div>`;
  }
  
  if (productionCompanies) {
    html += `<div class="crew-item"><span class="crew-label">Studio:</span><span class="crew-value">${productionCompanies}</span></div>`;
  }
  
  if (data.runtime) {
    const hours = Math.floor(data.runtime / 60);
    const minutes = data.runtime % 60;
    const runtime = hours > 0 ? `${hours}h ${minutes}m` : `${minutes}m`;
    html += `<div class="crew-item"><span class="crew-label">Runtime:</span><span class="crew-value">${runtime}</span></div>`;
  }
  
  html += '</div>';
}

// Action buttons container
html += '<div class="detail-actions">';

    if (data.belongs_to_collection) {
      html += `<button class="collections-btn" onclick="showCollection(${data.belongs_to_collection.id})">View Collection: ${data.belongs_to_collection.name}</button>`;
    }

    if (isAdultMode) {
      html += `
        <a href="https://www.xvideos.com" target="_blank" rel="noopener noreferrer" class="where-to-watch-btn">
          <span>Watch on xvideos</span>
          <span style="font-size: 1.2rem;">ğŸ”</span>
        </a>
      `;
    } else {
      html += `
        <a href="https://discord.gg/ZwGK9RnCrh" target="_blank" rel="noopener" class="where-to-watch-btn">
          <span>Where to Watch</span>
          <img class="where-to-watch-icon" src="https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/icons/couch.png" alt="Watch">
        </a>
      `;
    }

    // Add favorite button
const favorited = isFavorited(movieId, 'movie');
html += `
  <button class="detail-favorite-btn ${favorited ? 'favorited' : ''}" id="detail-favorite-btn" onclick="toggleDetailFavorite()">
    <span class="star-icon">${favorited ? 'â­' : 'â˜†'}</span> ${favorited ? 'Favorited' : 'Add Favorite'}
  </button>
`;

    html += '</div>'; // Close detail-actions

    if (trailers.length > 0) {
  html += '<h3>Trailers</h3><div class="trailers-scroll">';
  trailers.forEach((trailer) => {
    html += `
      <div class="trailer-container">
        <iframe src="${YT_EMBED}${trailer.key}?rel=0&playsinline=1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
      </div>
    `;
  });
  html += '</div>';
} else if (isAdultMode) {
  // Fallback: No YouTube trailers in adult mode
  const searchTitle = encodeURIComponent(title);
  html += '<h3>Trailers</h3>';
  html += `
    <p style="color: rgba(255,255,255,0.7); font-size: 0.85rem; margin-bottom: 1rem;">YouTube trailers not available</p>
    <a href="https://us.dvderotik.com/search.php?keywords=${searchTitle}" target="_blank" rel="noopener noreferrer" class="btn">
      Find Trailers (18+)
    </a>
  `;
}

    if (directors.length > 0) {
  html += '<h3>Director</h3><div class="cast-scroll" id="director-scroll"></div>';
}

if (cast.length > 0) {
  html += '<h3>Cast</h3><div class="cast-scroll" id="cast-scroll"></div>';
}

    if (recommendations.length > 0) {
      html += '<h3>You Might Also Like</h3><div class="recommendations-scroll" id="recommendations-scroll"></div>';
    }

    if (posters.length > 0 || backdrops.length > 0) {
      html += '<div class="image-gallery">';
      if (posters.length > 0) {
        html += `<h3>Posters (${posters.length})</h3><div class="gallery-scroll">`;
        posters.forEach(img => {
          html += `<div class="gallery-image" onclick="openLightbox('${TMDB_IMG}${img.file_path}')"><img src="${TMDB_IMG}${img.file_path}" alt="Poster"></div>`;
        });
        html += '</div>';
      }
      if (backdrops.length > 0) {
        html += `<h3>Backdrops (${backdrops.length})</h3><div class="gallery-scroll">`;
        backdrops.forEach(img => {
          html += `<div class="gallery-image" onclick="openLightbox('${TMDB_IMG}${img.file_path}')"><img src="${TMDB_IMG}${img.file_path}" alt="Backdrop"></div>`;
        });
        html += '</div>';
      }
      html += '</div>';
    }

    html += '<button class="btn" id="back-btn">Back to Browse</button>';
    document.getElementById('detail-body').innerHTML = html;
document.getElementById('detail-view').classList.add('active');

// Render Directors FIRST
if (directors.length > 0) {
  const directorScroll = document.getElementById('director-scroll');
  for (const director of directors) {
    const card = document.createElement('div');
    card.className = 'card director-card';
    const directorImg = director.profile_path ? TMDB_IMG + director.profile_path : null;
    if (directorImg) {
      card.innerHTML = `
        <img class="poster" src="${directorImg}" loading="lazy" alt="${director.name}">
        <div class="info">
          <div class="director-info-stacked">
            <div class="director-name">${director.name}</div>
            <div class="director-role">Director</div>
          </div>
        </div>
      `;
      card.onclick = () => openActorDetail(director.id);
      directorScroll.appendChild(card);
    }
  }
}

if (cast.length > 0) {
  const castScroll = document.getElementById('cast-scroll');
  for (const actor of cast) {
    const card = document.createElement('div');
    card.className = 'card';
    const actorImg = actor.profile_path ? TMDB_IMG + actor.profile_path : null;
    if (actorImg) {
      const roleName = actor.character || actor.roles?.[0]?.character || 'Unknown Role';
      card.innerHTML = `
        <img class="poster" src="${actorImg}" loading="lazy" alt="${actor.name}">
        <div class="info">
          <div class="actor-info-stacked">
            <div class="actor-name">${actor.name}</div>
            <div class="actor-role">${roleName}</div>
          </div>
        </div>
      `;
      card.onclick = () => openActorDetail(actor.id);
      castScroll.appendChild(card);
    }
  }
}

    if (recommendations.length > 0) {
      const recScroll = document.getElementById('recommendations-scroll');
      for (const rec of recommendations) {
        const recCard = document.createElement('div');
        recCard.className = 'recommendation-card';
        const recImg = await getImageUrl(rec);
        if (recImg) {
          recCard.innerHTML = `<img class="poster" src="${recImg}" alt="${rec.title || rec.name}">`;
          recCard.onclick = () => openMovieDetail(rec.id);
          recScroll.appendChild(recCard);
        }
      }
    }

    document.getElementById('detail-close').onclick = closeDetail;
    document.getElementById('back-btn').onclick = closeDetail;

  } catch (err) {
    document.getElementById('detail-body').innerHTML = '<p style="color:#ff6666;">Error loading movie details</p>';
    console.error(err);
  }
  hideLoading();
}

async function showCollection(collectionId) {
  showLoading({ message: 'Loading collection...', showProgress: false });
  try {
    const apiFunc = isAdultMode ? tmdbAdult : tmdb;
    const collection = await apiFunc(`/collection/${collectionId}`);
    const title = collection.name || 'Collection';
    const overview = collection.overview || 'No overview available.';
    const backdrop = collection.backdrop_path ? `${TMDB_IMG}${collection.backdrop_path}` : null;
    const movies = collection.parts || [];

    let html = '';
    if (backdrop) {
      html += `
        <div class="detail-hero">
          <img class="detail-backdrop" src="${backdrop}" alt="Collection">
          <div class="detail-hero-content">
            <div class="detail-title-block"><h2>${title}</h2></div>
          </div>
        </div>
      `;
    } else {
      html += `<h2>${title}</h2>`;
    }
    html += `<p class="overview">${overview}</p>`;
    html += `<h3>Movies in Collection (${movies.length})</h3>`;
    html += '<div class="vertical-grid" id="collection-grid"></div>';
    html += '<button class="btn" id="back-btn">Back</button>';

    document.getElementById('detail-body').innerHTML = html;
    document.getElementById('detail-view').classList.add('active');
    await renderVerticalGrid('collection-grid', movies);
    document.getElementById('detail-close').onclick = closeDetail;
    document.getElementById('back-btn').onclick = closeDetail;
  } catch (err) {
    document.getElementById('detail-body').innerHTML = '<p style="color:#ff6666;">Error loading collection</p>';
    console.error(err);
  }
  hideLoading();
}

function openLightbox(imageUrl) {
  document.getElementById('lightbox-img').src = imageUrl;
  document.getElementById('image-lightbox').classList.add('active');
}

// Toggle favorite from detail view
function toggleDetailFavorite() {
  if (!currentDetailItem) return;
  
  const type = currentDetailItem.media_type || 
               (currentDetailItem.known_for_department ? 'person' : 
               (currentDetailItem.first_air_date ? 'tv' : 'movie'));
  
  toggleFavorite(currentDetailItem, type);
  updateDetailFavoriteButton();
  loadFavorites();
}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TV SHOW DETAIL VIEW - WITH WHERE TO WATCH & FAVORITES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

async function openTVDetail(tvId) {
  currentMovieId = tvId;
  showLoading({ message: 'Loading TV show details...', showProgress: false });
  try {
    const apiFunc = isAdultMode ? tmdbAdult : tmdb;
    const data = await apiFunc(`/tv/${tvId}`, {
      append_to_response: 'credits,videos,images,recommendations,similar',
      include_image_language: 'en,null'
    });

    currentDetailItem = { ...data, media_type: 'tv' };

    const title = data.name || 'Unknown';
    const rating = data.vote_average ? data.vote_average.toFixed(1) : 'N/A';
    const overview = data.overview || 'No overview available.';
    const firstAirDate = data.first_air_date || null;
    const allTrailers = data.videos?.results?.filter(v => v.site === 'YouTube') || [];
    const trailers = allTrailers.slice(0, 5);
    const cast = data.credits?.cast || [];
    const seasons = data.seasons || [];
    const posters = data.images?.posters || [];
    const backdrops = data.images?.backdrops || [];
    
    let recommendations = [...(data.recommendations?.results || []), ...(data.similar?.results || [])];
    recommendations = recommendations.filter((item, index, self) => index === self.findIndex(t => t.id === item.id));
    recommendations = recommendations.sort((a, b) => (b.popularity || 0) - (a.popularity || 0)).slice(0, 10);

    let heroImage = null;
    let heroType = null;
    const allHeroImages = [];
    if (posters.length > 0) posters.forEach(p => allHeroImages.push({ path: p.file_path, type: 'poster' }));
    if (backdrops.length > 0) backdrops.forEach(b => allHeroImages.push({ path: b.file_path, type: 'backdrop' }));
    if (allHeroImages.length > 0) {
      const randomHero = allHeroImages[Math.floor(Math.random() * allHeroImages.length)];
      heroImage = randomHero.path;
      heroType = randomHero.type;
    }
    const heroPoster = posters[0]?.file_path || data.poster_path;

    let html = '';
    if (heroImage) {
      html += '<div class="detail-hero">';
      if (heroType === 'backdrop') {
        html += `<img class="detail-backdrop" src="${TMDB_IMG}${heroImage}" alt="Backdrop">`;
      } else {
        html += `<img class="detail-backdrop" src="${TMDB_IMG}${heroImage}" alt="Hero" style="opacity: 0.5;">`;
      }
      html += '<div class="detail-hero-content">';
      if (heroPoster) html += `<img class="detail-poster" src="${TMDB_IMG}${heroPoster}" alt="Poster">`;
      html += `
        <div class="detail-title-block">
          <h2>${title} <span class="rating">${rating}â˜…</span></h2>
          ${firstAirDate ? `<div class="release-date">First Aired: ${new Date(firstAirDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div>` : ''}
        </div>
      `;
      html += '</div></div>';
    } else {
      html += `<h2>${title} <span class="rating">${rating}â˜…</span></h2>`;
      if (firstAirDate) {
        html += `<div class="release-date">First Aired: ${new Date(firstAirDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div>`;
      }
    }

    html += `<p class="overview">${overview}</p>`;

// ADD TV SHOW CREW INFO
const crew = data.credits?.crew || [];
const creators = data.created_by || [];
const producers = crew.filter(c => c.job === 'Executive Producer').slice(0, 3);
const productionCompanies = data.production_companies?.slice(0, 3).map(c => c.name).join(', ') || '';
const networks = data.networks?.slice(0, 2).map(n => n.name).join(', ') || '';

if (creators.length > 0 || producers.length > 0 || productionCompanies || networks) {
  html += '<div class="crew-info">';
  
  if (creators.length > 0) {
    html += `<div class="crew-item"><span class="crew-label">Creator:</span><span class="crew-value">${creators.map(c => c.name).join(', ')}</span></div>`;
  }
  
  if (producers.length > 0) {
    html += `<div class="crew-item"><span class="crew-label">Producer:</span><span class="crew-value">${producers.map(p => p.name).join(', ')}</span></div>`;
  }
  
  if (networks) {
    html += `<div class="crew-item"><span class="crew-label">Network:</span><span class="crew-value">${networks}</span></div>`;
  }
  
  if (productionCompanies) {
    html += `<div class="crew-item"><span class="crew-label">Studio:</span><span class="crew-value">${productionCompanies}</span></div>`;
  }
  
  if (data.number_of_seasons) {
    html += `<div class="crew-item"><span class="crew-label">Seasons:</span><span class="crew-value">${data.number_of_seasons} (${data.number_of_episodes} episodes)</span></div>`;
  }
  
  html += '</div>';
}

// Action buttons container
html += '<div class="detail-actions">';

    if (isAdultMode) {
      html += `
        <a href="https://www.xvideos.com" target="_blank" rel="noopener noreferrer" class="where-to-watch-btn">
          <span>Watch on xvideos</span>
          <span style="font-size: 1.2rem;">ğŸ”</span>
        </a>
      `;
    } else {
      html += `
        <a href="https://discord.gg/ZwGK9RnCrh" target="_blank" rel="noopener" class="where-to-watch-btn">
          <span>Where to Watch</span>
          <img class="where-to-watch-icon" src="https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/icons/couch.png" alt="Watch">
        </a>
      `;
    }

    // Add favorite button
const favorited = isFavorited(tvId, 'tv');
html += `
  <button class="detail-favorite-btn ${favorited ? 'favorited' : ''}" id="detail-favorite-btn" onclick="toggleDetailFavorite()">
    <span class="star-icon">${favorited ? 'â­' : 'â˜†'}</span> ${favorited ? 'Favorited' : 'Add Favorite'}
  </button>
`;

    html += '</div>'; // Close detail-actions

    if (trailers.length > 0) {
  html += '<h3>Trailers</h3><div class="trailers-scroll">';
  trailers.forEach((trailer) => {
    html += `
      <div class="trailer-container">
        <iframe src="${YT_EMBED}${trailer.key}?rel=0&playsinline=1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
      </div>
    `;
  });
  html += '</div>';
} else if (isAdultMode) {
  // Fallback: No YouTube trailers in adult mode
  const searchTitle = encodeURIComponent(title);
  html += '<h3>Trailers</h3>';
  html += `
    <p style="color: rgba(255,255,255,0.7); font-size: 0.85rem; margin-bottom: 1rem;">YouTube trailers not available</p>
    <a href="https://us.dvderotik.com/search.php?keywords=${searchTitle}" target="_blank" rel="noopener noreferrer" class="btn">
      Find Trailers (18+)
    </a>
  `;
}

    if (cast.length > 0) html += '<h3>Cast</h3><div class="cast-scroll" id="cast-scroll"></div>';

    if (seasons.length > 0) {
      html += '<h3>Seasons</h3><div class="season-selector-container">';
      html += '<select id="season-selector" class="season-dropdown"><option value="">Select a season...</option>';
      seasons.forEach(season => {
        html += `<option value="${season.season_number}">${season.name} (${season.episode_count} episodes)</option>`;
      });
      html += '</select></div>';
      html += '<div id="episodes-container" style="margin-top: 1rem; max-height: none; overflow-y: visible;"></div>';
    }

    if (recommendations.length > 0) html += '<h3>You Might Also Like</h3><div class="recommendations-scroll" id="recommendations-scroll"></div>';

    if (posters.length > 0 || backdrops.length > 0) {
      html += '<div class="image-gallery">';
      if (posters.length > 0) {
        html += `<h3>Posters (${posters.length})</h3><div class="gallery-scroll">`;
        posters.forEach(img => {
          html += `<div class="gallery-image" onclick="openLightbox('${TMDB_IMG}${img.file_path}')"><img src="${TMDB_IMG}${img.file_path}" alt="Poster"></div>`;
        });
        html += '</div>';
      }
      if (backdrops.length > 0) {
        html += `<h3>Backdrops (${backdrops.length})</h3><div class="gallery-scroll">`;
        backdrops.forEach(img => {
          html += `<div class="gallery-image" onclick="openLightbox('${TMDB_IMG}${img.file_path}')"><img src="${TMDB_IMG}${img.file_path}" alt="Backdrop"></div>`;
        });
        html += '</div>';
      }
      html += '</div>';
    }

    html += '<button class="btn" id="back-btn">Back to Browse</button>';
    document.getElementById('detail-body').innerHTML = html;
    document.getElementById('detail-view').classList.add('active');

    if (cast.length > 0) {
  const castScroll = document.getElementById('cast-scroll');
  for (const actor of cast) {
    const card = document.createElement('div');
    card.className = 'card';
    const actorImg = actor.profile_path ? TMDB_IMG + actor.profile_path : null;
    if (actorImg) {
      const roleName = actor.character || actor.roles?.[0]?.character || 'Unknown Role';
      card.innerHTML = `
        <img class="poster" src="${actorImg}" loading="lazy" alt="${actor.name}">
        <div class="info">
          <div class="actor-info-stacked">
            <div class="actor-name">${actor.name}</div>
            <div class="actor-role">${roleName}</div>
          </div>
        </div>
      `;
      card.onclick = () => openActorDetail(actor.id);
      castScroll.appendChild(card);
    }
  }
}

    const seasonSelector = document.getElementById('season-selector');
    if (seasonSelector) {
      seasonSelector.addEventListener('change', async (e) => {
        const seasonNumber = e.target.value;
        const episodesContainer = document.getElementById('episodes-container');
        if (!seasonNumber) {
          episodesContainer.innerHTML = '';
          return;
        }
        episodesContainer.innerHTML = '<p style="text-align:center; color: #666; padding: 1rem;">Loading episodes...</p>';
        try {
          const apiFunc = isAdultMode ? tmdbAdult : tmdb;
          const seasonData = await apiFunc(`/tv/${tvId}/season/${seasonNumber}`);
          episodesContainer.innerHTML = '';
          seasonData.episodes.forEach(ep => {
            const epDiv = document.createElement('div');
            epDiv.className = 'episode-item';
            const stillImage = ep.still_path ? `${TMDB_IMG}${ep.still_path}` : '';
            const airDate = ep.air_date ? new Date(ep.air_date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) : 'Unknown';
            epDiv.innerHTML = `
              ${stillImage ? `<img class="episode-still" src="${stillImage}" alt="Episode ${ep.episode_number}">` : ''}
              <div class="episode-details">
                <div class="episode-number">Episode ${ep.episode_number}</div>
                <div class="episode-title">${ep.name || 'Untitled'}</div>
                <div class="episode-overview">${ep.overview || 'No description available.'}</div>
                <div class="episode-air-date">Aired: ${airDate}</div>
              </div>
            `;
            episodesContainer.appendChild(epDiv);
          });
        } catch (err) {
          episodesContainer.innerHTML = '<p style="color: #ff6666; padding: 1rem;">Failed to load episodes</p>';
          console.error('Failed to load season:', err);
        }
      });
    }

    if (recommendations.length > 0) {
      const recScroll = document.getElementById('recommendations-scroll');
      for (const rec of recommendations) {
        const recCard = document.createElement('div');
        recCard.className = 'recommendation-card';
        const recImg = await getImageUrl(rec);
        if (recImg) {
          recCard.innerHTML = `<img class="poster" src="${recImg}" alt="${rec.title || rec.name}">`;
          recCard.onclick = () => openTVDetail(rec.id);
          recScroll.appendChild(recCard);
        }
      }
    }

    document.getElementById('detail-close').onclick = closeDetail;
    document.getElementById('back-btn').onclick = closeDetail;

  } catch (err) {
    document.getElementById('detail-body').innerHTML = '<p style="color:#ff6666;">Error loading TV details</p>';
    console.error(err);
  }
  hideLoading();
}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACTOR DETAIL VIEW - WITH FAVORITES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

async function openActorDetail(actorId) {
  showLoading({ message: 'Loading actor details...', showProgress: false });
  try {
    const apiFunc = isAdultMode ? tmdbAdult : tmdb;
    const data = await apiFunc(`/person/${actorId}`, {
  append_to_response: 'combined_credits,images'
});

currentDetailItem = { ...data, media_type: 'person' };

const name = data.name || 'Unknown';
const bio = data.biography 
  ? data.biography.substring(0, 400) + (data.biography.length > 400 ? '...' : '') 
  : 'No biography available.';
const profileImg = data.profile_path ? `${TMDB_IMG}${data.profile_path}` : null;
const profileImages = data.images?.profiles || [];

// Check if they're primarily a director
const knownFor = data.known_for_department || 'Acting';
const isDirector = knownFor === 'Directing';

// If director, use CREW credits (what they directed), otherwise use CAST credits (what they acted in)
let allCredits = [];
if (isDirector) {
  // Get their directing credits from crew
  const crewCredits = data.combined_credits?.crew || [];
  allCredits = crewCredits.filter(c => c.job === 'Director');
} else {
  // Get their acting credits from cast
  allCredits = data.combined_credits?.cast || [];
}

const movieCredits = allCredits.filter(c => c.media_type === 'movie');
const tvCredits = allCredits.filter(c => c.media_type === 'tv');

    allCredits.sort((a, b) => {
  if (a.id === currentMovieId) return -1;
  if (b.id === currentMovieId) return 1;
  return (b.popularity || 0) - (a.popularity || 0);
});
movieCredits.sort((a, b) => (b.popularity || 0) - (a.popularity || 0));
tvCredits.sort((a, b) => (b.popularity || 0) - (a.popularity || 0));

// GET RANDOM BACKDROP FROM THEIR CREDITS
const creditsWithBackdrops = allCredits.filter(c => c.backdrop_path);
let randomBackdrop = null;
if (creditsWithBackdrops.length > 0) {
  const randomCredit = creditsWithBackdrops[Math.floor(Math.random() * creditsWithBackdrops.length)];
  randomBackdrop = randomCredit.backdrop_path;
}

let html = '';

// ADD HERO SECTION WITH RANDOM BACKDROP
if (randomBackdrop) {
  html += '<div class="detail-hero">';
  html += `<img class="detail-backdrop" src="${TMDB_IMG}${randomBackdrop}" alt="${name}">`;
  html += '<div class="detail-hero-content">';
  if (profileImg) {
    html += `<img class="detail-poster" src="${profileImg}" alt="${name}">`;
  }
  html += `
    <div class="detail-title-block">
      <h2>${name}</h2>
      <p style="margin-top: 0.5rem; font-size: 0.9rem; color: rgba(255,255,255,0.7);"><em>Known for: ${knownFor}</em></p>
    </div>
  `;
  html += '</div></div>';
} else {
  // Fallback if no backdrop available
  html += `
    <div class="actor-profile">
      <h2>${name}</h2>
      ${profileImg ? `<img src="${profileImg}" alt="${name}">` : ''}
      <p><em>Known for: ${knownFor}</em></p>
    </div>
  `;
}

html += `<p class="overview">${bio}</p>`;

    // Add favorite button for actor
html += '<div class="detail-actions">';
const favorited = isFavorited(actorId, 'person');
html += `
  <button class="detail-favorite-btn ${favorited ? 'favorited' : ''}" id="detail-favorite-btn" onclick="toggleDetailFavorite()">
    <span class="star-icon">${favorited ? 'â­' : 'â˜†'}</span> ${favorited ? 'Favorited' : 'Add Favorite'}
  </button>
`;
    html += '</div>';

    if (movieCredits.length > 0 && tvCredits.length > 0) {
  html += `
    <div class="filter-buttons">
      <button class="filter-btn active" data-filter="all">All (${allCredits.length})</button>
      <button class="filter-btn" data-filter="movies">Movies (${movieCredits.length})</button>
      <button class="filter-btn" data-filter="tv">TV (${tvCredits.length})</button>
    </div>
  `;
}

const creditsLabel = isDirector ? 'Directed' : 'Credits';
html += `<h3>${creditsLabel}</h3><div class="vertical-grid" id="actor-credits"></div>`;

    if (profileImages.length > 0) {
      html += '<h3>Photos</h3><div class="gallery-scroll">';
      profileImages.forEach(img => {
        html += `<div class="gallery-image" onclick="openLightbox('${TMDB_IMG}${img.file_path}')"><img src="${TMDB_IMG}${img.file_path}" alt="Photo"></div>`;
      });
      html += '</div>';
    }

    html += '<button class="btn" id="back-to-movie">Back</button>';
    document.getElementById('detail-body').innerHTML = html;
    document.getElementById('detail-view').classList.add('active');

    async function renderCredits(credits) {
      const creditsGrid = document.getElementById('actor-credits');
      creditsGrid.innerHTML = '';
      for (const item of credits) {
        if (!item.poster_path && !item.backdrop_path) continue;
        const title = item.title || item.name || 'Unknown';
        const year = (item.release_date || item.first_air_date || '').slice(0, 4);
        const imageUrl = await getImageUrl(item);
        if (!imageUrl) continue;
        const card = document.createElement('div');
        card.className = 'card';
        if (item.id === currentMovieId) card.classList.add('highlight');
        card.innerHTML = `<img class="poster" src="${imageUrl}" loading="lazy" alt="${title}"><div class="info">${year ? `<div class="year">${year}</div>` : ''}</div>`;
        card.onclick = () => openDetail(item);
        creditsGrid.appendChild(card);
      }
    }

    await renderCredits(allCredits);

    const filterBtns = document.querySelectorAll('.filter-btn');
    filterBtns.forEach(btn => {
      btn.onclick = async () => {
        filterBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const filter = btn.dataset.filter;
        showLoading({ message: 'Loading credits...', showProgress: false });
        if (filter === 'all') await renderCredits(allCredits);
        else if (filter === 'movies') await renderCredits(movieCredits);
        else if (filter === 'tv') await renderCredits(tvCredits);
        hideLoading();
      };
    });

    document.getElementById('detail-close').onclick = closeDetail;
    document.getElementById('back-to-movie').onclick = closeDetail;

  } catch (err) {
    document.getElementById('detail-body').innerHTML = '<p style="color:#ff6666;">Error loading actor</p>';
    console.error(err);
  }
  hideLoading();
}

function closeDetail() {
  document.getElementById('detail-view').classList.remove('active');
  currentDetailItem = null;
  
  // Update all favorite buttons without full reload
  updateAllFavoriteButtons();
}
// Update all favorite star buttons on the page
function updateAllFavoriteButtons() {
  document.querySelectorAll('.favorite-btn').forEach(btn => {
    const card = btn.closest('.card');
    if (!card) return;
    
    // Get the item data from the onclick attribute
    const onclickAttr = btn.getAttribute('onclick');
    const idMatch = onclickAttr.match(/toggleFavoriteFromCard\((\d+),\s*'([^']+)'/);
    
    if (idMatch) {
      const id = parseInt(idMatch[1]);
      const type = idMatch[2];
      const favorited = isFavorited(id, type);
      
      btn.classList.toggle('favorited', favorited);
      btn.textContent = favorited ? 'â­' : 'â˜†';
    }
  });
  
  // Also reload favorites section to show/hide if needed
  loadFavorites();
}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ENHANCED SEARCH - WITH YEAR FILTERS & GENRE SEARCH
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

async function performSearch(query) {
  if (!query) {
    const searchSection = document.getElementById('search-results');
    if (searchSection) searchSection.remove();
    document.getElementById('genre-buttons-container').style.display = 'block';
    loadHome();
    return;
  }

  showLoading({ message: 'Searching...', showProgress: false });

  try {
    let allResults = [];
    let displayQuery = query;
    const yearMatch = query.match(/^\d{4}$/);
    const apiFunc = isAdultMode ? tmdbAdult : tmdb;

    // Check if query is a genre name
    const genreList = isAdultMode ? ADULT_GENRES : GENRES;
    const genreMatch = genreList.find(g => g.name.toLowerCase() === query.toLowerCase());
    
    if (genreMatch) {
      // Search by genre
      if (isAdultMode) {
        await searchByAdultGenre(genreMatch.query, genreMatch.name);
      } else {
        await searchByGenre(genreMatch.id, genreMatch.name);
      }
      return;
    }

    if (yearMatch) {
      // Year search with filters
      const year = yearMatch[0];
      
      // Hide normal sections
      document.querySelectorAll('section[id^="section-"]').forEach(s => s.style.display = 'none');
      document.getElementById('genre-buttons-container').style.display = 'none';
      
      let searchSection = document.getElementById('search-results');
      if (!searchSection) {
        searchSection = document.createElement('section');
        searchSection.id = 'search-results';
        document.querySelector('#section-airing').before(searchSection);
      }
      
      // Fetch movies and TV from that year
      let movieResults = [];
      let tvResults = [];
      
      for (let page = 1; page <= 5; page++) {
        try {
          const movieData = await apiFunc('/discover/movie', {
            primary_release_year: year,
            sort_by: 'popularity.desc',
            page: page
          });
          movieResults = movieResults.concat(movieData.results || []);
        } catch (err) {
          break;
        }
      }
      
      if (!isAdultMode) {
        for (let page = 1; page <= 5; page++) {
          try {
            const tvData = await apiFunc('/discover/tv', {
              first_air_date_year: year,
              sort_by: 'popularity.desc',
              page: page
            });
            tvResults = tvResults.concat(tvData.results || []);
          } catch (err) {
            break;
          }
        }
      }
      
      allResults = [...movieResults, ...tvResults];
      
      searchSection.innerHTML = `
        <h2>Results from ${year}</h2>
        <div class="filter-buttons">
          <button class="search-filter-btn active" data-filter="all-year">All (${allResults.length})</button>
          <button class="search-filter-btn" data-filter="movies-year">Movies (${movieResults.length})</button>
          ${!isAdultMode ? `<button class="search-filter-btn" data-filter="tv-year">TV (${tvResults.length})</button>` : ''}
        </div>
        <div class="vertical-grid" id="search-grid"></div>
        <button class="btn" onclick="backToHome()">Back to Browse</button>
      `;
      searchSection.style.display = 'block';

      async function renderSearchResults(items) {
        await renderVerticalGrid('search-grid', items, true);
      }

      await renderSearchResults(allResults);

      const filterBtns = document.querySelectorAll('.search-filter-btn');
      filterBtns.forEach(btn => {
        btn.onclick = async () => {
          filterBtns.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          const filter = btn.dataset.filter;
          showLoading({ message: 'Filtering...', showProgress: false });
          if (filter === 'all-year') await renderSearchResults(allResults);
          else if (filter === 'movies-year') await renderSearchResults(movieResults);
          else if (filter === 'tv-year') await renderSearchResults(tvResults);
          hideLoading();
        };
      });

      hideLoading();
      return;
    }

    // Normal text search
    for (let page = 1; page <= 10; page++) {
      const data = await apiFunc('/search/multi', { query: query, page: page });
      if (!data.results || data.results.length === 0) break;
      allResults = allResults.concat(data.results);
    }
    displayQuery = `"${query}"`;

    const movieResults = allResults.filter(r => r.media_type === 'movie');
    const tvResults = allResults.filter(r => r.media_type === 'tv');

    document.querySelectorAll('section[id^="section-"]').forEach(s => s.style.display = 'none');
    document.getElementById('genre-buttons-container').style.display = 'none';

    let searchSection = document.getElementById('search-results');
    if (!searchSection) {
      searchSection = document.createElement('section');
      searchSection.id = 'search-results';
      document.querySelector('#section-airing').before(searchSection);
    }

    let html = `<h2>Search Results for ${displayQuery}</h2>`;

    if (movieResults.length > 0 && tvResults.length > 0 && !isAdultMode) {
      html += `
        <div class="filter-buttons">
          <button class="search-filter-btn active" data-filter="all">All (${allResults.length})</button>
          <button class="search-filter-btn" data-filter="movies">Movies (${movieResults.length})</button>
          <button class="search-filter-btn" data-filter="tv">TV (${tvResults.length})</button>
        </div>
      `;
    }

    html += '<div class="vertical-grid" id="search-grid"></div>';
    html += '<button class="btn" onclick="backToHome()">Back to Browse</button>';
    searchSection.innerHTML = html;
    searchSection.style.display = 'block';

    async function renderSearchResults(items) {
      await renderVerticalGrid('search-grid', items, true);
    }

    await renderSearchResults(allResults);

    const filterBtns = document.querySelectorAll('.search-filter-btn');
    filterBtns.forEach(btn => {
      btn.onclick = async () => {
        filterBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const filter = btn.dataset.filter;
        showLoading({ message: 'Filtering...', showProgress: false });
        if (filter === 'all') await renderSearchResults(allResults);
        else if (filter === 'movies') await renderSearchResults(movieResults);
        else if (filter === 'tv') await renderSearchResults(tvResults);
        hideLoading();
      };
    });

  } catch (err) {
    console.error('Search failed:', err);
  }
  hideLoading();
}

const searchInput = document.getElementById('search-input');
searchInput.addEventListener('input', (e) => {
  const query = e.target.value.trim();
  if (query === '42069') {
    toggleAdultMode(true);
    searchInput.value = '';
    return;
  }
  if (query === '143') {
    toggleAdultMode(false);
    searchInput.value = '';
    return;
  }
  clearTimeout(searchTimeout);
  searchTimeout = setTimeout(() => { performSearch(query); }, 500);
});

searchInput.addEventListener('keypress', (e) => {
  if (e.key === 'Enter') {
    clearTimeout(searchTimeout);
    performSearch(searchInput.value.trim());
  }
});
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WEATHER WIDGET
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function updateTime() {
  const now = new Date();
  const hours = now.getHours();
  const minutes = now.getMinutes();
  const ampm = hours >= 12 ? 'PM' : 'AM';
  const displayHours = hours % 12 || 12;
  const displayMinutes = minutes < 10 ? '0' + minutes : minutes;
  document.getElementById('weatherTime').textContent = `${displayHours}:${displayMinutes} ${ampm}`;
}

setInterval(updateTime, 1000);
updateTime();

async function getCityName(lat, lon) {
  try {
    const response = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`);
    const data = await response.json();
    if (data && data.address) {
      const city = data.address.city || data.address.town || data.address.village || data.address.county || data.address.state;
      const country = data.address.country;
      if (city && country) return `${city}, ${country}`;
      if (city) return city;
      if (country) return country;
    }
    return 'Your Location';
  } catch (error) {
    return 'Your Location';
  }
}

async function getWeather() {
  const widget = document.getElementById('weatherWidget');
  widget.classList.add('visible');
  widget.classList.add('loading');

  if (!navigator.geolocation) {
    document.getElementById('weatherCondition').textContent = 'Location unavailable';
    document.getElementById('weatherLocation').textContent = 'Not supported';
    widget.classList.remove('loading');
    return;
  }

  navigator.geolocation.getCurrentPosition(async (position) => {
    const { latitude, longitude } = position.coords;
    try {
      const [weatherResponse, cityName] = await Promise.all([
        fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true`),
        getCityName(latitude, longitude)
      ]);
      const data = await weatherResponse.json();
      if (data.current_weather) {
        const tempC = Math.round(data.current_weather.temperature);
        const tempF = Math.round((tempC * 9/5) + 32);
        const isUS = (latitude > 24 && latitude < 50 && longitude > -125 && longitude < -66);
        const temp = isUS ? tempF : tempC;
        const unit = isUS ? 'Â°F' : 'Â°C';
        document.getElementById('weatherTemp').textContent = `${temp}${unit}`;
        document.getElementById('weatherCondition').textContent = getRudeboyWeatherCondition(data.current_weather.weathercode);
        document.getElementById('weatherLocation').textContent = cityName;
        document.getElementById('weatherIcon').textContent = getWeatherIconFromCode(data.current_weather.weathercode);
      }
    } catch (error) {
      document.getElementById('weatherCondition').textContent = 'Unavailable';
      document.getElementById('weatherIcon').textContent = 'ğŸŒ';
      document.getElementById('weatherLocation').textContent = 'Service down';
    }
    widget.classList.remove('loading');
  }, (error) => {
    document.getElementById('weatherCondition').textContent = 'Location denied';
    document.getElementById('weatherIcon').textContent = 'ğŸ“';
    document.getElementById('weatherLocation').textContent = 'Enable location';
    widget.classList.remove('loading');
  });
}

function getWeatherIconFromCode(code) {
  if (code === 0) return 'â˜€ï¸';
  if (code === 1 || code === 2) return 'ğŸŒ¤ï¸';
  if (code === 3) return 'â˜ï¸';
  if (code === 45 || code === 48) return 'ğŸŒ«ï¸';
  if (code >= 51 && code <= 67) return 'ğŸŒ§ï¸';
  if (code >= 71 && code <= 77) return 'â„ï¸';
  if (code >= 80 && code <= 82) return 'ğŸŒ¦ï¸';
  if (code >= 85 && code <= 86) return 'â„ï¸';
  if (code >= 95 && code <= 99) return 'â›ˆï¸';
  return 'ğŸŒ¡ï¸';
}

function getRudeboyWeatherCondition(code) {
  if (code === 0) return 'SunnySide Up';
  if (code === 1 || code === 2) return "It's Cloudy Bitch";
  if (code === 3) return "It's Cloudy Bitch";
  if (code === 45 || code === 48) return "Can't see shit";
  if (code >= 51 && code <= 67) return 'Wet T-Shirt Weather';
  if (code >= 71 && code <= 77) return 'Fucking Snow';
  if (code >= 80 && code <= 82) return "She's a squirter";
  if (code >= 85 && code <= 86) return 'Fucking Snow';
  if (code >= 95 && code <= 99) return 'Zeus is Pissed';
  return 'Unknown';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EASTER EGG - Matrix Animation with Music
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

const playlist = [
  {title: 'Capone', artist: 'Hey Pluto', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/capone.mp3'},
  {title: 'Count', artist: 'Fonss', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/count.mp3'},
  {title: 'Falling Softly', artist: 'Richard Smithson', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/falling%20softly.mp3'},
  {title: 'Fluid', artist: 'Mountaineer', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/fluid.mp3'},
  {title: 'I Wanna Take Your Body Higher', artist: 'SkyGaze', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/i%20wanna%20take%20your%20body%20higher.mp3'},
  {title: 'Journey', artist: 'Tatami', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/journey.mp3'},
  {title: 'Moments', artist: 'Tatami', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/moments.mp3'},
  {title: 'Stardrive', artist: 'Simon Folwar', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/stardrive.mp3'},
  {title: 'Sunset In Junipero', artist: 'Bach', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/sunset%20in%20junipero.mp3'},
  {title: 'I Know', artist: 'Matrika', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/IKnow.mp3'},
  {title: 'Other Worlds', artist: 'Carpetman', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/OtherWorlds.mp3'},
  {title: 'JaffaDays', artist: 'ToneBreak', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/JaffaDays.mp3'},
  {title: 'Baby Blue', artist: 'Action Bronson', url: 'https://raw.githubusercontent.com/1gby/seamless-checker/main/assets/secret%20stash/BabyBlue.mp3'}
];

let shuffledPlaylist = [...playlist];
let currentTrackIndex = 0;

function shufflePlaylist(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

shufflePlaylist(shuffledPlaylist);

function playRandomTrack() {
  if (currentTrackIndex >= shuffledPlaylist.length) {
    shufflePlaylist(shuffledPlaylist);
    currentTrackIndex = 0;
  }
  const track = shuffledPlaylist[currentTrackIndex];
  currentTrackIndex++;
  const audio = document.getElementById('easterAudio');
  audio.src = track.url;
  audio.volume = 0;
  audio.loop = false;
  audio.play().then(() => {
    let vol = 0;
    const fadeIn = setInterval(() => {
      vol += 0.05;
      audio.volume = Math.min(vol, 0.5);
      if (vol >= 0.5) clearInterval(fadeIn);
    }, 100);
  }).catch(() => {
    if (document.getElementById('easter-egg-overlay').classList.contains('active')) {
      playRandomTrack();
    }
  });
}

document.getElementById('easterAudio').addEventListener('ended', () => {
  if (document.getElementById('easter-egg-overlay').classList.contains('active')) {
    playRandomTrack();
  }
});
document.getElementById('easterEgg').onclick = () => {
  const overlay = document.getElementById('easter-egg-overlay');
  overlay.classList.add('active');
  playRandomTrack();

  const canvas = document.getElementById('matrixCanvas');
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  const msg = "CREATED BY RUDEBOYâ„¢";
  const fontSize = Math.ceil(canvas.width / msg.length);
  const drops = [];
  const dropSpeeds = [];

  for (let i = 0; i < msg.length; i++) {
    drops[i] = Math.random() * -100;
    dropSpeeds[i] = 0.5 + Math.random() * 1.5;
  }

  let messageMode = false;
  let activeWords = [];
  const words = ['CREATED', 'BY', 'RUDEBOYâ„¢'];
  const wordStartPositions = [0, 8, 11];
  const wordLengths = [7, 2, 9];
  let messageTimer = 0;
  const MESSAGE_INTERVAL = 30000;
  let currentSpeed = 50;

  function glitchChar(ctx, char, x, y, fontSize) {
    const offsetX = (Math.random() - 0.5) * 4;
    const offsetY = (Math.random() - 0.5) * 4;
    const colors = ['#10b981', '#764ba2', '#ffffff'];
    ctx.fillStyle = colors[Math.floor(Math.random() * colors.length)];
    ctx.fillText(char, x + offsetX, y + offsetY);
  }

  function draw() {
    if (messageMode) {
      ctx.fillStyle = 'rgba(0,0,0,0.05)';
    } else {
      ctx.fillStyle = 'rgba(0,0,0,0.25)';
    }
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.font = fontSize + 'px monospace';

    if (!messageMode) {
      messageTimer += currentSpeed;
      if (messageTimer >= MESSAGE_INTERVAL) {
        messageMode = true;
        activeWords = [0];
        messageTimer = 0;
        for (let i = 0; i < msg.length; i++) {
          drops[i] = -100;
          dropSpeeds[i] = 1;
        }
        for (let i = 0; i < 7; i++) drops[i] = 0;
        clearInterval(matrixInterval);
        currentSpeed = 75;
        matrixInterval = setInterval(draw, currentSpeed);
      }
    }

    for (let i = 0; i < msg.length; i++) {
      let char;
      if (messageMode) {
        let shouldShow = false;
        for (let w of activeWords) {
          const wordStart = wordStartPositions[w];
          const wordEnd = wordStart + wordLengths[w];
          if (i >= wordStart && i < wordEnd) {
            char = msg[i];
            shouldShow = true;
            break;
          }
        }
        if (!shouldShow) char = ' ';
      } else {
        char = msg[i];
      }

      if (messageMode) {
        glitchChar(ctx, char, i * fontSize, drops[i] * fontSize, fontSize);
      } else {
        ctx.fillStyle = i % 2 === 0 ? '#10b981' : '#764ba2';
        ctx.fillText(char, i * fontSize, drops[i] * fontSize);
      }

      if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
        drops[i] = Math.random() * -100;
        if (!messageMode) dropSpeeds[i] = 0.5 + Math.random() * 1.5;
      }
      drops[i] += dropSpeeds[i];
    }

    if (messageMode) {
      if (activeWords.length === 1 && activeWords[0] === 0) {
        const createdMaxDrop = Math.max(...drops.slice(0, 7));
        if (createdMaxDrop * fontSize > canvas.height / 2) {
          activeWords.push(1);
          for (let j = 8; j < 10; j++) drops[j] = 0;
        }
      }
      if (activeWords.length === 2 && activeWords[1] === 1) {
        const byMaxDrop = Math.max(...drops.slice(8, 10));
        if (byMaxDrop * fontSize > canvas.height / 2) {
          activeWords.push(2);
          for (let j = 11; j < 19; j++) drops[j] = 0;
        }
      }
      if (activeWords.length === 3) {
        const rudeboyMaxDrop = Math.max(...drops.slice(11, 19));
        if (rudeboyMaxDrop * fontSize > canvas.height + fontSize * 5) {
          messageMode = false;
          activeWords = [];
          for (let j = 0; j < msg.length; j++) {
            drops[j] = Math.random() * -100;
            dropSpeeds[j] = 0.5 + Math.random() * 1.5;
          }
          clearInterval(matrixInterval);
          currentSpeed = 50;
          matrixInterval = setInterval(draw, currentSpeed);
        }
      }
    }
  }

  let matrixInterval = setInterval(draw, currentSpeed);

  overlay.onclick = () => {
    clearInterval(matrixInterval);
    overlay.classList.remove('active');
    const audio = document.getElementById('easterAudio');
    let vol = audio.volume;
    const fadeOut = setInterval(() => {
      vol -= 0.05;
      audio.volume = Math.max(vol, 0);
      if (vol <= 0) {
        clearInterval(fadeOut);
        audio.pause();
        audio.currentTime = 0;
      }
    }, 50);
  };
};
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INFINITE SCROLL
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

let isLoadingMore = false;
let currentScrollPage = 1;
let currentScrollEndpoint = null;
let currentScrollParams = null;
let currentScrollGridId = null;

// Detect scroll position
window.addEventListener('scroll', () => {
  if (isLoadingMore) return; // Don't load if already loading
  
  const scrollHeight = document.documentElement.scrollHeight;
  const scrollTop = document.documentElement.scrollTop;
  const clientHeight = document.documentElement.clientHeight;
  
  // Check if scrolled to 80%
  const scrollPercent = (scrollTop + clientHeight) / scrollHeight;
  
  if (scrollPercent >= 0.8 && currentScrollEndpoint) {
    loadMoreContent();
  }
});

async function loadMoreContent() {
  if (!currentScrollEndpoint || !currentScrollGridId) return;
  
  isLoadingMore = true;
  currentScrollPage++;
  
  console.log(`Loading page ${currentScrollPage}...`);
  
  try {
    const apiFunc = isAdultMode ? tmdbAdult : tmdb;
    const { results } = await apiFunc(currentScrollEndpoint, { 
      ...currentScrollParams, 
      page: currentScrollPage 
    });
    
    if (results && results.length > 0) {
      await appendToHorizontal(currentScrollGridId, results);
    } else {
      // No more results, stop infinite scroll for this section
      currentScrollEndpoint = null;
    }
  } catch (err) {
    console.error('Failed to load more:', err);
  }
  
  isLoadingMore = false;
}

// Append items to existing horizontal grid
async function appendToHorizontal(gridId, items) {
  const grid = document.getElementById(gridId);
  if (!grid) return;
  
  for (const item of items) {
    if (!item.poster_path && !item.backdrop_path && !item.profile_path) continue;
    const title = item.title || item.name || 'Unknown';
    const year = (item.release_date || item.first_air_date || '').slice(0, 4);
    let imageUrl;
    if (item.media_type === 'person' || item.known_for_department) {
      imageUrl = item.profile_path ? `${TMDB_IMG}${item.profile_path}` : null;
    } else {
      imageUrl = await getImageUrl(item);
    }
    if (!imageUrl) continue;
    
    const card = document.createElement('div');
    card.className = 'card';
    
    const type = item.media_type || (item.known_for_department ? 'person' : (item.first_air_date ? 'tv' : 'movie'));
    const favorited = isFavorited(item.id, type);
    
    card.innerHTML = `
      <button class="favorite-btn ${favorited ? 'favorited' : ''}" onclick="event.stopPropagation(); toggleFavoriteFromCard(${item.id}, '${type}', this, ${JSON.stringify(item).replace(/"/g, '&quot;')})">
        ${favorited ? 'â­' : 'â˜†'}
      </button>
      <img class="poster" src="${imageUrl}" loading="lazy" alt="${title}">
      <div class="info">
        ${year ? `<div class="year">${year}</div>` : ''}
      </div>
    `;
    card.onclick = () => openDetail(item);
    grid.appendChild(card);
  }
}

// Enable infinite scroll for a section
function enableInfiniteScroll(endpoint, params, gridId) {
  currentScrollEndpoint = endpoint;
  currentScrollParams = params;
  currentScrollGridId = gridId;
  currentScrollPage = 1;
}

// Disable infinite scroll (called when changing pages/modes)
function disableInfiniteScroll() {
  currentScrollEndpoint = null;
  currentScrollParams = null;
  currentScrollGridId = null;
  currentScrollPage = 1;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INITIALIZATION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

if (isAdultMode) {
  document.getElementById('mode-indicator').classList.add('active');
  document.getElementById('app-title').classList.add('adult-mode');
}

loadHome();
getWeather();

  </script>
  <!-- Hidden visitor tracker - counts toward home page total -->
<img src="https://hits.sh/rud3boy.vercel.app.svg" alt="" style="display: none;" />
</body>
</html>